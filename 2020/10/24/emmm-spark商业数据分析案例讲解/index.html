<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£ | Gorge</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="è®°å½•è¿™ç¯‡è®°å½•ä¸ºå•¥ä»¥emmmå¼€å¤´å‘¢ï¼Ÿå“ˆå“ˆï¼ˆï½ï½ï¼‰ï½å› ä¸ºæˆ‘çš„é˜¿é‡Œäº‘è¿˜æœ‰ä¸€ä¸ªæœˆå°±è¦åˆ°æœŸäº†ã€‚è¿™æ„å‘³ç€åˆæ˜¯ä¸€æ³¢æ”¾è¡€ï½ï½ä¸è¿‡å¯¹äºä¸€ä¸ªå¿ å®çš„é˜¿é‡Œç²‰æ¥è¯´ï¼Œè¿˜æ˜¯ç”¨äº†è‡ªå·±ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ï¼Œåˆç»­ç§Ÿäº†ä¸€å¹´ã€‚ï¼ˆè¿™ä¸œè¥¿æœ‰ç‚¹ä¸Šç˜¾ï¼Œç”¨ä¸Šäº†å°±ä¸æƒ³æ”¾å¼ƒäº†ï½ï½å“ˆå“ˆï¼Œè¿™æ˜¯çœŸå¥½ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹ä¸èµ·è¿™ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ä¸æ˜¯ï¼å½“ç„¶ï¼Œå¦‚æœä»¥åçœŸçš„æœ‰æœºä¼šè¿›äº†é˜¿é‡Œï¼Œé˜¿é‡Œçˆ¸çˆ¸ä¼šä¸ä¼šç»™æˆ‘å…è´¹æœåŠ¡çš„æœºä¼šå‘€ï¼ğŸ˜‚ï¼‰ Jupyter notebook é˜¿é‡Œäº‘æ­å»ºåˆšè¯´">
<meta property="og:type" content="article">
<meta property="og:title" content="emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£">
<meta property="og:url" content="http://yoursite.com/2020/10/24/emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£/index.html">
<meta property="og:site_name" content="Gorge">
<meta property="og:description" content="è®°å½•è¿™ç¯‡è®°å½•ä¸ºå•¥ä»¥emmmå¼€å¤´å‘¢ï¼Ÿå“ˆå“ˆï¼ˆï½ï½ï¼‰ï½å› ä¸ºæˆ‘çš„é˜¿é‡Œäº‘è¿˜æœ‰ä¸€ä¸ªæœˆå°±è¦åˆ°æœŸäº†ã€‚è¿™æ„å‘³ç€åˆæ˜¯ä¸€æ³¢æ”¾è¡€ï½ï½ä¸è¿‡å¯¹äºä¸€ä¸ªå¿ å®çš„é˜¿é‡Œç²‰æ¥è¯´ï¼Œè¿˜æ˜¯ç”¨äº†è‡ªå·±ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ï¼Œåˆç»­ç§Ÿäº†ä¸€å¹´ã€‚ï¼ˆè¿™ä¸œè¥¿æœ‰ç‚¹ä¸Šç˜¾ï¼Œç”¨ä¸Šäº†å°±ä¸æƒ³æ”¾å¼ƒäº†ï½ï½å“ˆå“ˆï¼Œè¿™æ˜¯çœŸå¥½ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹ä¸èµ·è¿™ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ä¸æ˜¯ï¼å½“ç„¶ï¼Œå¦‚æœä»¥åçœŸçš„æœ‰æœºä¼šè¿›äº†é˜¿é‡Œï¼Œé˜¿é‡Œçˆ¸çˆ¸ä¼šä¸ä¼šç»™æˆ‘å…è´¹æœåŠ¡çš„æœºä¼šå‘€ï¼ğŸ˜‚ï¼‰ Jupyter notebook é˜¿é‡Œäº‘æ­å»ºåˆšè¯´">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201021112803503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201021204557992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201023212023388.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201023212642926.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201023212832651.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201024111407659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201024112306697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:updated_time" content="2020-10-24T03:43:13.007Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£">
<meta name="twitter:description" content="è®°å½•è¿™ç¯‡è®°å½•ä¸ºå•¥ä»¥emmmå¼€å¤´å‘¢ï¼Ÿå“ˆå“ˆï¼ˆï½ï½ï¼‰ï½å› ä¸ºæˆ‘çš„é˜¿é‡Œäº‘è¿˜æœ‰ä¸€ä¸ªæœˆå°±è¦åˆ°æœŸäº†ã€‚è¿™æ„å‘³ç€åˆæ˜¯ä¸€æ³¢æ”¾è¡€ï½ï½ä¸è¿‡å¯¹äºä¸€ä¸ªå¿ å®çš„é˜¿é‡Œç²‰æ¥è¯´ï¼Œè¿˜æ˜¯ç”¨äº†è‡ªå·±ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ï¼Œåˆç»­ç§Ÿäº†ä¸€å¹´ã€‚ï¼ˆè¿™ä¸œè¥¿æœ‰ç‚¹ä¸Šç˜¾ï¼Œç”¨ä¸Šäº†å°±ä¸æƒ³æ”¾å¼ƒäº†ï½ï½å“ˆå“ˆï¼Œè¿™æ˜¯çœŸå¥½ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹ä¸èµ·è¿™ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ä¸æ˜¯ï¼å½“ç„¶ï¼Œå¦‚æœä»¥åçœŸçš„æœ‰æœºä¼šè¿›äº†é˜¿é‡Œï¼Œé˜¿é‡Œçˆ¸çˆ¸ä¼šä¸ä¼šç»™æˆ‘å…è´¹æœåŠ¡çš„æœºä¼šå‘€ï¼ğŸ˜‚ï¼‰ Jupyter notebook é˜¿é‡Œäº‘æ­å»ºåˆšè¯´">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20201021112803503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center">
  
    <link rel="alternative" href="/atom.xml" title="Gorge" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
      <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("your app_id", "your app_key");</script>
<script src="/js/Counter.js"></script>
  
</head></html>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="../../photo/head.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">He Zhang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">æ¬¢è¿å‘€</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>èœå•</li>
						<li>æ ‡ç­¾</li>
						
						<li>å‹æƒ…é“¾æ¥</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">ä¸»é¡µ</a></li>
				        
							<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
				        
							<li><a href="https://me.csdn.net/qq_39536716">CSDN</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="zhihu" target="_blank" href="/1660047480" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="/1660047480@qq.com" title="mail">mail</a>
					        
								<a class="qq" target="_blank" href="/1660047480@qq.com" title="qq">qq</a>
					        
								<a class="weibo" target="_blank" href="/1660047480@qq.com" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">He Zhang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="../../photo/head.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">He Zhang</h1>
			</hgroup>
			
			<p class="header-subtitle">æ¬¢è¿å‘€</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">ä¸»é¡µ</a></li>
		        
					<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
		        
					<li><a href="https://me.csdn.net/qq_39536716">CSDN</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="zhihu" target="_blank" href="/1660047480" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="/1660047480@qq.com" title="mail">mail</a>
			        
						<a class="qq" target="_blank" href="/1660047480@qq.com" title="qq">qq</a>
			        
						<a class="weibo" target="_blank" href="/1660047480@qq.com" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/24/emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£/" class="article-date">
  	<time datetime="2020-10-24T03:29:10.250Z" itemprop="datePublished">2020-10-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        
          
<div class="counter-tag counter">
    <span id="/2020/10/24/emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£">
         &nbsp;
        view
    </span>
</div>

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="è®°å½•"><a href="#è®°å½•" class="headerlink" title="è®°å½•"></a>è®°å½•</h2><p>è¿™ç¯‡è®°å½•ä¸ºå•¥ä»¥emmmå¼€å¤´å‘¢ï¼Ÿå“ˆå“ˆï¼ˆï½ï½ï¼‰ï½å› ä¸ºæˆ‘çš„é˜¿é‡Œäº‘è¿˜æœ‰ä¸€ä¸ªæœˆå°±è¦åˆ°æœŸäº†ã€‚è¿™æ„å‘³ç€åˆæ˜¯ä¸€æ³¢æ”¾è¡€ï½ï½ä¸è¿‡å¯¹äºä¸€ä¸ªå¿ å®çš„é˜¿é‡Œç²‰æ¥è¯´ï¼Œè¿˜æ˜¯ç”¨äº†è‡ªå·±ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ï¼Œåˆç»­ç§Ÿäº†ä¸€å¹´ã€‚ï¼ˆè¿™ä¸œè¥¿æœ‰ç‚¹ä¸Šç˜¾ï¼Œç”¨ä¸Šäº†å°±ä¸æƒ³æ”¾å¼ƒäº†ï½ï½å“ˆå“ˆï¼Œè¿™æ˜¯çœŸå¥½ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹ä¸èµ·è¿™ä¸€ä¸ªæœˆçš„ç”Ÿæ´»è´¹ä¸æ˜¯ï¼å½“ç„¶ï¼Œå¦‚æœä»¥åçœŸçš„æœ‰æœºä¼šè¿›äº†é˜¿é‡Œï¼Œé˜¿é‡Œçˆ¸çˆ¸ä¼šä¸ä¼šç»™æˆ‘å…è´¹æœåŠ¡çš„æœºä¼šå‘€ï¼ğŸ˜‚ï¼‰</p>
<h2 id="Jupyter-notebook-é˜¿é‡Œäº‘æ­å»º"><a href="#Jupyter-notebook-é˜¿é‡Œäº‘æ­å»º" class="headerlink" title="Jupyter notebook é˜¿é‡Œäº‘æ­å»º"></a>Jupyter notebook é˜¿é‡Œäº‘æ­å»º</h2><p>åˆšè¯´å®Œï¼Œè¦å……åˆ†åˆ©ç”¨ï¼Œé‚£å°±èµ¶å¿«åˆ©ç”¨èµ·æ¥å§ï¼ æœ¬æ¥æ˜¯æ­å»ºåœ¨æˆ‘MACä¸Šçš„ï¼Œç°åœ¨å°±æŠŠå®ƒè¿ç§»åˆ°é˜¿é‡Œäº‘ä¸Šå§ï¼ä¹Ÿèƒ½è®©æˆ‘éšæ—¶éšåœ°çš„è¿›è¡Œç¼–ç¨‹äº†ï½ï½</p>
<p>åç§° Jupyter æ˜¯ç”±Juliaã€Pythonå’ŒRä¸‰ä¸ªå•è¯ç»„åˆè€Œæˆçš„ã€‚Jupyter Notebookæ˜¯ä¸€ç§Webåº”ç”¨ï¼Œå®ƒèƒ½è®©ç”¨æˆ·å°†è¯´æ˜æ–‡æœ¬ã€æ•°å­¦æ–¹ç¨‹ã€ä»£ç å’Œå¯è§†åŒ–å†…å®¹å…¨éƒ¨ç»„åˆåˆ°ä¸€ä¸ªæ˜“äºå…±äº«çš„æ–‡æ¡£ä¸­ï¼Œéå¸¸æ–¹ä¾¿ç ”ç©¶å’Œæ•™å­¦ã€‚Jupyter Notebookç‰¹åˆ«é€‚åˆåšæ•°æ®å¤„ç†ï¼Œå…¶ç”¨é€”å¯ä»¥åŒ…æ‹¬æ•°æ®æ¸…ç†å’Œæ¢ç´¢ã€å¯è§†åŒ–ã€æœºå™¨å­¦ä¹ å’Œå¤§æ•°æ®åˆ†æã€‚</p>
<h2 id="æœåŠ¡åŸç†"><a href="#æœåŠ¡åŸç†" class="headerlink" title="æœåŠ¡åŸç†"></a>æœåŠ¡åŸç†</h2><p><img src="https://img-blog.csdnimg.cn/20201021112803503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h2><p>Anacondaæ˜¯ä¸€ä¸ªå¼€æºçš„Pythonå‘è¡Œç‰ˆæœ¬ï¼Œå…¶åŒ…å«äº†condaã€Pythonç­‰180å¤šä¸ªç§‘å­¦åŒ…åŠå…¶ä¾èµ–é¡¹ã€‚Anacondaä¸­å·²ç»é›†æˆäº†Jupyter Notebookï¼Œå› æ­¤ï¼Œå¯ä»¥é¦–å…ˆå®‰è£…Anacondaï¼Œç„¶åå†é…ç½®Jupyter Notebookã€‚</p>
<p>Anacondaçš„å®‰è£…è¿‡ç¨‹ï¼Œè¿™é‡Œå°±ä¸åœ¨è®°å½•äº†ï¼</p>
<p>å®‰è£…å¥½Anacondaä¹‹åï¼Œæ£€æŸ¥é‡Œé¢æ˜¯å¦å·²ç»é›†æˆäº†jupyter Notebookã€‚ä¸€èˆ¬è¿™é‡Œé¢éƒ½æ˜¯é›†æˆäº†çš„ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£å°±åœ¨å®‰è£…ä¸€ä¸‹å§ï¼<br>å› ä¸ºæˆ‘æ­å»ºåœ¨äº†äº‘ä¸Šï¼Œè¿™é‡Œçš„å®‰å…¨æ€§è¿˜æ˜¯è¦ä¿æŠ¤ä¸€ä¸‹çš„ã€‚å› ä¸ºæˆ‘çš„ç›®çš„æ˜¯éšæ—¶éšåœ°ï¼Œéšæœºéƒ½å¯ä»¥è¿›è¡Œç¼–ç¨‹ï¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/hadoop/anaconda3/bin</span><br><span class="line">./python</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¥ç”Ÿæˆä¸€ä¸‹å¯†ç ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</span><br><span class="line">&gt;&gt;&gt;passwd()</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åç³»ç»Ÿä¼šç”Ÿæˆä¸€ä¸ªå¯†ç å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚sha1ï¼›è®°å¾—å°†è¿™ä¸ªå¯†ç ä¸²ä¿å­˜ä¸‹æ¥ï¼Œç”¨æ¥é…ç½®ä½ çš„å¯†ç ã€‚</p>
<p>é€€å‡ºpythonä¹‹åï¼Œæ‰¾åˆ°é…ç½®æ–‡ä»¶ã€‚<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.jupyter/jupyter_notebook_config.py</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.ip=<span class="string">'*'</span>                     <span class="comment"># å°±æ˜¯è®¾ç½®æ‰€æœ‰ipçš†å¯è®¿é—®  </span></span><br><span class="line">c.NotebookApp.password = <span class="string">'sha1:7c7990750e83:965c1466a4fab0849051ca5f3c5661110813795b'</span>     <span class="comment"># ä¸Šé¢å¤åˆ¶çš„é‚£ä¸ªshaå¯†æ–‡'  </span></span><br><span class="line">c.NotebookApp.open_browser = False       <span class="comment"># ç¦æ­¢è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨  </span></span><br><span class="line">c.NotebookApp.port =8888                 <span class="comment"># ç«¯å£</span></span><br><span class="line">c.NotebookApp.notebook_dir = <span class="string">'/home/hadoop/jupyternotebook'</span>  <span class="comment">#è®¾ç½®Notebookå¯åŠ¨è¿›å…¥çš„ç›®å½•</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®å®Œæˆä¹‹åï¼Œä½¿ç”¨jupyter notebookå¯åŠ¨å³å¯ï¼è¿™æ—¶å€™åœ¨æœ¬æœºè®¿é—®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¦‚æœæƒ³è¦é€šè¿‡å…¶ä»–ç”µè„‘è®¿é—®è¿˜éœ€è¦è¿›è¡Œä¸‹ä¸€æ­¥çš„ç­–ç•¥ï¼</p>
<h2 id="æ•™è®­"><a href="#æ•™è®­" class="headerlink" title="æ•™è®­"></a>æ•™è®­</h2><p>è¿˜è®°å¾—HDFSå®éªŒä¸­ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³å—ï¼Ÿå“ˆå“ˆå“ˆ å…¶å®æœ‰ç‚¹å‚»äº†ã€‚<br>åœ¨é…ç½®notebookçš„æ—¶å€™ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯8888ç«¯å£ï¼Œé˜¿é‡Œäº‘æ˜¯å¯¹è¿™äº›ç«¯å£è¿›è¡Œä¿æŠ¤äº†çš„ã€‚ä¸»è¦æœ‰ä¸¤å±‚ä¿æŠ¤ï¼šç¬¬ä¸€å±‚æ˜¯é˜¿é‡Œäº‘æœ¬èº«çš„é˜²ç«å¢™ï¼Œç¬¬äºŒå±‚æ˜¯æ§åˆ¶å°çš„å®‰å…¨ç»„è§„åˆ™ã€‚è¿™ä¸ªç»éªŒæœ¬æ¥æ˜¯åœ¨mysqlçš„é…ç½®çš„æ—¶å€™è§£å†³è¿‡çš„ï¼ä½†æ˜¯å¿˜è®°äº†ã€‚æ‰€ä»¥åœ¨æ‰§è¡ŒHDFSåˆ†å¸ƒå¼æ–‡ä»¶è¯»å–çš„æ—¶å€™ï¼Œä¸€ç›´æ²¡æœ‰æˆåŠŸï¼ä½†æ˜¯è¿™é‡Œé…ç½®çš„æ—¶å€™ï¼Œå¿½ç„¶æƒ³èµ·äº†è¿™ä¸ªäº‹æƒ…ï¼Œæ‰€ä»¥å°±æŠŠè¿™ä¸ªé—®é¢˜è§£å†³äº†ã€‚HDFS ä½¿ç”¨æœ¬æœºç”¨æˆ·åˆ†å¸ƒå¼è¯»å–ä¹Ÿæ²¡é—®é¢˜äº†ã€‚ä½†æ˜¯å†™æƒé™è¿˜æ˜¯ä¸å¤Ÿçš„ã€‚</p>
<h2 id="æ¡ˆä¾‹è®²è§£"><a href="#æ¡ˆä¾‹è®²è§£" class="headerlink" title="æ¡ˆä¾‹è®²è§£"></a>æ¡ˆä¾‹è®²è§£</h2><p>æ•°æ®æ¥æºï¼š<a href="https://www.kaggle.com/yelp-dataset/yelp-dataset" target="_blank" rel="noopener">YELPæ•°æ®é›†</a><strong>ä»…ç”¨æ¥å­¦ä¹ </strong> </p>
<h3 id="json-æ•°æ®é›†"><a href="#json-æ•°æ®é›†" class="headerlink" title="json æ•°æ®é›†"></a>json æ•°æ®é›†</h3><p>è¿™é‡Œçš„æ•°æ®é›†æ ¼å¼æ˜¯å±äºNoSQLçš„ä¸­çš„æ–‡æ¡£æ•°æ®é›†æ ¼å¼ä¹‹ä¸€çš„jsonæ•°æ®é›†æ ¼å¼ã€‚<br>å› ä¸ºï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å¯¹è¿™ç±»æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œåšä¸€ä¸ªç®€å•çš„å­¦ä¹ è®°å½•ã€‚</p>
<ol>
<li><p>ç®€ä»‹<br>JSON:ä¸€ç§ä¸å¼€å‘è¯­è¨€æ— å…³çš„ã€è½»é‡çº§çš„æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå…¨ç§°JavaScript Object Notationï¼Œä¸€ç§æ•°æ®æ ¼å¼çš„æ ‡å‡†è§„èŒƒï¼Œèµ·åˆæ¥æºäºJavaScriptè¿™é—¨è¯­è¨€ï¼Œåæ¥éšç€ä½¿ç”¨çš„å¹¿æ³›ï¼Œå‡ ä¹æ¯é—¨å¼€å‘è¯­è¨€éƒ½æœ‰å¤„ç†JSONçš„APIã€‚<br><strong>ä¼˜ç‚¹ï¼šæ˜“äºäººçš„é˜…è¯»å’Œç¼–å†™ï¼Œæ˜“äºç¨‹åºè§£æä¸ç”Ÿäº§ã€‚</strong>ï¼ˆçœ‹äº†ä¸€ä¸‹çœŸçš„æ˜¯ä¾¿äºé˜…è¯»ä¸å¤„ç†ï¼‰</p>
<p>JSONæ ·ä¾‹ï¼šé¦–å…ˆä¸€ä¸ªèŠ±æ‹¬å·{}ï¼Œæ•´ä¸ªä»£è¡¨ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒæ—¶é‡Œé¢æ˜¯ä¸€ç§Key-Valueçš„å­˜å‚¨å½¢å¼ï¼Œå®ƒè¿˜æœ‰ä¸åŒçš„æ•°æ®ç±»å‹æ¥åŒºåˆ†ã€‚</p>
</li>
<li><p>æ•°æ®ç±»å‹è¡¨ç¤º<br>æ•°æ®ç»“æ„ï¼šObjectã€Array<br>åŸºæœ¬ç±»å‹ï¼šstringï¼Œnumberï¼Œtrueï¼Œfalseï¼Œnull<br>ï¼ˆ1ï¼‰Object<br>{key:value,key:valueâ€¦}<br>keyï¼šstringç±»å‹<br>valueï¼šä»»ä½•åŸºæœ¬ç±»å‹æˆ–æ•°æ®ç»“æ„<br>ï¼ˆ2ï¼‰Array<br>[value,valueâ€¦]<br>valueï¼šä»»ä½•åŸºæœ¬ç±»å‹æˆ–æ•°æ®ç»“æ„ã€‚<br>æ¯”å¦‚ï¼š{â€œnameâ€:â€æå¹¿â€, â€œvaluesâ€:[1,2,45,â€ä½ å¥½â€] }</p>
</li>
<li><p>å®é™…jsonæ•°æ®æ ¼å¼<br>è¿™ä¸ªæ ¼å¼çš„æ–‡ä»¶å¯ä»¥é€šè¿‡t x tæˆ–è€…ç½‘é¡µç­‰æ–¹å¼æ‰“å¼€ï¼Œå½“ç„¶è¿˜æœ‰è®¸å¤šå·¥å…·ã€‚<br>æˆ‘è¿™é‡Œç”¨çš„æ˜¯Xcodeã€‚å¥½äº†è¿™å°±æ˜¯æˆ‘ä»¬è¦å¤„ç†çš„æ•°æ®äº†ã€‚<br><img src="https://img-blog.csdnimg.cn/20201021204557992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
<li><p>æ•°æ®é›†æå‰åˆ†æ<br>æˆ‘è¿™é‡Œå–å‡ºæ¥ä¸€æ¡ä¿¡æ¯ï¼Œå…ˆæ¥çœ‹çœ‹ä¿¡æ¯æ˜¯å•¥æ ·å­çš„ã€‚</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"business_id"</span>:<span class="string">"f9NumwFMBDn751xgFiRbNA"</span>,</span><br><span class="line">        <span class="string">"name"</span>:<span class="string">"The Range At Lake Norman"</span>,</span><br><span class="line">  <span class="string">"address"</span>:<span class="string">"10913 Bailey Rd"</span>,</span><br><span class="line"> <span class="string">"city"</span>:<span class="string">"Cornelius"</span>,</span><br><span class="line"> <span class="string">"state"</span>:<span class="string">"NC"</span>,</span><br><span class="line"> <span class="string">"postal_code"</span>:<span class="string">"28031"</span>,</span><br><span class="line"> <span class="string">"latitude"</span>:35.4627242,</span><br><span class="line"> <span class="string">"longitude"</span>:-80.8526119,</span><br><span class="line"> <span class="string">"stars"</span>:3.5,</span><br><span class="line"> <span class="string">"review_count"</span>:36,</span><br><span class="line"> <span class="string">"is_open"</span>:1,</span><br><span class="line"> <span class="string">"attributes"</span>:&#123;<span class="string">"BusinessAcceptsCreditCards"</span>:<span class="string">"True"</span>,<span class="string">"BikeParking"</span>:<span class="string">"True"</span>,<span class="string">"GoodForKids"</span>:<span class="string">"False"</span>,<span class="string">"BusinessParking"</span>:<span class="string">"&#123;'garage': False, 'street': False, 'validated': False, 'lot': True, 'valet': False&#125;"</span>,<span class="string">"ByAppointmentOnly"</span>:<span class="string">"False"</span>,<span class="string">"RestaurantsPriceRange2"</span>:<span class="string">"3"</span>&#125;,</span><br><span class="line"> <span class="string">"categories"</span>:<span class="string">"Active Life, Gun\/Rifle Ranges, Guns &amp; Ammo, Shopping"</span>,</span><br><span class="line"> <span class="string">"hours"</span>:&#123;<span class="string">"Monday"</span>:<span class="string">"10:0-18:0"</span>,</span><br><span class="line"> <span class="string">"Tuesday"</span>:<span class="string">"11:0-20:0"</span>,</span><br><span class="line"> <span class="string">"Wednesday"</span>:<span class="string">"10:0-18:0"</span>,</span><br><span class="line"> <span class="string">"Thursday"</span>:<span class="string">"11:0-20:0"</span>,</span><br><span class="line"> <span class="string">"Friday"</span>:<span class="string">"11:0-20:0"</span>,</span><br><span class="line"> <span class="string">"Saturday"</span>:<span class="string">"11:0-20:0"</span>,</span><br><span class="line"> <span class="string">"Sunday"</span>:<span class="string">"13:0-18:0"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æè¿°çš„å°±æ˜¯è¿™ä¸ªæ–‡æ¡£ä¸­æ‰€æœ‰æ•°æ®é›†ä¸­å…¶ä¸­çš„ä¸€æ¡æ•°æ®ã€‚<br>å¯ä»¥å‘ç°jsonæ•°æ®æ ¼å¼æ˜¯æŒ‰ç…§é”®å€¼å¯¹çš„å½¢å¼è¿›è¡Œå­˜å‚¨çš„ã€‚</p>
<ul>
<li>business_id ï¼š å•†ä¸šåº—é“ºçš„id,ç”¨æ¥å”¯ä¸€çš„æ ‡è¯†è¿™ä¸€ä¸ªå•†é“º</li>
<li>name : å•†ä¸šåº—é“ºçš„åç§°</li>
<li>address : å•†é“ºçš„ä½ç½®</li>
<li>city : åŸé•‡</li>
<li>state : å·å¿</li>
<li>postal_code : é‚®æ”¿ç¼–ç </li>
<li>latitude :çº¬åº¦</li>
<li>longitude :ç»åº¦</li>
<li>starts : æ˜Ÿçº§è¯„åˆ†</li>
<li>review_countï¼šè¯„è®ºæ•°</li>
<li>is_openï¼š å•†å®¶æ˜¯å¦è¥ä¸š</li>
<li>attributes ï¼šå•†å®¶æ‰€è¿›è¡Œçš„ä¸šåŠ¡</li>
<li>categories: ç±»åˆ«</li>
<li>hours : å•†å®¶çš„è¥ä¸šæ—¶é—´</li>
</ul>
<h3 id="ä¸»è¦ä»»åŠ¡"><a href="#ä¸»è¦ä»»åŠ¡" class="headerlink" title="ä¸»è¦ä»»åŠ¡"></a>ä¸»è¦ä»»åŠ¡</h3><ol>
<li>ç»Ÿè®¡å‡ºæ‰€æœ‰çš„å•†ä¸šç±»åˆ«ï¼Œå¹¶ä¸”è¿›è¡Œè®¡ç®—å‡ºå•†ä¸šç±»åˆ«çš„Top 10(categories)ã€‚</li>
<li>æ¯ä¸ªåŸå¸‚å„ç§å•†ä¸šç±»å‹çš„å•†å®¶æ•°é‡,å¹¶ä¸”è®¡ç®—å‡ºå•†å®¶æ•°é‡æœ€å¤šçš„åä¸ªåŸå¸‚(city,categories)ã€‚</li>
<li>æ¶ˆè´¹è€…è¯„ä»·æœ€å¤šçš„10ç§å•†ä¸šç±»åˆ«(review_count,categories)ã€‚</li>
<li>æœ€å—æ¶ˆè´¹è€…æ¬¢è¿çš„10ç§å•†ä¸šç±»åˆ«(starts)ã€‚</li>
<li>å•†ä¸šé¢å¤–ä¸šåŠ¡çš„è¯„ä»·æƒ…å†µã€‚</li>
</ol>
<h3 id="ä¸»è¦çš„è§£å†³æ­¥éª¤"><a href="#ä¸»è¦çš„è§£å†³æ­¥éª¤" class="headerlink" title="ä¸»è¦çš„è§£å†³æ­¥éª¤"></a>ä¸»è¦çš„è§£å†³æ­¥éª¤</h3><ol>
<li>ç¬¬ä¸€æ­¥ å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œå‰”é™¤å¼‚å¸¸å€¼</li>
<li>ç¬¬äºŒæ­¥ è¿›è¡Œæ•°æ®é›†çš„åˆ†æ</li>
<li>ç¬¬ä¸‰æ­¥ å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–åˆ†æ</li>
</ol>
<h2 id="ä»£ç è§£è¯»"><a href="#ä»£ç è§£è¯»" class="headerlink" title="ä»£ç è§£è¯»"></a>ä»£ç è§£è¯»</h2><h3 id="æ‰€éœ€è¦çš„åŒ…"><a href="#æ‰€éœ€è¦çš„åŒ…" class="headerlink" title="æ‰€éœ€è¦çš„åŒ…"></a>æ‰€éœ€è¦çš„åŒ…</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf,SparkContext</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">import</span> pyspark.sql.functions <span class="keyword">as</span> f</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure>
<ul>
<li><p>pyspark<br>PySpark æ˜¯ Spark ä¸º Python å¼€å‘è€…æä¾›çš„ API</p>
<ul>
<li>SparkContext<br>æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ï¼Œè´Ÿè´£è¿æ¥Sparké›†ç¾¤ã€‚é›†ç¾¤é€šè¿‡SparkContextè¿›è¡Œèµ„æºç®¡ç†å™¨çš„é€šä¿¡ä»¥åŠè¿›è¡Œèµ„æºçš„ç”³è¯·ã€ä»»åŠ¡çš„åˆ†é…å’Œç›‘æ§ï¼Œéœ€è¦ä»SparkSessionä¸­è·å¾—</li>
<li>SparkConf<br>åˆ›å»ºSparkContextå‰å¾—ä½¿ç”¨SparkConfè¿›è¡Œé…ç½®ï¼Œä»¥é”®å€¼å¯¹å½¢å¼è¿›è¡Œ</li>
</ul>
</li>
<li><p>pyspark.sql<br>ä¸€ç§è§£æä¼ ç»ŸSQLåˆ°å¤§æ•°æ®è¿ç®—æ¨¡å‹çš„å¼•æ“</p>
<ul>
<li>SparkSession<br>å…¶ä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„åˆ‡å…¥ç‚¹æ¥ä½¿ç”¨Sparkçš„å„é¡¹åŠŸèƒ½ï¼Œå¹¶ä¸”å…è®¸ç”¨æˆ·é€šè¿‡å®ƒè°ƒç”¨DataFrameå’ŒDatasetç›¸å…³APIæ¥ç¼–å†™Sparkç¨‹åº</li>
<li>DataFrameï¼ˆè¡¨ï¼‰æ˜¯Spark SQLå¯¹ç»“æ„åŒ–æ•°æ®çš„æŠ½è±¡ã€‚å¯ä»¥å°†DataFrameçœ‹åšRDD</li>
<li>Datasetæ˜¯æ•°æ®çš„åˆ†å¸ƒå¼é›†åˆ</li>
</ul>
</li>
<li>pyspark.sql.function<br>å¯ç”¨äºdataFramçš„å†…ç½®åŠŸèƒ½åˆ—è¡¨</li>
<li>os<br>ä¸»è¦æ˜¯é’ˆå¯¹æ“ä½œç³»ç»Ÿçš„åŒ…ï¼Œç”¨æ¥ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œåˆ›å»ºæ–‡ä»¶ç­‰ã€‚</li>
<li>json<br>Pythoné‡Œçš„jsonæ¨¡å—ä¸»è¦ç”¨äºâ€œPythonæ•°æ®ä¸JSONæ ¼å¼çš„æ•°æ®é—´ç›¸äº’è½¬æ¢â€</li>
<li>pandas<br>pandasæ˜¯ä¸€ä¸ªå¼ºå¤§çš„åˆ†æç»“æ„åŒ–æ•°æ®çš„å·¥å…·é›†ï¼›å®ƒçš„ä½¿ç”¨åŸºç¡€æ˜¯Numpyï¼ˆæä¾›é«˜æ€§èƒ½çš„çŸ©é˜µè¿ç®—ï¼‰ï¼›ç”¨äºæ•°æ®æŒ–æ˜å’Œæ•°æ®åˆ†æï¼ŒåŒæ—¶ä¹Ÿæä¾›æ•°æ®æ¸…æ´—åŠŸèƒ½ã€‚</li>
<li>matplotlib.pyplot<br>æ˜¯matlibçš„pythonç‰ˆå®ç°ï¼Œç”¨äºç»˜å›¾æ“ä½œã€‚</li>
</ul>
<h3 id="è·å–sparkæ“ä½œå¯¹è±¡"><a href="#è·å–sparkæ“ä½œå¯¹è±¡" class="headerlink" title="è·å–sparkæ“ä½œå¯¹è±¡"></a>è·å–sparkæ“ä½œå¯¹è±¡</h3><p>å»ºç«‹ä¸€ä¸ªä¼šè¯å¯¹è±¡<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å»ºç«‹é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#builderç”¨æ¥åˆ›å»ºä¸€ä¸ªSparksessionå®ä¾‹</span></span><br><span class="line"><span class="comment">#config é…ç½®ç›¸å…³</span></span><br><span class="line"><span class="comment">#getOrCreate æœ‰å°±è·å–æ²¡æœ‰å°±åˆ›å»º</span></span><br><span class="line">spark = SparkSession.builder.config(conf=SparkConf()).getOrCreate()</span><br></pre></td></tr></table></figure></p>
<h3 id="æ•°æ®æ¸…æ´—"><a href="#æ•°æ®æ¸…æ´—" class="headerlink" title="æ•°æ®æ¸…æ´—"></a>æ•°æ®æ¸…æ´—</h3><p>ä¸‹é¢å¯¹æ•°æ®æ¸…æ´— è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„åˆ†æã€‚ä¸»è¦å°†æ•°æ®ä¸­å­˜åœ¨å€¼ç¼ºå¤±çš„æ•°æ®ï¼Œå•†å®¶ä½ç½®é”™è¯¯çš„æ•°æ®ï¼ˆè¿™é‡Œå¯ä»¥ç§°ä¸ºç¦»ç¾¤å€¼ï¼‰è¿›è¡Œç­›é€‰ã€‚ä»£ç çš„è¯¦è§£è§£è¯»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®æ¸…æ´—</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_process</span><span class="params">(raw_data_path)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é€šè¿‡æ•°æ®è·¯å¾„ï¼Œè¯»å–æ•°æ®ï¼Œè¿™é‡Œæ˜¯jsonæ•°æ®</span></span><br><span class="line">    business = spark.read.json(raw_data_path)</span><br><span class="line">    <span class="comment">#split(str, pattern, limit=-1)</span></span><br><span class="line">    <span class="comment">#str â€“ æˆ‘ä»¬è¦åˆ†å‰²çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">#pattern åˆ†å‰²æ‰€ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    split_col = f.split(business[<span class="string">'categories'</span>], <span class="string">','</span>)</span><br><span class="line">    <span class="comment">#withColumn(colName, col)</span></span><br><span class="line">    <span class="comment">#withColumn è´Ÿè´£åœ¨åŸæœ‰è¡¨çš„åŸºç¡€ä¸Šæ–°æ·»åŠ ä¸€åˆ— colNameæ˜¯æ·»åŠ ä¸€åˆ—åçš„æ–°çš„åˆ—åï¼Œcolæ˜¯æ–°åˆ—çš„å€¼ ï¼Ÿåˆ—åä¸€æ ·ä¼šæ€ä¹ˆæ ·å¤„ç†ï¼ˆè¿™é‡Œåº”è¯¥æ˜¯ä¼šç›´æ¥æ›¿ä»£åŸæ¥çš„ï¼Œæœ‰å¾…éªŒè¯ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#filter ä½¿ç”¨ç»™å®šçš„æ¡ä»¶ è¿‡æ»¤è¡Œ è¿™é‡Œæ˜¯åœ¨æ‰€æœ‰çš„categoriesä¸­è¿‡æ»¤æ‰åŸå¸‚</span></span><br><span class="line">    <span class="comment"># dropna è‡³å°‘åˆä¸€ä¸ªç©ºç¼ºå€¼çš„è¡Œéƒ½ä¼šè¢«åˆ é™¤</span></span><br><span class="line">    business = business.withColumn(<span class="string">"categories"</span>, split_col).filter(business[<span class="string">"city"</span>] != <span class="string">""</span>).dropna()</span><br><span class="line">    <span class="comment">#åˆ›å»ºä¸€ä¸ªæ•°æ®çš„ä¸´æ—¶è§†å›¾ï¼Œè¿™ä¸ªè§†å›¾çš„å‘¨æœŸä¸sparkSessionç›¸å…³è”</span></span><br><span class="line">    business.createOrReplaceTempView(<span class="string">"business"</span>)</span><br><span class="line">    <span class="comment">#è§£æä¼ ç»Ÿçš„sqlåˆ°å¤§æ•°æ®è¿ç®—æ¨¡å‹ ç­›é€‰å‡ºæ‰€éœ€è¦çš„å†…å®¹</span></span><br><span class="line">    <span class="comment">#cache æŒ‰ç…§é»˜è®¤çš„å­˜å‚¨çº§åˆ« æŒä¹…åŒ–dataFrame</span></span><br><span class="line">    b_etl = spark.sql(<span class="string">"SELECT business_id, name, city, state, latitude, longitude, stars, review_count, is_open, categories, attributes FROM business"</span>).cache()</span><br><span class="line">    <span class="comment">#å°†ç­›é€‰å®Œçš„æ•°æ® åœ¨è¿›è¡Œä¸€ä¸ªä¸´æ—¶è§†å›¾ æ–¹ä¾¿ä¸‹ä¸€æ­¥çš„sqlåˆ†æ</span></span><br><span class="line">    b_etl.createOrReplaceTempView(<span class="string">"b_etl"</span>)</span><br><span class="line">    <span class="comment">#è¿™é‡Œæ˜¯ç­›é€‰æ‰ ç¦»ç¾¤å€¼ ï¼ˆè·ç¦»æ´²å†…å•†å®¶å¹³å‡ä½ç½®çš„æ¬§å¼è·ç¦»ï¼‰</span></span><br><span class="line">    <span class="comment">#b1 ä½œä¸ºbusinessçš„åŸå§‹æ•°æ®è¡¨ b2æ˜¯åœ¨åŸå§‹æ•°æ®è¡¨çš„åŸºç¡€ä¸Šè®¡ç®—æ¯ä¸ªå·å¿çš„å¹³å‡ ç»çº¬åº¦ ç„¶åè®¡ç®—æ¯ä¸€ä¸ªå•†å®¶åœ¨è¿™ä¸ªå·å¿çš„æ¬§å¼è·ç¦» å¹¶æ ¹æ®è®¡ç®—ç»“æœé™åºæ’åˆ—</span></span><br><span class="line">    outlier = spark.sql(</span><br><span class="line">        <span class="string">"SELECT b1.business_id, SQRT(POWER(b1.latitude - b2.avg_lat, 2) + POWER(b1.longitude - b2.avg_long, 2)) \</span></span><br><span class="line"><span class="string">        as dist FROM b_etl b1 INNER JOIN (SELECT state, AVG(latitude) as avg_lat, AVG(longitude) as avg_long \</span></span><br><span class="line"><span class="string">        FROM b_etl GROUP BY state) b2 ON b1.state = b2.state ORDER BY dist DESC"</span>)</span><br><span class="line">    <span class="comment">#åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸´æ—¶è§†å›¾ outlier</span></span><br><span class="line">    outlier.createOrReplaceTempView(<span class="string">"outlier"</span>)</span><br><span class="line">    <span class="comment">#ä»b_et1ä¸­ ç­›é€‰å‡ºæ‰€æœ‰çš„è·ç¦»å°äº10 çš„å€¼ã€‚è¿™å¯¹åº”åˆ°ç»çº¬åº¦ä¸Šé¢ å·²ç»æ˜¯æ¯”è¾ƒå¤§çš„å€¼äº†</span></span><br><span class="line">    joined = spark.sql(<span class="string">"SELECT b.* FROM b_etl b INNER JOIN outlier o ON b.business_id = o.business_id WHERE o.dist&lt;10"</span>)</span><br><span class="line">    <span class="comment">#å°†ç­›é€‰åçš„æ•°æ®è¿›è¡Œå­˜å‚¨ å­˜å‚¨ä¸ºparquetçš„æ ¼å¼</span></span><br><span class="line">    joined.write.parquet(<span class="string">"file:///home/hadoop/yelp-etl/business_etl"</span>, mode=<span class="string">"overwrite"</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="å†…å®¹è¡¥å……"><a href="#å†…å®¹è¡¥å……" class="headerlink" title="å†…å®¹è¡¥å……"></a>å†…å®¹è¡¥å……</h4><ol>
<li>parquet æ–‡ä»¶æ ¼å¼<br>parqueté‡‡ç”¨ä¸åŒçš„å‹ç¼©æ¯”ï¼Œèƒ½è¾¾åˆ°æœ‰æ•ˆçš„å‹ç¼©æ¯”ã€‚å‡å°‘ç£ç›˜çš„ä½¿ç”¨ã€‚<br>parquetç»“åˆsparkï¼Œå¯ä»¥å®Œç¾çš„å®ç°æ”¯æŒåˆ†åŒºè¿‡æ»¤ã€‚å¦‚ï¼Œéœ€è¦æŸä¸ªäº§å“æŸæ®µæ—¶é—´çš„æ•°æ®ï¼Œåˆ™hdfsåªå–è¿™ä¸ªæ–‡ä»¶å¤¹ã€‚<br>åˆ—ä¿®å‰ªï¼šå…¶å®è¯´ç®€å•ç‚¹å°±æ˜¯æˆ‘ä»¬è¦å–å›çš„é‚£äº›åˆ—çš„æ•°æ®</li>
<li>ç¦»ç¾¤å€¼<br>ç¦»ç¾¤å€¼(outlier)ï¼Œä¹Ÿç§°é€¸å‡ºå€¼ï¼Œæ˜¯æŒ‡åœ¨æ•°æ®ä¸­æœ‰ä¸€ä¸ªæˆ–å‡ ä¸ªæ•°å€¼ä¸å…¶ä»–æ•°å€¼ç›¸æ¯”å·®å¼‚è¾ƒå¤§.</li>
<li>withColumn(colName, col)<br>  è¿™é‡Œè¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­é—ç•™çš„ä¸€ä¸ªé—®é¢˜ï¼ŒwithColumnå¾€æ•°æ®é‡Œé¢æ‰§è¡Œæ·»åŠ æ“ä½œçš„æ—¶å€™ï¼Œå½“colNameçš„åå­—ä¸åŸè¡¨ä¸­çš„åå­—ä¸€æ ·çš„æ—¶å€™ï¼Œæ·»åŠ æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚</li>
</ol>
<h3 id="æ•°æ®åˆ†æ"><a href="#æ•°æ®åˆ†æ" class="headerlink" title="æ•°æ®åˆ†æ"></a>æ•°æ®åˆ†æ</h3><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦å¯¹æ¸…ç†åçš„æ•°æ®è¿›è¡Œåˆ†æã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">analysis</span><span class="params">(data_path)</span>:</span></span><br><span class="line">    <span class="comment"># è¯»å–æ¸…ç†åçš„æ•°æ®è·¯å¾„ï¼Œå­˜å‚¨çš„parqueæ•°æ®ï¼Œå¹¶æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­</span></span><br><span class="line">    business = spark.read.parquet(data_path).cache()</span><br><span class="line">    <span class="comment">#å°†æ–°çš„æ•°æ®å»ºç«‹ä¸€ä¸ªæ–°çš„è§†å›¾ business</span></span><br><span class="line">    business.createOrReplaceTempView(<span class="string">"business"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#ä»ä¸Šé¢å¤„ç†è¿‡çš„æ•°æ®ä¸­ï¼Œé€‰æ‹©å„ç§å•†ä¸šç±»åˆ«çš„æ´²å¿ã€åŸé•‡ã€æ˜Ÿçº§è¯„åˆ†ã€è¯„è®ºæ•°</span></span><br><span class="line">    <span class="comment">#explode åœ¨sqlè¯­å¥ä¸­ç”¨æ¥å¤„ç†arrayç±»å‹çš„æ•°æ®ã€‚</span></span><br><span class="line">    part_business = spark.sql(<span class="string">"SELECT state, city, stars,review_count, explode(categories) AS category FROM business"</span>).cache()</span><br><span class="line">    <span class="comment">#é»˜è®¤æ˜¾ç¤ºå‰ 20 è¡Œ å¹¶æç¤ºonly showing top 20 rows</span></span><br><span class="line">    part_business.show()</span><br></pre></td></tr></table></figure>
<p>Start analysis data!<br>+â€”â€“+â€”â€”â€”â€”â€”-+â€”â€“+â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€“+<br>|state|            city|stars|review_count|            category|<br>+â€”â€“+â€”â€”â€”â€”â€”-+â€”â€“+â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€“+<br>|   AZ|         Phoenix|  4.0|          41|            Notaries|<br>|   AZ|         Phoenix|  4.0|          41|     Mailbox Centers|<br>|   AZ|         Phoenix|  4.0|          41|   Printing Services|<br>|   AZ|         Phoenix|  4.0|          41|      Local Services|<br>|   AZ|         Phoenix|  4.0|          41|    Shipping Centers|<br>|   NV|       Las Vegas|  4.0|         681|         Restaurants|<br>|   NV|       Las Vegas|  4.0|         681|                Bars|<br>|   NV|       Las Vegas|  4.0|         681|           Nightlife|<br>|   NV|       Las Vegas|  4.0|         681|      American (New)|<br>|   NV|       Las Vegas|  4.0|         681|             Seafood|<br>|   QC|Vaudreuil-Dorion|  4.0|           7|                Food|<br>|   QC|Vaudreuil-Dorion|  4.0|           7|            Bakeries|<br>|   AZ|      Scottsdale|  3.5|           5|            Shopping|<br>|   AZ|      Scottsdale|  3.5|           5|       Home &amp; Garden|<br>|   AZ|      Scottsdale|  3.5|           5|          Mattresses|<br>|   NC|       Charlotte|  3.0|          64|                Gyms|<br>|   NC|       Charlotte|  3.0|          64|        Sports Clubs|<br>|   NC|       Charlotte|  3.0|          64|         Active Life|<br>|   NC|       Charlotte|  3.0|          64| Fitness &amp; Instruâ€¦|<br>|   ON|     Mississauga|  4.5|          12|         Restaurants|<br>+â€”â€“+â€”â€”â€”â€”â€”-+â€”â€“+â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€“+<br>only showing top 20 rows</p>
<p>ä¸Šè¿°å°±æ˜¯å¯¹å¤„ç†å®Œçš„æ•°æ®è¿›è¡Œä¸€ä¸ªæ˜¾ç¤ºä»¥åŠç­›é€‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å°†ç­›é€‰çš„å•†ä¸šç±»åˆ«çš„ç›¸å…³ä¿¡æ¯ åˆ›å»ºä¸€ä¸ªæ–°çš„è§†å›¾</span></span><br><span class="line">    part_business.createOrReplaceTempView(<span class="string">'part_business_1'</span>)</span><br><span class="line">    <span class="comment">#é€‰æ‹©æ´² åŸå¸‚ æ˜Ÿçº§è¯„å®šï¼Œè¯„è®ºæ•° </span></span><br><span class="line">    <span class="comment">#  REPLACE(category, ' ','')as new_category çš„å«ä¹‰æ˜¯å¯¹category è¿™ä¸€è¡Œè¿›è¡Œâ€˜â€™ æ›¿æ¢æˆâ€˜â€™ ç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ä»£è¡¨å•†å®¶ç±»åˆ«çš„åˆ—ï¼ˆç›¸å½“äºå¯¹è¿™ä¸€åˆ—çš„æ•°æ®è¿›è¡Œäº†ä¸€ä¸ªå¤‡ä»½ï¼‰</span></span><br><span class="line">    part_business = spark.sql(<span class="string">"SELECT state, city, stars, review_count, REPLACE(category, ' ','')as new_category FROM part_business_1"</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„è§†å›¾</span></span><br><span class="line">    part_business.createOrReplaceTempView(<span class="string">'part_business'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ‰€æœ‰çš„ä¸åŒçš„å•†å®¶ç±»åˆ«</span></span><br><span class="line">    print(<span class="string">"## All distinct categories"</span>)</span><br><span class="line">    <span class="comment"># ç­›é€‰æ‰€æœ‰ç§ç±»çš„å•†å®¶ åˆ†åˆ«æ˜¯å•†å®¶çš„id ä»¥åŠ å•†å®¶çš„ç§ç±»</span></span><br><span class="line">    all_categories = spark.sql(<span class="string">"SELECT business_id, explode(categories) AS category FROM business"</span>)</span><br><span class="line">    <span class="comment">#å°†ç­›é€‰å‡ºçš„æ•°æ®é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„è§†å›¾</span></span><br><span class="line">    all_categories.createOrReplaceTempView(<span class="string">'all_categories'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¥›é™¤é‡å¤çš„æ•°æ® å¹¶è®¡ç®—å‡ºæ‰€æœ‰ç§ç±»çš„ä¸ªæ•°</span></span><br><span class="line">    distinct = spark.sql(<span class="string">"SELECT COUNT(DISTINCT(new_category)) FROM part_business"</span>)</span><br><span class="line">    distinct.show()</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°è¿‡ç¨‹æ˜¯ç»Ÿè®¡å‡ºæ‰€æœ‰ç§ç±»çš„å•†å®¶ã€‚</p>
<p> All distinct categories<br>+â€”â€”â€”â€”â€”â€”â€”â€”â€”-+<br>|count(DISTINCT new_category)|<br>+â€”â€”â€”â€”â€”â€”â€”â€”â€”-+<br>|                        1318|<br>+â€”â€”â€”â€”â€”â€”â€”â€”â€”-+</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"## Top 10 business categories"</span>)</span><br><span class="line">    <span class="comment">#ç»Ÿè®¡å‡ºæ²¡ç§ç§ç±»çš„å•†å®¶çš„ä¸ªæ•° å¹¶ä¸”æŒ‰ç…§é™åºæ’åˆ—</span></span><br><span class="line">    top_cat = spark.sql(<span class="string">"SELECT new_category, COUNT(*) as freq FROM part_business GROUP BY new_category ORDER BY freq DESC"</span>)</span><br><span class="line">    <span class="comment">#æ˜¾ç¤ºå‡ºæ’åå‰10çš„å•†å®¶çš„ç§ç±»</span></span><br><span class="line">    top_cat.show(<span class="number">10</span>) </span><br><span class="line">    <span class="comment">#å°†ç»Ÿè®¡å‡ºçš„æ•°æ® å­˜å‚¨ä¸º jsonæ–‡ä»¶</span></span><br><span class="line">    top_cat.write.json(<span class="string">"file:///usr/local/spark/yelp/analysis/top_category"</span>, mode=<span class="string">'overwrite'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201023212023388.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨æ¯ä¸ªåŸå¸‚ä¸­å•†ä¸šç§ç±»çš„ä¸ªæ•° ä»…æŒ‰ç…§å•†ä¸šç§ç±»çš„ä¸ªæ•°æ˜¾ç¤º å‰20æ¡ </span></span><br><span class="line">   print(<span class="string">"## Top business categories - in every city"</span>)</span><br><span class="line">   top_cat_city = spark.sql(<span class="string">"SELECT city, new_category, COUNT(*) as freq FROM part_business GROUP BY city, new_category ORDER BY freq DESC"</span>)</span><br><span class="line">   top_cat_city.show()  </span><br><span class="line">   <span class="comment">#å°†æ•°æ®å­˜å‚¨åˆ°jsonä¸­</span></span><br><span class="line">   top_cat.write.json(<span class="string">"file:///usr/local/spark/yelp/analysis/top_category_city"</span>, mode=<span class="string">'overwrite'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•†ä¸šæ•°é‡æœ€å¤šçš„åŸå¸‚</span></span><br><span class="line">    print(<span class="string">"## Cities with most businesses"</span>)</span><br><span class="line">    bus_city = spark.sql(<span class="string">"SELECT city, COUNT(business_id) as no_of_bus FROM business GROUP BY city ORDER BY no_of_bus DESC"</span>)</span><br><span class="line">    bus_city.show(<span class="number">10</span>)   </span><br><span class="line">    bus_city.write.json(<span class="string">"file:///usr/local/spark/yelp/analysis/top_business_city"</span>, mode=<span class="string">'overwrite'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201023212642926.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¯ç§å•†ä¸šç§ç±»çš„ å¹³å‡è¯„è®ºæ•° </span></span><br><span class="line">    print(<span class="string">"## Average review count by category"</span>)</span><br><span class="line">    avg_city = spark.sql(</span><br><span class="line">        <span class="string">"SELECT new_category, AVG(review_count)as avg_review_count FROM part_business GROUP BY new_category ORDER BY avg_review_count DESC"</span>)</span><br><span class="line">    avg_city.show()  </span><br><span class="line">    avg_city.write.json(<span class="string">"file:///usr/local/spark/yelp/analysis/average_review_category"</span>, mode=<span class="string">'overwrite'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201023212832651.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œå…¶å®ä¹Ÿæ˜¯æ˜¾ç¤ºäº†20è¡Œï¼Œå°±ä¸æˆªå›¾å¤ªå¤šäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¯ç§å•†ä¸šç±»åˆ«çš„ å¹³å‡æ˜Ÿçº§æ°´å¹³</span></span><br><span class="line">    print(<span class="string">"## Average stars by category"</span>)</span><br><span class="line">    avg_state = spark.sql(</span><br><span class="line">        <span class="string">"SELECT new_category, AVG(stars) as avg_stars FROM part_business GROUP BY new_category ORDER BY avg_stars DESC"</span>)</span><br><span class="line">    avg_state.show()   </span><br><span class="line">    avg_state.write.json(<span class="string">"file:///usr/local/spark/yelp/analysis/average_stars_category"</span>, mode=<span class="string">'overwrite'</span>)</span><br></pre></td></tr></table></figure>
<p>ç”±äºå­—æ®µ attribute ä¸­çš„RestaurantsTakeoutå¯èƒ½NULLçš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨dropna()å¤„ç†ç¼ºå¤±å€¼çš„é—®é¢˜ã€‚è¯¥é¡¹å¯¹å•†å®¶æ˜¯å¦æœ‰â€™Take outâ€™æœåŠ¡è¿›è¡Œåˆ†æï¼Œç»Ÿè®¡å‡ºä¸¤ç§ä¸åŒæƒ…å†µçš„å•†å®¶çš„å¹³å‡æ˜Ÿçº§è¯„åˆ†.å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•†å®¶æ‰€è¿›è¡Œçš„ä¸šåŠ¡åˆ†æ</span></span><br><span class="line">    print(<span class="string">"## Data based on Attribute"</span>)</span><br><span class="line">    <span class="comment">#ä»…ç­›é€‰å‡º å•†å®¶æ‰€è¿›è¡Œçš„ä¸šåŠ¡ï¼Œæ˜Ÿçº§ï¼Œä»¥åŠåˆ’åˆ†åˆ°çš„å•†ä¸šç±»åˆ«</span></span><br><span class="line">    for_att = spark.sql(<span class="string">"SELECT attributes, stars, explode(categories) AS category FROM business"</span>)</span><br><span class="line">    <span class="comment">#å°†ç­›é€‰å‡ºçš„æ•°æ® åˆ›å»ºä¸€ä¸ªæ–°çš„è§†å›¾</span></span><br><span class="line">    for_att.createOrReplaceTempView(<span class="string">"for_att"</span>)</span><br><span class="line">    <span class="comment">#å¯¹ å•†å®¶æ˜¯å¦ æœ‰å¤–å–è¿™ä¸ª ä¸šåŠ¡è¿›è¡Œåˆ†æ</span></span><br><span class="line">    attribute = <span class="string">'RestaurantsTakeout'</span></span><br><span class="line">    attribute_score(attribute)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attribute_score</span><span class="params">(attribute)</span>:</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„format è¡¨ç¤ºç”¨attributeçš„å€¼ä»£æ›¿attrçš„å€¼</span></span><br><span class="line">    att = spark.sql(<span class="string">"SELECT attributes.&#123;attr&#125; as &#123;attr&#125;, category, stars FROM for_att"</span>.format(attr=attribute)).dropna()</span><br><span class="line">    att.createOrReplaceTempView(<span class="string">"att"</span>)</span><br><span class="line">    att_group = spark.sql(<span class="string">"SELECT &#123;attr&#125;, AVG(stars) AS stars FROM att GROUP BY &#123;attr&#125; ORDER BY stars"</span>.format(attr=attribute))</span><br><span class="line">    att_group.show()    </span><br><span class="line">    att_group.write.json(<span class="string">"file:///usr/local/spark/yelp/analysis/&#123;attr&#125;"</span>.format(attr=attribute), mode=<span class="string">'overwrite'</span>)</span><br></pre></td></tr></table></figure></p>
<p>åˆ°è¿™é‡Œæ‰€æœ‰çš„æ•°æ®åˆ†æçš„ä»£ç å°±è®²è§£å®Œäº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¯¹äºæˆ‘ä»¬ç»Ÿè®¡å‡ºæ¥çš„è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬é‚£å¦‚ä½•æ›´ç›´è§‚çš„æŸ¥çœ‹ã€‚ä¹Ÿå°±æ˜¯æ•°æ®çš„å¯è§†åŒ–</p>
<h3 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h3><p>è¿™é‡Œæˆ‘ä»¬è¿›è¡Œçš„æ•°æ®å¯è§†åŒ–æ˜¯é€šè¿‡ pythonä¸­çš„matlibåŒ…è¿›è¡Œç»˜å›¾è¡¨ç¤ºçš„ã€‚</p>
<h4 id="æ•°æ®çš„è¯»å–"><a href="#æ•°æ®çš„è¯»å–" class="headerlink" title="æ•°æ®çš„è¯»å–"></a>æ•°æ®çš„è¯»å–</h4><p>æˆ‘ä»¬å…ˆå°†ä¸Šé¢å·²ç»åˆ†æè¿‡çš„æ•°æ®å¹¶å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ®è·¯å¾„è‡ªå®šä¹‰ã€‚ï¼ˆè¿™ä¸€å—ç³»ç»Ÿå¯æ˜¯æ— æ³•è‡ªå·±æ‰¾åˆ°ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AVE_REVIEW_CATEGORY = <span class="string">'/usr/local/spark/yelp/analysis/average_review_category'</span></span><br><span class="line">TOP_CATEGORY_CITY = <span class="string">'/usr/local/spark/yelp/analysis/top_category_city'</span></span><br><span class="line">TOP_BUSINESS_CITY = <span class="string">'/usr/local/spark/yelp/analysis/top_business_city'</span></span><br><span class="line">TOP_CATEGORY = <span class="string">'/usr/local/spark/yelp/analysis/top_category'</span></span><br><span class="line">AVE_STARS_CATEGORY = <span class="string">'/usr/local/spark/yelp/analysis/average_stars_category'</span></span><br><span class="line">TAKEOUT = <span class="string">'/usr/local/spark/yelp/analysis/RestaurantsTakeout'</span></span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰æ•°æ®è¯»å–çš„å‡½æ•°"><a href="#å®šä¹‰æ•°æ®è¯»å–çš„å‡½æ•°" class="headerlink" title="å®šä¹‰æ•°æ®è¯»å–çš„å‡½æ•°"></a>å®šä¹‰æ•°æ®è¯»å–çš„å‡½æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_json</span><span class="params">(file_path)</span>:</span></span><br><span class="line">    <span class="comment">#è¯»å–è¿™ä¸ªè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶çš„åç§°</span></span><br><span class="line">    json_path_names = os.listdir(file_path)</span><br><span class="line">    data = []</span><br><span class="line">    <span class="comment">#éå†æ‰€æœ‰çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> range(len(json_path_names)):</span><br><span class="line">        <span class="comment">#æ‹¼æ¥è·¯å¾„åç§°</span></span><br><span class="line">        json_path = file_path + <span class="string">'/'</span> + json_path_names[idx]</span><br><span class="line">        <span class="comment">#åˆ¤æ–­æ–‡ä»¶æ˜¯ä¸æ˜¯jsonæ–‡ä»¶ å¦‚æœæ˜¯çš„è¯ å°±æ‰“å¼€è¯»å–</span></span><br><span class="line">        <span class="keyword">if</span> json_path.endswith(<span class="string">'.json'</span>):</span><br><span class="line">            <span class="keyword">with</span> open(json_path) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="comment">#å°†è¯»å–çš„æ•°æ®æ‹¼æ¥åˆ°dataä¸­ è¿”å›è¯»å–åˆ°çš„æ•°æ®</span></span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                    data.append(json.loads(line))</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>
<p>è·å¾—è¯»å–çš„æ‰€æœ‰çš„æ•°æ® </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ave_review_category_list = read_json(AVE_REVIEW_CATEGORY)</span><br><span class="line">open_close_list = read_json(OPEN_CLOSE)</span><br><span class="line">top_category_city_list = read_json(TOP_CATEGORY_CITY)</span><br><span class="line">top_business_city_list = read_json(TOP_BUSINESS_CITY)</span><br><span class="line">top_category_list = read_json(TOP_CATEGORY)</span><br><span class="line">ave_stars_category_list = read_json(AVE_STARS_CATEGORY)</span><br><span class="line">takeout_list = read_json(TAKEOUT)</span><br></pre></td></tr></table></figure>
<h4 id="ä¸‹é¢æ˜¯æ•°æ®çš„å›¾å½¢åŒ–å±•ç¤º"><a href="#ä¸‹é¢æ˜¯æ•°æ®çš„å›¾å½¢åŒ–å±•ç¤º" class="headerlink" title="ä¸‹é¢æ˜¯æ•°æ®çš„å›¾å½¢åŒ–å±•ç¤º"></a>ä¸‹é¢æ˜¯æ•°æ®çš„å›¾å½¢åŒ–å±•ç¤º</h4><p>å¯¹äºè¿™ä¸€éƒ¨åˆ†ï¼Œå¯¹ä¸€éƒ¨åˆ†è¿›è¡Œè®²è§£ï¼Œå› ä¸ºå…¶ä½™çš„å›¾å½¢çš„ç»˜ç”» çš„æ€è·¯æ˜¯ä¸€æ ·çš„ã€‚ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œåœ¨äºç”»å›¾çš„è¯­æ³•ä¸ä¸€æ ·ã€‚ï¼ˆè¿™é‡Œå¯ä»¥è‡ªè¡Œå­¦ä¹ ï¼‰<br><a href="https://matplotlib.org/gallery/index.html" target="_blank" rel="noopener">å­¦ä¹ é“¾æ¥ï¼ˆmarplotlibç”»å›¾ï¼‰</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨æ¯ä¸ªåŸå¸‚ä¸­å•†ä¸šç§ç±»çš„ä¸ªæ•° ä»…æŒ‰ç…§å•†ä¸šç§ç±»çš„ä¸ªæ•°æ˜¾ç¤º å‰10æ¡ æ ¹æ®å•†ä¸šç§ç±»å‡ºç°çš„æ¬¡æ•°è¿›è¡Œ æ’å ä»å°åˆ°å¤§</span></span><br><span class="line">    top_category_list.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">'freq'</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#å•†ä¸šç§ç±»çš„åç§°</span></span><br><span class="line">    top_category_key = []</span><br><span class="line">    <span class="comment">#å•†ä¸šç§ç±»çš„ç»Ÿè®¡ä¸ªæ•°</span></span><br><span class="line">    top_category_value = []</span><br><span class="line">    <span class="comment">#æ•°æ®å¡«å……</span></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        one = top_category_list[idx]</span><br><span class="line">        top_category_key.append(one[<span class="string">'new_category'</span>])</span><br><span class="line">        top_category_value.append(one[<span class="string">'freq'</span>])</span><br><span class="line">    <span class="comment">#ç»˜åˆ¶æ¡å½¢å›¾ æˆªå–å‰10å</span></span><br><span class="line">    plt.barh(top_category_key[:<span class="number">10</span>], top_category_value[:<span class="number">10</span>], tick_label=top_category_key[:<span class="number">10</span>])</span><br><span class="line">    <span class="comment">#æ ‡é¢˜</span></span><br><span class="line">    plt.title(<span class="string">'Top 10 Categories'</span>, size = <span class="number">16</span>)</span><br><span class="line">    <span class="comment">#x çš„labelä¸ºFrequency æ¡å½¢å›¾çš„å®½åº¦ä¸º 8 é¢œè‰² black</span></span><br><span class="line">    plt.xlabel(<span class="string">'Frequency'</span>,size =<span class="number">8</span>, color = <span class="string">'Black'</span>)</span><br><span class="line">    plt.ylabel(<span class="string">'Category'</span>,size = <span class="number">8</span>, color = <span class="string">'Black'</span>)</span><br><span class="line">    <span class="comment"># ä¼šè‡ªåŠ¨å¡«å……å­å›¾å‚æ•° è®©å­å›¾èƒ½å¤Ÿå¡«å……æ•´ä¸ªå›¾åƒåŒºåŸŸã€‚ï¼ˆä»…ä»…æ£€æŸ¥ åæ ‡è½´çš„æ ‡ç­¾ï¼Œåˆ»åº¦æ ‡ç­¾ä»¥åŠæ ‡é¢˜çš„éƒ¨åˆ†ï¼‰</span></span><br><span class="line">    plt.tight_layout()</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201024111407659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><img src="https://img-blog.csdnimg.cn/20201024112306697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™æ ·æ˜¯ä¸æ˜¯çœ‹èµ·æ¥å°±æ›´åŠ ç›´è§‚äº†å‘¢ï¼</p>
<p>æ˜¾ç¤ºçš„å›¾ç‰‡ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œæˆ–è€…æ ‡é¢˜çš„å­—ä½“æ ¼å¼ç­‰ä¹Ÿæ˜¯å¯ä»¥è°ƒçš„ï¼Œè¿™é‡Œå°±ä¸åœ¨è¯¦ç»†çš„ä»‹ç»äº†ã€‚</p>
<p>æºç å°±å­˜åœ¨æˆ‘çš„jupyterä¸Šäº†ï¼ˆä¸è¿‡éœ€è¦æˆ‘å¼€å¯æœåŠ¡å™¨æ‰å¯ä»¥è®¿é—®ï¼‰<a href="http://www.itgorge.ltd:8888/notebooks/PYSparkTest.ipynb" target="_blank" rel="noopener">æºç </a></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2020/10/16/å¤§æ•°æ®åˆ†æä¹‹é˜¿é‡Œäº‘å®‰è£…Spark/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">å¤§æ•°æ®åˆ†æä¹‹é˜¿é‡Œäº‘å®‰è£…Spark</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£" data-title="emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£" data-url="http://yoursite.com/2020/10/24/emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£/" data-images="../../photo/head.jpg" data-content="emmm-sparkå•†ä¸šæ•°æ®åˆ†ææ¡ˆä¾‹è®²è§£">
    <div class="ds-share-inline">
      <ul class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">åˆ†äº«åˆ°ï¼š</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">å¾®åš</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQç©ºé—´</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">è…¾è®¯å¾®åš</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">å¾®ä¿¡</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2020 Gorge
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>