<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Gorge</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Gorge">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Gorge">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Gorge">
  
    <link rel="alternative" href="/atom.xml" title="Gorge" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
      <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("your app_id", "your app_key");</script>
<script src="/js/Counter.js"></script>
  
</head></html>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="../../photo/head.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">He Zhang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">欢迎呀</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="https://me.csdn.net/qq_39536716">CSDN</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="zhihu" target="_blank" href="/1660047480" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="/1660047480@qq.com" title="mail">mail</a>
					        
								<a class="qq" target="_blank" href="/1660047480@qq.com" title="qq">qq</a>
					        
								<a class="weibo" target="_blank" href="/1660047480@qq.com" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">He Zhang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="../../photo/head.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">He Zhang</h1>
			</hgroup>
			
			<p class="header-subtitle">欢迎呀</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="https://me.csdn.net/qq_39536716">CSDN</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="zhihu" target="_blank" href="/1660047480" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="/1660047480@qq.com" title="mail">mail</a>
			        
						<a class="qq" target="_blank" href="/1660047480@qq.com" title="qq">qq</a>
			        
						<a class="weibo" target="_blank" href="/1660047480@qq.com" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-类的加载机制与反射机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/01/02/类的加载机制与反射机制/" class="article-date">
  	<time datetime="2021-01-02T11:20:46.830Z" itemprop="datePublished">2021-01-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/02/类的加载机制与反射机制/">
        类的加载机制与反射机制
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JVM和类"><a href="#JVM和类" class="headerlink" title="JVM和类"></a>JVM和类</h1><p>Java命令运行某一个Java程序的时候，该命令将会启动一个Java虚拟机进程，不管该Java程序多么复杂，都处于JVM虚拟机里面，所有的线程、所有的变量都处于同一个进程里面。</p>
<p>JVM终止的条件：</p>
<ul>
<li>程序正常运行结束</li>
<li>遇到未捕获的异常或错误而结束</li>
<li>平台强制结束了JVM</li>
<li>运行的时候使用了System.exit()和Runtime.getRuntime().exit()代码 处结束程序</li>
</ul>
<h2 id="类的加载或初始化"><a href="#类的加载或初始化" class="headerlink" title="类的加载或初始化"></a>类的加载或初始化</h2><p>如果该类还没有被加载到内存中，则系统会通过加载、连接、初始化三个步骤来对该程序进行初始化。</p>
<h3 id="类加载"><a href="#类加载" class="headerlink" title="类加载"></a>类加载</h3><p>类的加载是指<em>类加载器</em>将类的class文件读入内存，并为之创建一个java.lang.Class对象，也就是说，当程序使用任何类的时候，系统都会为之创建一个java.lang.Class对象。</p>
<p>class是作为类的二进制数据，通常有以下几种来源：</p>
<ul>
<li>本地系统加载class文件</li>
<li>从jar包 加载class 文件</li>
<li>通过网络加载class文件</li>
<li>把一个java源文件动态编译，并执行加载<br>类加载器通常无须等到使用的时候才加载，虚拟机规范允许系统预先加载某些类</li>
</ul>
<h3 id="类的连接"><a href="#类的连接" class="headerlink" title="类的连接"></a>类的连接</h3><p>当类被加载之后，系统会为之生成一个对应的Class对象，接着将会进入连接阶段，连接阶段负责把类的二进制数据合并到JRE中。<br>类的连接分为 下面三个阶段：</p>
<ul>
<li>验证：验证阶段用于检验被加载的类是否有正确的内部结构，并和其他类协调一致</li>
<li>准备： 类准备阶段则负责为类的静态Field分配内存，并设置默认初始值</li>
<li>解析：将类的二进制数据中的符号引用替换成直接引用。</li>
</ul>
<h3 id="类的初始化"><a href="#类的初始化" class="headerlink" title="类的初始化"></a>类的初始化</h3><p>类的初始化阶段，虚拟机负责对类进行初始化，主要就是对静态Field进行初始化。在Java类中对静态Field指定初始值有两种方式：</p>
<ul>
<li>声明静态Field时指定初始值</li>
<li>使用静态初始化块为静态Field指定初始值<br>静态初始化块都将被当成类的初始化语句<br>类的初始化的步骤：</li>
</ul>
<ol>
<li>先判断一下某一个类是不是加载和连接，先进行加载和连接操作</li>
<li>判断该类的直接父类有没有被初始化，先初始化其父类。每次先初始化的都是Object类</li>
<li>假如类中有初始化语句，则系统依次执行这些初始化语句<h3 id="类初始化的时机"><a href="#类初始化的时机" class="headerlink" title="类初始化的时机"></a>类初始化的时机</h3></li>
</ol>
<ul>
<li>创建类的实例（new,反射,反序列化）</li>
<li>调用某个类的静态方法</li>
<li>使用某个类或者接口的静态Field ，或者为该Field进行赋值</li>
<li>使用反射方式来强制创建某个类的或者接口的对应java.lang.Class 对象。</li>
<li>初始化某个类的子类</li>
<li>直接使用java.exe 命令来运行某个主类<h2 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h2>类加载器负责将class文件加载到内存中，并且为之生成对应的java.lang.Class对象。开发中很少用到类加载机制，但是了解这个机制，能更好的满足我们的需求。<br>一个类只要加载进JVM过一次，就不会在加载。同一个类的定义为（包名-类名）作为标识是一样的。一个对象的唯一标识使用的，同一个类+ 类加载器的编号。只有这三个全部相同了才能属于同一个类。<br>当JVM启动的时候，会形成3个类加载器组成的初始类加载器层次结构。</li>
<li>Bootstrap ClassLoader:根类加载器<br> 负责加载java的核心类。</li>
<li>Extension ClassLoader: 扩展类加载器<br> 扩展类加载器负责加载JRE的扩展项目中JAR包的类，通过这种方式，就可以为JAVA扩展核心类以外的新功能，只要我们将自己开发的类打包成JAR包，然后放入JAVA_HOME/jre/lib/ext 路径即可。</li>
<li>System ClassLoader:系统类加载器<br> 他负责在JVM启动的时候加载来自java命令的-classpath选项、java.class.path系统属性，或者CLASSPATH环境变量所指定的JAR包和类的路径。<h3 id="类加载机制"><a href="#类加载机制" class="headerlink" title="类加载机制"></a>类加载机制</h3>JVM的类加载机制主要有如下3种：</li>
<li>全盘负责<br> 就是当一个类加载器负责加载某个Class的时候，该Class所依赖的和引用的其他Class 也将由该类负责载入。</li>
<li>父类委托<br>先让parent(父)类加载器试图加载该Class,只有在父类加载器无法加载该类的时候才尝试从自己的类路径中加载该类。</li>
<li>缓存机制<br>缓存机制将会保证所有加载过的Class 都会被缓存，当程序中需要使用某个Class的时候，类加载器先从缓存中搜寻该Class，只有当缓存区不存在该class对象的时候，系统才会读取该类对应的二进制数据，并将其转换成Class对象，存入缓存区。<h4 id="自定义类加载器"><a href="#自定义类加载器" class="headerlink" title="自定义类加载器"></a>自定义类加载器</h4>开发者通过扩展ClassLoader的子类，并重写该ClassLoader所包含的方法来实现自定义的类加载器。可以实现如下功能：</li>
<li>执行代码之前自动验证数字签名</li>
<li>根据用户提供的密码解密代码，从而实现代码混淆来避免反编译Class文件</li>
<li>根据用户需求来动态的加载类</li>
<li>根据应用需求把其他数据以字节码的形式加载到应用中<h4 id="URLClassLoader类"><a href="#URLClassLoader类" class="headerlink" title="URLClassLoader类"></a>URLClassLoader类</h4>通过该类既可以从本地文件系统获取二进制文件来加载该类，也可以从远程主机获取二进制文件来加载该类。<br>主要提供了两构造器：</li>
<li>URLClassLoader(URL[] urls):使用默认的父类加载器创建一个ClassLoader对象，该对象将从urls所指定的系列路径来查询并加载类</li>
<li>URLClassLoader(URL[] urls ,ClassLoader parent) 使用指定的父类加载器创建一个ClassLoader对象<ul>
<li>URL file前缀表示从本地文件系统加载</li>
<li>http 前缀表示从互联网通过HTTP 加载访问来加载</li>
<li>ftp 为前缀 表明从互联网通过ftp 访问加载<h3 id="通过反射查看类的信息"><a href="#通过反射查看类的信息" class="headerlink" title="通过反射查看类的信息"></a>通过反射查看类的信息</h3>程序在运行时会出现两种类型，运行时类型与编译时类型。程序在运行的时候接收到外部传入的一个对象，该对象的编译时类型时Object,但是程序又需要调用该对象运行时类型的方法，为了在运行的时候发现对象和类的真实信息，可以通过下面两种方法：</li>
</ul>
</li>
<li>假设在编译时和运行时完全知道类型的具体信息，这种情况下可以通过使用instanceof运算符进行判断，在进行强制类型转换。</li>
<li>在编译的时候根本无法知道该对象和类属于哪些类，程序只能通过运行时信息来发现该对象和类的真实信息，就必须使用反射。<h4 id="获取Class-对象"><a href="#获取Class-对象" class="headerlink" title="获取Class 对象"></a>获取Class 对象</h4></li>
<li>使用Class 类的forName(String clazzName) 静态方法。该方法需要传入字符串参数，该字符串参数的值是某个类的全限定类名</li>
<li>调用某个类的class属性来获取该类对应的Class 对象例如：Person.class</li>
<li>调用某个对象的getClass()方法。该方法是java.lang.Object 类的一个方法</li>
<li>调用某个对象的getClass()方法，该方法是java.lang.Object类中的一个方法，所以所有的java对象都可以调用该方法。<br>前两种都是根据类来获取指定类的Class对象，第二种方法有如下优点：</li>
<li>安全性。程序在编译阶段就可以检查Class对象是不是存在</li>
<li>程序的性能更好。因为无需调用方法，因此性能更好<h4 id="从class中获取信息"><a href="#从class中获取信息" class="headerlink" title="从class中获取信息"></a>从class中获取信息</h4>Class类提供了大量的实例方法来获取该Class对象所对应的详细信息，主要使用方式查询API。<br>获取构造器的时候无须传入构造器名-同一个类的所有构造器的名字都是相同，所以要确定一个构造器只要指定形参列表即可。<h3 id="使用反射生成并操作对象"><a href="#使用反射生成并操作对象" class="headerlink" title="使用反射生成并操作对象"></a>使用反射生成并操作对象</h3><h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4>通过反射生成对象有两种方式：</li>
<li>使用Class对象的newInstance()方法来创建该Class对象对应类的实例，这种方式要求该Class必须要实现默认的构造器</li>
</ul>
<p>根据配置文件创建 对象池<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Tool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">	<span class="comment">//定义一个对象池，前面是对象名，后面是实际的对象</span></span><br><span class="line">	<span class="keyword">private</span>	Map&lt;String, Object&gt; objectPool = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">	<span class="comment">//定一个创建对象的方法</span></span><br><span class="line">	<span class="comment">//该对象只要传入一个字符串类名，程序可以根据该类名生成Java对象</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">createObject</span> <span class="params">(String clazzName)</span> </span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">		Class&lt;?&gt; clazz = Class.forName(clazzName);</span><br><span class="line">		<span class="comment">//使用clazz 默认的构造器创建实例</span></span><br><span class="line">		<span class="keyword">return</span> clazz.newInstance();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//该方法根据指定文件来初始化对象池</span></span><br><span class="line">	<span class="comment">//根据配置文件来创建对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initPool</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			FileInputStream fis  = <span class="keyword">new</span> FileInputStream(fileName);</span><br><span class="line">			Properties pr = <span class="keyword">new</span> Properties();</span><br><span class="line">			pr.load(fis);</span><br><span class="line">			<span class="keyword">for</span>(String name : pr.stringPropertyNames()) &#123;</span><br><span class="line">				System.out.println(name);</span><br><span class="line">				<span class="comment">//每取出一对 key-value对就根据value创建一个对象，根据对象值 填充到对象池中</span></span><br><span class="line">				objectPool.put(name,createObject(pr.getProperty(name)));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			System.out.println(<span class="string">"读取"</span>+fileName+<span class="string">"异常"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> objectPool.get(name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	test pf = <span class="keyword">new</span> test();</span><br><span class="line">	pf.initPool(<span class="string">"./src/instance.properties"</span>);</span><br><span class="line">	Object x1 = pf.getObject(<span class="string">"a"</span>);</span><br><span class="line">	Object x2 = pf.getObject(<span class="string">"b"</span>);</span><br><span class="line">	System.out.println(x1.equals(x2));</span><br><span class="line">	<span class="comment">//System.out.println(pf.getObject("b"));</span></span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>先使用Class对象获取指定的Constructor对象，在调用Constructor对象的newInstance()方法来创建该对象对应的实例。<br>如果不想利用默认构造器来创建java对象，而是使用指定的构造器来创建java对象，则需要利用Constructor对象，每一个Constructor对应一个构造器。<br>这个的使用步骤为：<ul>
<li>首先获得一个类的Class</li>
<li>通过Class获取该类对应的constructor</li>
<li>调用Constructor的newInstance()方法来创建Java对象。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取class对象</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Class&lt;?&gt; cla = Class.forName(<span class="string">"javax.swing.JFrame"</span>);</span><br><span class="line">		Constructor con = cla.getConstructor(String.class);</span><br><span class="line">		<span class="comment">//调用方法创建对象</span></span><br><span class="line">		Object obj = con.newInstance(<span class="string">"ceshi"</span>);</span><br><span class="line">		System.out.println(obj);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>第一种方式来创建对象是比较常见的方式，因为在java中很多都是通过读取配置文件信息来创建java对象的。</p>
<h4 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h4><p>当获得某个类对应的Class对象后，就可以通过该Class对象的getMethods()方法或者getMethod()方法来获取全部方法或者指定方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Tool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">	<span class="comment">//定义一个对象池，前面是对象名，后面是实际的对象</span></span><br><span class="line">	<span class="keyword">private</span>	Map&lt;String, Object&gt; objectPool = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">	<span class="keyword">private</span> Properties pr = <span class="keyword">new</span> Properties();</span><br><span class="line">	<span class="comment">//定一个创建对象的方法</span></span><br><span class="line">	<span class="comment">//该对象只要传入一个字符串类名，程序可以根据该类名生成Java对象</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">createObject</span> <span class="params">(String clazzName)</span> </span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">		Class&lt;?&gt; clazz = Class.forName(clazzName);</span><br><span class="line">		<span class="comment">//使用clazz 默认的构造器创建实例</span></span><br><span class="line">		<span class="keyword">return</span> clazz.newInstance();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//该方法根据指定文件来初始化对象池</span></span><br><span class="line">	<span class="comment">//根据配置文件来创建对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initPool</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			FileInputStream fis  = <span class="keyword">new</span> FileInputStream(fileName);</span><br><span class="line">			</span><br><span class="line">			pr.load(fis);</span><br><span class="line">			<span class="keyword">for</span>(String name : pr.stringPropertyNames()) &#123;</span><br><span class="line">				System.out.println(name);</span><br><span class="line">				<span class="comment">//每取出一对 key-value对就根据value创建一个对象，根据对象值 填充到对象池中</span></span><br><span class="line">				<span class="keyword">if</span>(!name.contains(<span class="string">"%"</span>)) &#123;</span><br><span class="line">					objectPool.put(name,createObject(pr.getProperty(name)));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			System.out.println(<span class="string">"读取"</span>+fileName+<span class="string">"异常"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(String name : pr.stringPropertyNames()) &#123;</span><br><span class="line">			<span class="comment">// 每次取出来一个key-value 对，如果key 中包含百分号（%）</span></span><br><span class="line">			<span class="comment">//即可认为该key 是用来为对象的Field赋值的</span></span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * %的前半为对象名字，后半为Field设置值</span></span><br><span class="line"><span class="comment">			 * 程序将会调用相对应的setter来为Field设置值</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="keyword">if</span>(name.contains(<span class="string">"%"</span>)) &#123;</span><br><span class="line">				<span class="comment">//将配置文件按照%进行分割</span></span><br><span class="line">				String [] objAndProp = name.split(<span class="string">"%"</span>);</span><br><span class="line">				<span class="comment">//取出需要设置的Field值的目标对象</span></span><br><span class="line">				Object target = getObject(objAndProp[<span class="number">0</span>]);</span><br><span class="line">				<span class="comment">//该Field对应的setter方法名为</span></span><br><span class="line">				String mtdName = <span class="string">"set"</span>+objAndProp[<span class="number">1</span>].substring(<span class="number">0</span>,<span class="number">1</span>).toUpperCase()+objAndProp[<span class="number">1</span>].substring(<span class="number">1</span>);</span><br><span class="line">				Class&lt;?&gt; targetClass = target.getClass();</span><br><span class="line">				<span class="comment">//获取该属性对应的setter方法</span></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Method mtd = targetClass.getMethod(mtdName, String.class);</span><br><span class="line">					<span class="comment">//通过Method 的invoke 方法执行setter 方法</span></span><br><span class="line">					<span class="comment">//将config.getProperty(name) 的属性值作为调用setter的方法实参</span></span><br><span class="line">					mtd.invoke(target,pr.getProperty(name));</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125; </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> objectPool.get(name);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	test test = <span class="keyword">new</span> test();</span><br><span class="line">	test.initPool(<span class="string">"./src/instance.properties"</span>);</span><br><span class="line">	test.initProperty();</span><br><span class="line">	System.out.println(test.getObject(<span class="string">"a"</span>));</span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用Method的invoke()方法来调用对应的方法的时候，Java程序会要求必须有调用该方法的权限，如果某个程序想要调用某个对象的private方法， 那么可以先调用Method方法的如下方法：</p>
<ul>
<li>setAccessible(bool flag) 值为true的时候，说明该Method方法在使用的时候要取消java语言的访问呢检查，值为falser的时候，则要进行权限的检查。该方法不只是属于method ，对于constructor、field都是可以调用的<h4 id="访问属性值"><a href="#访问属性值" class="headerlink" title="访问属性值"></a>访问属性值</h4></li>
<li>getField(String name)</li>
<li>getFields()</li>
<li>getDeclaredField(String name)</li>
<li>getDeclaredFields()</li>
<li>setXxx(Object obj,Xxx val) 将obj对象的field设置成val值，Xxx对应八种基本类型，val是要设置的对象的值。如果属性类型是引用类型，则取消set后面的Xxx</li>
<li>getXxx()<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person1</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	   <span class="keyword">return</span> <span class="string">"Person[name:"</span>+name+<span class="string">",age:"</span>+age+<span class="string">"]"</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException, SecurityException, IllegalArgumentException, IllegalAccessException </span>&#123;</span><br><span class="line">		Person1 p = <span class="keyword">new</span> Person1();</span><br><span class="line">		Class&lt;Person1&gt; clazz = Person1.class;</span><br><span class="line">		Field nameField = clazz.getDeclaredField(<span class="string">"name"</span>);</span><br><span class="line">		nameField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">		nameField.set(p, <span class="string">"gorge"</span>);</span><br><span class="line">		Field ageField = clazz.getDeclaredField(<span class="string">"age"</span>);</span><br><span class="line">		ageField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">		ageField.setInt(p, <span class="number">12</span>);</span><br><span class="line">		System.out.println(p);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="操作数组"><a href="#操作数组" class="headerlink" title="操作数组"></a>操作数组</h4><p>在java.lang.reflect包下还提供了一个Arrays类，Arrays对象可以代表所有数组，程序可以通过使用Arrays来动态的创建数组。</p>
<ul>
<li>static Object newInstance(class&lt;?&gt; type, int len) 创建一个类型为type，长度为len的数组</li>
<li>static xxx getXxx(Obj array, int index) 返回array数组中第index个元素。其中x x x是各种基本数据类型</li>
<li>static void setXxx(Obj array, int index,xxx val)将arrays数组中第index个元素的值设置为val,如果是引用类型则直接使用set()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Object arr = Array.newInstance(String.class,<span class="number">4</span>);</span><br><span class="line">		<span class="comment">//为数组赋值</span></span><br><span class="line">		Array.set(arr,<span class="number">3</span>,<span class="string">"java"</span>);</span><br><span class="line">		Array.set(arr, <span class="number">2</span>,<span class="string">"java ee"</span>);</span><br><span class="line">		Object one = Array.get(arr,<span class="number">2</span>);</span><br><span class="line">		Object two = Array.get(arr,<span class="number">3</span>);</span><br><span class="line">		System.out.println(one+<span class="string">":"</span>+two);</span><br></pre></td></tr></table></figure>
<h3 id="使用反射生成JDK动态代理"><a href="#使用反射生成JDK动态代理" class="headerlink" title="使用反射生成JDK动态代理"></a>使用反射生成JDK动态代理</h3><p>在java的java.lang.reflect 包下提供了一个Proxy类和一个InvocationHandler接口，通过使用这个类和接口可以生成JDK动态代理类或动态代理对象。<br>如果在程序中为<strong>一个或多个接口动态的生成实现类</strong>，就可以使用proxy来创建动态代理类；如果需要<strong>为一个或多个接口动态的创建实例</strong>，也可以使用Proxy来创建动态代理实例。</p>
<ul>
<li>static Class&lt;?&gt; getProxyClass(ClassLoader loader,Class &lt;?&gt; … interfaces): 创建一个动态代理类所对应的class对象，该代理类将实现interface 所指定的多个接口。第一个ClassLoade参数指定生成动态代理类的类加载器。</li>
<li>static Object newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h):直接创建一个动态代理对象，该代理对象的实现类实现了interface指定的系列接口，执行代理对象的每个方法时都会被替换执行InvocationHandler对象的invoke方法。<h4 id="通过动态代理类生成动态代理对象"><a href="#通过动态代理类生成动态代理对象" class="headerlink" title="通过动态代理类生成动态代理对象"></a>通过动态代理类生成动态代理对象</h4>先生成一个动态代理类，然后在通过动态代理类，来创建动态代理对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个InvokationHandler对象</span></span><br><span class="line">  InvocationHandler handler = <span class="keyword">new</span> MyInvokationHandler();</span><br><span class="line">  <span class="comment">//通过代理类来创建代理对象</span></span><br><span class="line">  Class proxyClass = Proxy.getProxyClass(Person.class.getClassLoader(), <span class="keyword">new</span> Class[] &#123;Person.class&#125;);</span><br><span class="line">  Constructor ctor = proxyClass.getConstructor(<span class="keyword">new</span> Class[] &#123;InvocationHandler.class&#125;);</span><br><span class="line">  Person p2 = (Person)ctor.newInstance(<span class="keyword">new</span> Object[] &#123;handler&#125;);</span><br><span class="line">  p2.sayHello(<span class="string">"nnd"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="直接生成动态代理对象"><a href="#直接生成动态代理对象" class="headerlink" title="直接生成动态代理对象"></a>直接生成动态代理对象</h4><ul>
<li>首先，我们要先创建一个接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">walk</span><span class="params">()</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>然后实现InvocationHandle接口，因为在执行方法的时候，都会被替换成调用该invoke()方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="comment">//生成动态代理对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInvokationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 执行动态代理对象的所有方法的时候，都会被替换成执行如下的invoke方法</span></span><br><span class="line"><span class="comment">  * 其中：</span></span><br><span class="line"><span class="comment">  * proxy:代表动态代理对象 例如：Person.class.getClassLoader()</span></span><br><span class="line"><span class="comment">  * method:代表正在执行的方法</span></span><br><span class="line"><span class="comment">  * args:代表调用目标方法的时候传入的实参</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">  <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">  System.out.println(<span class="string">"---正在执行的方法："</span>+method);</span><br><span class="line">  <span class="comment">//这里可以判断一下执行的是什么方法，然后对该方法进行 重新编辑</span></span><br><span class="line">  <span class="keyword">if</span>(method.equals(Person.class.getMethod(<span class="string">"walk"</span>, <span class="keyword">null</span>))) &#123;</span><br><span class="line">   System.out.println(<span class="string">"正在执行walk方法"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(args!=<span class="keyword">null</span>) &#123;</span><br><span class="line">   System.out.println(<span class="string">"下面是执行该方法的时候传入的参数："</span>);</span><br><span class="line">   <span class="keyword">for</span>(Object obj:args) &#123;</span><br><span class="line">    System.out.println(obj);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   System.out.println(<span class="string">"该方法没有实际的参数"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建一个动态代理对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//创建一个InvokationHandler对象</span></span><br><span class="line">  InvocationHandler handler = <span class="keyword">new</span> MyInvokationHandler();</span><br><span class="line">  <span class="comment">//使用指定的InvocationHandler 来生成一个动态代理对象</span></span><br><span class="line">  Person p = (Person)Proxy.newProxyInstance(Person.class.getClassLoader(),<span class="keyword">new</span> Class[] &#123;Person.class&#125; , handler);</span><br><span class="line">  p.walk();</span><br><span class="line">  p.sayHello(<span class="string">"HELLO"</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>一般我们通过第二种方式创建类的对象就可以了，在编写框架或者底层基础代码的时候，动态代理的作用就非常大了。</p>
<h4 id="动态代理和AOP"><a href="#动态代理和AOP" class="headerlink" title="动态代理和AOP"></a>动态代理和AOP</h4><p>在开发一个实际的应用软件系统的时候，总会存在相同的代码段重复出现的情况，这种情况下，如果通过复制粘贴的方式，则对于后期的维护是非常困难的，如果通过将这个方法写出一个方法，然后调用的方式执行，则会使得程序的耦合性提高。因此，我们就可以通过动态代理的方式进行。<br>具体方式如下：</p>
<ul>
<li>创建一个对象接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">info</span><span class="params">()</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建接口的实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GunDog</span> <span class="keyword">implements</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"我是一只猎狗"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"我奔跑很快"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>将重复的方法写到一个工具类中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogUtil</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"------通用方法一"</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"------通用方法二"</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>实现InvocationHandler方法，并设置主调对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInvokationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"><span class="comment">//需要被代理的对象</span></span><br><span class="line"><span class="keyword">private</span> Object target;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTarget</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.target = target;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"> DogUtil du = <span class="keyword">new</span> DogUtil();</span><br><span class="line">  <span class="comment">//执行DogUtil对象中的method方法</span></span><br><span class="line">  du.method();</span><br><span class="line">  Object result = method.invoke(target, args);</span><br><span class="line">  <span class="comment">//执行DogUtil 对象中的method2方法</span></span><br><span class="line">  du.method2();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>创建代理工厂为指定的target 生成动态代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProxyFactory</span> </span>&#123;</span><br><span class="line"><span class="comment">//为指定的target生成动态代理对象</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getProxy</span><span class="params">(Object target)</span>  </span>&#123;</span><br><span class="line">  MyInvokationHandler handler = <span class="keyword">new</span> MyInvokationHandler();</span><br><span class="line">  <span class="comment">//为handler设置target对象</span></span><br><span class="line">  handler.setTarget(target);</span><br><span class="line">  <span class="comment">//创建并返回一个动态代理</span></span><br><span class="line">  <span class="keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(),target.getClass().getInterfaces(), handler);</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">  Dog target = <span class="keyword">new</span> GunDog();</span><br><span class="line">  <span class="comment">//以指定target 来创建动态代理对象</span></span><br><span class="line">  Dog dog = (Dog)MyProxyFactory.getProxy(target);</span><br><span class="line">  dog.info();</span><br><span class="line">  dog.run();</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>当我们使用proxy生成一个动态代理的时候，往往并不会凭空产生一个动态代理，通常都是为指定的目标对象生成动态代理。<br>这种动态的代理在AOP（面向切面的编程）中被称为AOP代理，AOP代理可以代替目标对象，AOP代理包含了目标对象的全部方法，但是AOP代理中的方法与目标对象的方法存在差异，AOP代理的方法可以在执行目标方法之前或者之后插入一些有用的处理。</p>
<h3 id="反射和泛型"><a href="#反射和泛型" class="headerlink" title="反射和泛型"></a>反射和泛型</h3><p>如果Class对应的类暂时未知，则使用Class&lt;?&gt;。通过在反射中使用泛型，可以避免使用反射生成的对象需要强制类型转换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getInstance</span><span class="params">(Class&lt;T&gt; cls)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cls.newInstance();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">   <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">   e.printStackTrace();</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取实例无需进行类型转换</span></span><br><span class="line">  Date d = getInstance(Date.class);</span><br><span class="line">  JFrame f = getInstance(JFrame.class);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用反射来获取泛型信息"><a href="#使用反射来获取泛型信息" class="headerlink" title="使用反射来获取泛型信息"></a>使用反射来获取泛型信息</h4><p>对于基本的类型，可以通过泛型，直接查看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> dfsdf ;</span><br><span class="line">Field t = Test.class.getField(<span class="string">"dfsdf"</span>);</span><br><span class="line">  Class&lt;?&gt; TYPE = t.getType();</span><br><span class="line">  System.out.println(TYPE);</span><br></pre></td></tr></table></figure>
<p>但是如果该Field是有泛型类型的类型，如Map&lt;String,Integer&gt;类型，则不能准确的得到这个类型。<br>要想获取泛型类型，则需要先使用</p>
<ul>
<li>getGenericType() 获得实例的泛型类型<br>然后在将Type 对象强制类型转换为ParameterizedType 对象，该对象代表被参数化的类型，也就是增加了泛型限制的类型。</li>
<li>getRawType(): 返回没有泛型信息的原始类型</li>
<li>getActualTypeArguments() 返回泛型参数类型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Map&lt;String,Integer&gt; score;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> <span class="keyword">throws</span> NoSuchFieldException, SecurityException </span>&#123;</span><br><span class="line">    Class&lt;?&gt; clazz = Test.class;</span><br><span class="line">    Field f = clazz.getDeclaredField(<span class="string">"score"</span>);</span><br><span class="line">    Class&lt;?&gt; a = f.getType();</span><br><span class="line">    <span class="comment">//下面将看到输出Map类型，但是map的泛型类型，则获取不到</span></span><br><span class="line">    System.out.println(a);</span><br><span class="line">    <span class="comment">//获得Field实例f的泛型类型</span></span><br><span class="line">    Type gType = f.getGenericType();</span><br><span class="line">    <span class="comment">//如果这个类型是ParameterizedType 对象</span></span><br><span class="line">    <span class="keyword">if</span>(gType <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">     <span class="comment">//强制类型转换</span></span><br><span class="line">     ParameterizedType ptype = (ParameterizedType)gType;</span><br><span class="line">     <span class="comment">//获取原始类型</span></span><br><span class="line">     Type rType = ptype.getRawType();</span><br><span class="line">     System.out.println(<span class="string">"原始类型为："</span>+rType);</span><br><span class="line">     <span class="comment">//获取泛型类型的泛型参数</span></span><br><span class="line">     Type[] tArgs = ptype.getActualTypeArguments();</span><br><span class="line">     System.out.println(<span class="string">"泛型类型是："</span>);</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tArgs.length;i++) &#123;</span><br><span class="line">      System.out.println(<span class="string">"第"</span>+i+<span class="string">"个泛型类型是"</span>+tArgs[i]);</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">     System.out.println(<span class="string">"获取类型错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>注意上面说有的类型都是来自java.lang.reflect包下的。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2021/01/02/类的加载机制与反射机制/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="类的加载机制与反射机制">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Java集合总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/12/25/Java集合总结/" class="article-date">
  	<time datetime="2020-12-25T12:35:38.840Z" itemprop="datePublished">2020-12-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/12/25/Java集合总结/">
        Java集合总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Java的集合类主要是由两个接口派生出来的：Collection 和Map</p>
<ul>
<li>Collection<ul>
<li>Set 无序集合 不可重复<ul>
<li>EnumSet</li>
<li>SortedSet<br>  TreeSet</li>
<li>HashSet<br>  LinkedHashSet</li>
</ul>
</li>
<li>Queue 队列<ul>
<li>Deque<br> ArrayDeque<br> LinkedList</li>
<li>PriorityQueue</li>
</ul>
</li>
<li>List 有序集合 元素可以重复<ul>
<li>ArrayList</li>
<li>LinkedList</li>
<li>Vector<br> stack</li>
</ul>
</li>
</ul>
</li>
<li>Map<ul>
<li>EnumMap</li>
<li>IdentityHashMap</li>
<li>HashMap(线程不安全，key value 可以为null)<ul>
<li>LinkedHashMap</li>
</ul>
</li>
<li>Hashtable (线程安全key value 不能为null )<ul>
<li>Properties</li>
</ul>
</li>
<li>SortedMap<ul>
<li>TreeMap</li>
</ul>
</li>
<li>WeekHashMap</li>
</ul>
</li>
<li>Iterator 用来集合遍历<h1 id="各个集合的特点"><a href="#各个集合的特点" class="headerlink" title="各个集合的特点"></a>各个集合的特点</h1><h2 id="Set集合"><a href="#Set集合" class="headerlink" title="Set集合"></a>Set集合</h2><h3 id="HashSet-类"><a href="#HashSet-类" class="headerlink" title="HashSet 类"></a>HashSet 类</h3>特点：</li>
</ul>
<ol>
<li>不能保证元素的排列顺序，顺序有可能发生变换</li>
<li>不是同步的，如果是多线程程序，需要使用线程代码，来保证同步</li>
<li>集合元素可以为null</li>
<li>HashSet 集合判断两个元素相等是通过两个对象执行equals()方法比较并且两个对象的hashCode()方法返回值也要相等。</li>
</ol>
<p>补充： hash 算法的功能 - hash算法的价值在于速度，它可以保证查询速度被快速执行。当需要查询集合中某个元素的时候，hash算法可以直接根据该元素计算出该元素的存储位置，从而可以让程序快速定位该元素。</p>
<p>HashSet中每个能存储元素的“槽位”通常称为“桶”，如果有多个元素的hashCo de值相同，但他们通过equals()方法返回false,这样一个“桶”里面就会放多个元素，会导致性能下降。</p>
<h3 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h3><p>是HashSet的子类，与父类的不同在于该类使用链表维护元素的次序，这样使得元素看起来是按照插入顺序保存的。<br>LinkedHashSet是因为使用了链表维护元素的次序，因此性能相对低于父类，但是迭代访问的时候将会有很好的性能。</p>
<h3 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h3><p>TreeSet可以确保集合元素处于排序状态（排序状态指的是根据值的实际大小），除了haseset的方法之外，treeset提供了一些额外的方法</p>
<ul>
<li>Comparator comparator() 如果truest 采用了定制的排序，则该方法返回定制排序所使用的Comparator ,如果采用的是自然的排序，那么这个方法返回null</li>
<li>first() 返回集合元素中的第一个元素</li>
<li>last() 返回集合元素中的最后一个元素</li>
<li>lower(object e) 返回集合元素中位于指定元素之前的元素（即小于指定元素的最大元素）</li>
<li>higher(object e) 返回集合中位于指定元素之后的元素 （即大于指定元素的最小元素）</li>
<li>subSet(from,to) 返回集合的子集合，范围从from 到to</li>
<li>headSet(toele) 返回集合的子集，由小于toele的元素组成</li>
<li>tailSet(fromele) 返回集合的子集，由大于或等于fromele的元素组成</li>
</ul>
<h4 id="treeset的排序"><a href="#treeset的排序" class="headerlink" title="treeset的排序"></a>treeset的排序</h4><p>TreeSet 按照红黑树的数据结构进行存储，支持两种排序。<br><strong><em>如果想要在集合treeSet中添加对象的话，该对象就需要实现Comparable接口。</em></strong><br>comparable该接口定义了一个compareTo(Object obj)方法，该方法返回一个整数值。obj1.compareTo(obj2)如果该方法返回0，则表明这两个对象是相等的，如果返回一个正整数，则表明obj1 大于obj2，如果该方法返回一个负整数，则表明obj1小于obj2。</p>
<ul>
<li>自然排序<br>默认情况下是按照自然排序的方法进行排序的，即比较集合的大小，然后按照升序排列。<br>注意：如果添加的对象的比较是根据一个可变Field的字段，进行比较的情况。<br>如果是修改了Field字段，再次试图删除该对象的时候，Treeset里面的元素处于无序的状态，删除一个没有改变过的数据后集合中的元素会进行重新索引，接下来就可以删除集合中的所有的元素了。</li>
<li>定制排序<br>如果实现定制排序，则可以通过Comparator 接口的帮助。该接口里包含一个in t compare(T o1,T o2)方法，该方法可以用于比较o1和o2的大小。如果需要实现定制排序，则需要在创建TreeSet集合对象的时候，提供一个Comparator对象与该TreeSet 集合关联。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">M</span> </span>&#123;</span><br><span class="line"> <span class="keyword">int</span> age ;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">M</span><span class="params">(<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">	 <span class="keyword">this</span>.age = age;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	 <span class="keyword">return</span> <span class="string">"M[age:"</span>+age+<span class="string">"]"</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetTest4</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		TreeSet&lt;M&gt; ts = <span class="keyword">new</span> TreeSet&lt;M&gt;(<span class="keyword">new</span> Comparator&lt;M&gt;() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(M o1, M o2)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">				M m1 = o1;</span><br><span class="line">				M m2 = o2;</span><br><span class="line">				<span class="keyword">return</span> m1.age&gt;m2.age?-<span class="number">1</span>:m1.age &lt;m2.age?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		ts.add(<span class="keyword">new</span> M(<span class="number">5</span>));</span><br><span class="line">		ts.add(<span class="keyword">new</span> M(-<span class="number">3</span>));</span><br><span class="line">		ts.add(<span class="keyword">new</span> M(<span class="number">9</span>));</span><br><span class="line">		System.out.println(ts);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="EnumSet类"><a href="#EnumSet类" class="headerlink" title="EnumSet类"></a>EnumSet类</h3><p>EnumSet是一个专门为枚举类设计的集合类，EnumSet中的所有元素必须是指定枚举类型的枚举，集合元素是有顺序，顺序是由定义顺序决定的。</p>
<p>EnumSet内部是以位向量的形式存储的，这种存储形式非常高效，占用内存小，运行效率好，进行批量操作的执行速度非常快。</p>
<p>EnumSet 集合不允许加入null元素。<br>EnumSet 类没有暴露任何构造器来创建该类的实例，程序应该通过它提供的static方法来创建EnumSet对象。</p>
<h4 id="EnumSet类提供了如下常用的static方法来创建对象"><a href="#EnumSet类提供了如下常用的static方法来创建对象" class="headerlink" title="EnumSet类提供了如下常用的static方法来创建对象"></a>EnumSet类提供了如下常用的static方法来创建对象</h4><ul>
<li>allof(Class ele)：创建一个包含指定枚举类里所有枚举值的EnumSet集合</li>
<li>complementOf(EnumSet s) 创建一个其元素类型与指定EnumSet里元素类型相同的EnumSet集合</li>
<li>copyOf(Collection c) 使用一个普通集合来创建EnumSet集合</li>
<li>copyOf(EnumSet s) 创建一个与指定EnumSet 具有相同元素类型、相同集合元素的EnumSet集合</li>
<li>noneOf(Class elementType) 创建一个元素类型为指定枚举类型的空EnumSet</li>
<li>range(E from ,E rest) 创建包含一个或多个枚举值的EnumSet 集合，传入的多个枚举值必须属于同一个枚举类</li>
<li>of(E first,E rest) 创建一个包含一个或多个枚举值的EnumSet集合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mport java.util.EnumSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> season&#123;</span><br><span class="line">	Sp,Sum,Fal,Win</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetTest4</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		EnumSet es1 = EnumSet.allOf(season.class);</span><br><span class="line">		System.out.println(es1);</span><br><span class="line">		</span><br><span class="line">		EnumSet es2 = EnumSet.noneOf(season.class);</span><br><span class="line">		System.out.println(es2);</span><br><span class="line">		</span><br><span class="line">		es2.add(season.Sp);</span><br><span class="line">		System.out.println(es2);</span><br><span class="line">		</span><br><span class="line">		EnumSet es3 = EnumSet.complementOf(es1);</span><br><span class="line">		es3.add(season.Fal);</span><br><span class="line">		System.out.println(es3);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** 当试图复制一个Collection集合里面的值的时候来创建EnumSet集合时，必须保证Collection集合里面的元素都是同一个枚举类的枚举值。</p>
<h4 id="set类的性能分析以及使用决策"><a href="#set类的性能分析以及使用决策" class="headerlink" title="set类的性能分析以及使用决策"></a>set类的性能分析以及使用决策</h4><ul>
<li>HashSet总是比TreeSet好，特别是常用的添加、查询元素。只有当需要维持一个排序的集合的时候才选择TreeSet.</li>
<li>HashSet与Lin kedHashSet的比较：hashSet的插入、删除操作要更快一些。LinkedHashSet的遍历操作会更快一些。</li>
<li>EnumSet 是所有Set实现类中性能最好的，但是只能保存同一个枚举类的枚举值作为集合元素。</li>
<li>三个实现类都是线程不安全的，如果有多个线程访问set的时候，则必须手动保证该Se t集合的同步。<br>通常可以使用synchronizedSortedSet方法来包装<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SortedSet s = Collections.synchronizedSortedSet(<span class="keyword">new</span> TreeSet());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="List集合"><a href="#List集合" class="headerlink" title="List集合"></a>List集合</h2><p>Lsit集合代表一个元素有序、可重复的集合，集合中每个元素都有其对应的顺序索引。list集合允许使用重复元素，可以通过索引来访问指定位置的集合元素。<br>List集合可以使用collection集合的所有操作方法。<br>list里面增加了一些根据索引来操作集合元素的方法。</p>
<ul>
<li>void add(int index ,obj ele) </li>
<li>boolean addAll(int index,Collection c )</li>
<li>object get(int index) 返回集合index索引处的元素</li>
<li>int indexOf(Object o) 返回对象o 在list集合中第一次出现的位置索引</li>
<li>int lastIndexOf(obj o) 返回对象o在list中最后一次出现的位置索引</li>
<li>obj remove(int index) 删除并返回index索引处的元素</li>
<li>List subList(int fromIndex,int toIndex) 返回从索引fromIndex 到索引toIndex处所有集合元素组成的子集合</li>
<li>Object set(int index,Object element) 将index索引处的元素替换成element对象<br> 当调用List集合的set的方法的时候，指定的索引必须是Lis t集合的有效索引，不能添加一个大于list长度的索引值。</li>
<li><ul>
<li>集合元素判断两个元素相等的方式是 equals 方法。<br><em>equals判断相等的方法是值相等，== 判断相等的方法是指向同一个对象。</em></li>
</ul>
</li>
</ul>
<h4 id="list还额外提供了一个listIterator-方法，该方法返回一个ListIterator对象-增加了下面的方法"><a href="#list还额外提供了一个listIterator-方法，该方法返回一个ListIterator对象-增加了下面的方法" class="headerlink" title="list还额外提供了一个listIterator()方法，该方法返回一个ListIterator对象,增加了下面的方法"></a>list还额外提供了一个listIterator()方法，该方法返回一个ListIterator对象,增加了下面的方法</h4><ul>
<li>boolean hasPrevious() 返回该迭代器关联的集合是否还有上一个元素</li>
<li>Object previous() 返回该迭代器的上一个元素</li>
<li>void add() 在指定的位置增加一个元素<h3 id="ArrayList和Vector实现类"><a href="#ArrayList和Vector实现类" class="headerlink" title="ArrayList和Vector实现类"></a>ArrayList和Vector实现类</h3>（vector 是一个古老的集合，有很多缺点，不建议使用，Ar ra yList是线程不安全的，Vector是线程安全的）</li>
<li>完全支持前面提到的List接口的全部功能</li>
<li>都是基于数组实现的List类</li>
<li>这两个对象都是使用initialCapacity 参数来设置数组的长度，当数组的长度改变的时候可以initialCapacity回自动增加</li>
<li>void ensureCapacity(int minCapacity) 当向实现类中增加大量的元素的时候，该方法可以一次性的增加mincapacity大小的</li>
<li>void trimToSize() 调整ArrayList或vector集合的Obj[] 数组长度为当前元素的个数。减少使用空间</li>
<li>vector 集合实现了一个Stack的子类。实现了栈的方法，peek(),pop(),push()方法。<h3 id="固定长度的List"><a href="#固定长度的List" class="headerlink" title="固定长度的List"></a>固定长度的List</h3>前面讲数组的时候介绍了一个操作数组的工具类：Arrays,该工具类里提供了asList(object …a) 方法，该方法可以把一个数组或指定个数的对象转换成List集，这个list既不是ArrayList实现类的实例，也不是Vector实现类的实例，而是Arrays的内部类ArrayList的实例。<br>Arrays.ArrayList是一个固定长度的List集合，程序只能遍历访问该集合里面的元素，不能增加、删除该集合里面的元素。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List fixedList = Arrays.asList(<span class="string">"疯狂Java讲义"</span>,<span class="string">"轻量级Java EE企业级应用实战"</span>);</span><br><span class="line">	System.out.println(fixedList.getClass());</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;fixedList.size();i++) &#123;</span><br><span class="line">		System.out.println(fixedList.get(i));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//试图增加、删除元素都会引发异常</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Queue集合"><a href="#Queue集合" class="headerlink" title="Queue集合"></a>Queue集合</h3><p>用于模拟队列这种数据结构，队列通常是指“先进先出”的容器。</p>
<p>Queue接口中定义了以下几个方法：</p>
<ul>
<li>void add(Object e): 将指定元素加入到这个队列的尾部</li>
<li>Object element(): 获取队列头部的元素，但是不删除队列中该元素</li>
<li>boolean offer(Object e) 将指定元素加入到此队列的尾部</li>
<li>Object peek() 获取队列头部的元素 但是不删除该元素，队列为空就返回null</li>
<li>Object poll() 获取队列头部元素，并且删除这个元素</li>
</ul>
<p>Queue接口有一个PriorityQueue 实现类。Queue还有一个Deque接口，Deque代表一个“双端队列”,双端队列可以同时从两端来添加、删除元素。</p>
<h4 id="PriorityQueue实现类"><a href="#PriorityQueue实现类" class="headerlink" title="PriorityQueue实现类"></a>PriorityQueue实现类</h4><p>这个队列是一个比较标准的队列实现类，之所以说它是比较标准的队列实现，是因为这个队列的保存不是按照加入队列的顺序保存的，而是按照队列元素的大小进行重新排序，取出的时候是先取出元素最小的那个元素，而不是首先插入的元素。(在这个意义上已经违背了队列的先进先出)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PriorityQueue&lt;Integer&gt; pro = <span class="keyword">new</span> PriorityQueue&lt;Integer&gt;();</span><br><span class="line">	pro.offer(<span class="number">3</span>);</span><br><span class="line">	pro.offer(<span class="number">9</span>);</span><br><span class="line">	pro.offer(<span class="number">1</span>);</span><br><span class="line">	System.out.println(pro);</span><br><span class="line">	System.out.println(pro.poll());</span><br><span class="line">	System.out.println(pro.poll());</span><br><span class="line">	System.out.println(pro.poll());</span><br></pre></td></tr></table></figure>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">9</span>, <span class="number">3</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>可以发现，如果是直接输出队列的话，会使用toString()返回值，受String的影响，会导致输出的序列没有按照顺序输出，但是如果我们使用poll()的话，就是按照从小到大的顺序。</p>
<p>PriorityQueue 不允许插入null元素，因为它需要对队列中元素进行排序。</p>
<ul>
<li>自然排序<br>自然排序的元素必须实现了Comparable接口。</li>
<li>定制排序<br> 创建PriorityQueue队列的时候，传入一个Comparator 对象，该对象负责对队列中的所有元素进行排序，不要求队列元素实现Comparator的接口。<h4 id="Deque-接口与ArrayDeque实现类"><a href="#Deque-接口与ArrayDeque实现类" class="headerlink" title="Deque 接口与ArrayDeque实现类"></a>Deque 接口与ArrayDeque实现类</h4>Deque接口是Queue接口的子接口，代表了一个双端队列，允许从两端来操作队列的元素。<strong><em>可以当作双端队列或者栈使用</em></strong></li>
<li>addFirst()</li>
<li>addLast()</li>
<li>Iterator descendingIterator() 返回该双端队列对应的迭代器，该迭代器按照逆向顺序迭代队列</li>
<li>getFirst()</li>
<li>getLast()</li>
<li>offerFiirst()</li>
<li>offerLast()</li>
<li>peekFirst()</li>
<li>peekLast()</li>
<li>pollFirst()</li>
<li>pollLast()</li>
<li>pop() 相当于removeFirst</li>
<li>push() 相当于addFirst</li>
<li>obj removeFirst() 获取并删除该双端队列的第一个元素</li>
<li>obj removeFirstOccurrence(obj o) 删除该双端队列的第一个出现的元素o</li>
<li>removeLast()获取并删除该双端队列的最后一个元素</li>
<li>removeLastOccurrence(obj o) 删除该双端队列最后一次出现的元素o<br>ArrayDeque是Deque的基于数组的实现类。<h4 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h4>是List接口的实现类，意味着这是Lis t的一个集合，可以根据索引来随机访问集合中的元素，还实现了De que接口，因此也可以当作双端队列使用，也可以当作栈使用。</li>
</ul>
<p>LinkedList是一个功能非常强大的集合，与ArrayList以及ArrayDeque的实现机制完全不同，Array是按照数组形式来保存数据的，因此在访问集合元素的时候性能比较好，Linkedlist是根据链表来存储数据的，访问数据的时候性能比较差，但是在插入、删除元素的时候性能比较好。</p>
<h3 id="各种线性表的性能分析"><a href="#各种线性表的性能分析" class="headerlink" title="各种线性表的性能分析"></a>各种线性表的性能分析</h3><table>
<thead>
<tr>
<th>名称</th>
<th>实现机制</th>
<th>随机访问排名</th>
<th>迭代操作</th>
<th>插入操作</th>
<th>删除操作</th>
</tr>
</thead>
<tbody>
<tr>
<td>数组</td>
<td>连续内存区保存元素</td>
<td>1</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
<tr>
<td>ArrayList/ArrayDeque</td>
<td>以数组保存元素</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>Vector</td>
<td>以数组保存元素</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>LinkedList</td>
<td>以链表保存元素</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<h4 id="java堆内存大小的修改"><a href="#java堆内存大小的修改" class="headerlink" title="java堆内存大小的修改"></a>java堆内存大小的修改</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xms128m -Xmx512m PerformanceTest</span><br></pre></td></tr></table></figure>
<p>-Xms 表示设置的JVM的堆内存的初始大小<br>-Xmx 表示设置的JVM的堆内存的最大大小（不要超过物理内存）</p>
<h4 id="使用建议"><a href="#使用建议" class="headerlink" title="使用建议"></a>使用建议</h4><ul>
<li>如果是遍历List集合 <ul>
<li>ArrayList、Vector使用get来遍历集合元素</li>
<li>LinkedList集合 使用迭代器遍历</li>
</ul>
</li>
<li>如果需要经常执行插入删除 操作 则使用LinkedList。如果使用ArrayList或者Vector的话，通常需要重分配内部数组的大小，时间开销经常是LinkedList的几十倍。</li>
<li>多线程访问集合的时候，应该考虑集合的线程安全集合</li>
</ul>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>map的key是不允许重复的，在一个Map对象的任何两个key通过equals方法比较总是返回false。<br>Set与Map的关系非常的密切，从源码来看，Java是通过先实现了Map，然后通过包装一个所有value都为null的Map就实现了Set集合。<br>通用方法总结<br>-clear() 删除该Map对象中所有的key-value对</p>
<ul>
<li>bool containsKey()</li>
<li>bool containsValue() </li>
<li>Set entrySe() 返回Map集合中所有的key-value对</li>
<li>obj get(key)</li>
<li>isEmpty()</li>
<li>Set keySet()</li>
<li>obj put(key,value)</li>
<li>void putAll(map)</li>
<li>obj remove(key)</li>
<li>int size() </li>
<li>Collection values()</li>
</ul>
<p>map中的每一个实体类的方法：</p>
<ul>
<li>obj getKey()</li>
<li>obj getValue()</li>
<li>obj setValue()<h3 id="HashMap-和-Hashtable实现类"><a href="#HashMap-和-Hashtable实现类" class="headerlink" title="HashMap 和 Hashtable实现类"></a>HashMap 和 Hashtable实现类</h3>HashTable与HashMap都是Map接口的典型实现，它们之间的关系类似于ArrayList与Vector的关系。HashTable是一个古老的Map实现类。<br>区别：</li>
<li>Hashtable是一个线程安全的实现，HashMap是线程不安全的。</li>
<li>Hashtable不允许使用null作为key和value ,HashMap是可以的。<br>Hashtable和HashMap类用作key的对象都必须实现hashCode()方法和equals()方法。<br>Hashtable与HashMap 列表判断值相等的方法是equals()方法<h4 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h4>LinkedhashMap 使用双向链表来维护key-value对的次序，该链表负责维护Map的迭代顺序，保证顺序与插入的链表一致。<h4 id="Properties-读写属性文件"><a href="#Properties-读写属性文件" class="headerlink" title="Properties 读写属性文件"></a>Properties 读写属性文件</h4>（windows中的ini文件就是一种属性文件）<br>Properties 类是Hashtable 类的子类，该对象在处理属性文件的时候特别方便。该类可以把Map 对象和属性文件关联起来，从而可以把Map对象中的key-value 对写入属性文件中，也可以把属性文件中的“属性名= 属性值”加载到Map 对象中。<br>一共有三个方法修改Properties里面的key和value值</li>
<li>String getProperty(String key) : 获取属性文件中指定属性名对应的属性值</li>
<li>String getProperty(String key,String defaultValue) 如果文件中不存在指定的key值的时候，会设置default作为默认值。</li>
<li>Object setProperty(String key,String value) 设置属性</li>
<li>void load(InputStream inStream) 从属性文件中加载key-value对，把加载到的key-value对追加到Propertie里面，不保证次序</li>
<li>void store(OutputStream out,String ) 将properties 中的key-value对输出到指定的属性文件中。</li>
</ul>
<p>这里提供一个读取java中的properties文件的示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 读取</span></span><br><span class="line">			pro.load(<span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"./pro.properties"</span>)));</span><br><span class="line">			String xx = pro.getProperty(<span class="string">"ee"</span>);</span><br><span class="line">			System.out.println(xx);</span><br><span class="line">			pro.setProperty(<span class="string">"p"</span>, <span class="string">"12323"</span>);</span><br><span class="line">			System.out.println(pro.getProperty(<span class="string">"p"</span>));</span><br><span class="line">			<span class="comment">//存储</span></span><br><span class="line">			pro.store(<span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"./pro.properties"</span>)),<span class="string">"test line"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SortedMap接口和TreeMap实现类"><a href="#SortedMap接口和TreeMap实现类" class="headerlink" title="SortedMap接口和TreeMap实现类"></a>SortedMap接口和TreeMap实现类</h4><p>SortedMap接口也有一个TreeMap的实现类，TreeMap就是一个红黑树数据结构，每个key-value对即作为红黑树的一个节点。TreeMap存储key-value对的时候，需要根据key对节点进行排序。TreeMap可以保证所有的key-value对处于有序状态。</p>
<ul>
<li>自然排序<br>key必须实现Comparable接口，而且所有的ke y应该是同一个类的对象。</li>
<li><p>自定义排序<br> 创建Treemap的时候，需要传入一个Comparator对象，该对象负责对Treemap 中的所有的key进行排序。</p>
<p>如果使用自定义作为Treemap的key的时候，如果想要让TreeMap良好的工作，则重写该类的equals()方法和compareTo()方法时保持一致的返回结果，两个key 通过equals()方法比较返回true时，它们通过compareTo()方法。</p>
</li>
<li><p>Map.Entry firstEntry()：返回该Map中的最小值，如果该Map为空或不存在这样的key，则都返回null</p>
</li>
<li>firstKey() 返回该Map中最小key值，如果该Map为空，则返回null</li>
<li>Map.Entry lastEntry(): 返回map中最大key值</li>
<li>Map.Entry higherEntry(obj key) 返回该Map中位于后一位的key-value 对。如果该Map为空，则返回null</li>
<li>Object higherKey(object key) 返回该Map中位于key后一位的key值</li>
<li>Map.Entry lowerEntry(obj key) 返回该Map中位于key 前一位的key-value对</li>
<li>Object lowerKey(obj key) 返回该Map中位于key前一位的ke y值</li>
<li>NavigableMap subMap(obj fromkey, bool from, obj toKey ,bool toin) 返回map的子集，是否包含fromKey 与 toKey主要取决于 后面的bool值</li>
<li>SortedMap tailMap(obj fromKey) 返回map的子map,其key 的范围是大于fromKey的。</li>
<li>SortedMap headMap(obj toKey) 返回该map的子Map,其key的范围是小于hokey的所有的key</li>
<li>Navigatable headMap(obj tokey,bool inclu) tokey是否包含取决于bool的值<h4 id="weakHashMap实现类"><a href="#weakHashMap实现类" class="headerlink" title="weakHashMap实现类"></a>weakHashMap实现类</h4>与HashMap的用法是一样的，只不过HashMap是强引用的，只要HashMap对象不被销毁，那么所有的key就都不会被垃圾回收机制回收，也不会自动删除这些key对应的key-value对。但是weakHashMap是弱引用的，如果该对象的key 没有被强引用变量引用，则这些key所引用的对象可能被垃圾回收，也可能自动删除这些key 所对应的key-value对。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	WeakHashMap&lt;String, String&gt; whm = <span class="keyword">new</span> WeakHashMap&lt;String, String&gt;();</span><br><span class="line">	whm.put(<span class="keyword">new</span> String(<span class="string">"语文"</span>), <span class="keyword">new</span> String(<span class="string">"良好"</span>));</span><br><span class="line">	whm.put(<span class="keyword">new</span> String(<span class="string">"数学"</span>), <span class="keyword">new</span> String(<span class="string">"及格"</span>));</span><br><span class="line">	whm.put(<span class="keyword">new</span> String(<span class="string">"英文"</span>), <span class="keyword">new</span> String(<span class="string">"中等"</span>));</span><br><span class="line">	System.out.println(whm);</span><br><span class="line">	whm.put(<span class="string">"java"</span>,<span class="string">"dsdfs"</span>);</span><br><span class="line">	System.gc();</span><br><span class="line">	System.runFinalization();</span><br><span class="line">	System.out.println(whm);</span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果</span></span><br><span class="line">&#123;英文=中等, 数学=及格, 语文=良好&#125;</span><br><span class="line">&#123;java=dsdfs&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>从上面的程序中，我们可以看出，在系统进行垃圾回收的时候，前面new的对象全部被回收了，但是使用字符串java的变量还在，这是因为前面三个都是匿名的对象，weakHashMap只保留了它的弱引用，但是第四个的key是一个字符串直接量，系统会保留它的强引用，所以垃圾回收机制不会回收。</p>
<h4 id="IdentityHashMap实现类"><a href="#IdentityHashMap实现类" class="headerlink" title="IdentityHashMap实现类"></a>IdentityHashMap实现类</h4><p>这个实现类与HashMap的类是实现机制是相同的，主要的区别在于当且仅当两个key严格相等的时候(key1 == key2)的时候，该类才能判定两个ke y相等。对于普通的HashMap而言，只要key1 和key2 通过equals()方法比较返回true,且它们的hashCode值相等即可。</p>
<h4 id="EnumMap-实现类"><a href="#EnumMap-实现类" class="headerlink" title="EnumMap 实现类"></a>EnumMap 实现类</h4><p>EnumMap是一个与枚举类一起使用的map实现，EnumMap中的所有key必须是单个枚举类的枚举值。创建EnumMap的时候，必须显示或者隐示的指定它对应的枚举类。<br>根据key的自然顺序来维护key-value 对的顺序。<br>EnumMap 不允许使用null作为key，但是允许使用null作为value.<br>创建EnumMap的时候，必须指定一个枚举类，从而将该EnumMap和指定枚举类关联起来。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.EnumMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Season&#123;</span><br><span class="line">	SPRING,SUMMER,FALL,WINTER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	EnumMap&lt;Season, String&gt; sE = <span class="keyword">new</span> EnumMap&lt;Season, String&gt;(Season.class);</span><br><span class="line">	sE.put(Season.FALL, <span class="string">"dsdf"</span>);</span><br><span class="line">	sE.put(Season.SPRING, <span class="string">"dsdfsd"</span>);</span><br><span class="line">	System.out.println(sE);</span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Map实现类的性能分析"><a href="#Map实现类的性能分析" class="headerlink" title="Map实现类的性能分析"></a>Map实现类的性能分析</h4><ul>
<li>HashMap与Hashtable的效率大致相同，实现机制几乎一样，但是Hashtable是线程同步的。</li>
<li>TreeMap 通常比HashMap、Hashtable要慢，因为TreeMap 底层采用红黑树来管理。</li>
<li>对于一般的应用场景，程序应该多考虑使用HashMap，因为HashMap正是为查询设计的。</li>
<li>LinkedHashMap比HashMap 慢一点，因为它需要维护链表来保持Map中的key-value时的添加顺序。<h4 id="HashSet-和-HashMap的性能选项"><a href="#HashSet-和-HashMap的性能选项" class="headerlink" title="HashSet 和 HashMap的性能选项"></a>HashSet 和 HashMap的性能选项</h4>对于HashSet及其子类而言，它们采用hash算法来决定集合中元素的存储位置，并通过hash算法来控制集合的大小；对于HashMap、Hashtable及其子类而言，它们采用hash算法来决定Map中key的存储，并通过hash算法来增加key集合的大小。<br>hash表里面可以存储元素的位置被称为“桶”，通常情况下，单个“桶”里面存储一个元素，此时有最好的性能。<h2 id="操作集合的工具类：Collections"><a href="#操作集合的工具类：Collections" class="headerlink" title="操作集合的工具类：Collections"></a>操作集合的工具类：Collections</h2>Java提供了一个Set、List和Map的工具类：Collection,该工具类里面提供了大量的方法可以对集合进行排序、删除、查找、设置集合为不可变、对集合对象实现同步控制等方法。<h3 id="排序操作"><a href="#排序操作" class="headerlink" title="排序操作"></a>排序操作</h3></li>
<li>static void reverse(List list) 反转指定集合的元素</li>
<li>static void shuffle(List list) 对集合元素进行随机排序</li>
<li>static void sort(List list) 根据自然排序对集合进行升序排序</li>
<li>static void sort(List list,Comparator c) 根据指定的规则对集合进行排序</li>
<li>satic void swap(List list, int I,int j) 将指定的Lis t集合中的I处的元素和j处的元素进行交换。</li>
<li>static void rotate(List list, int distance) <ul>
<li>distance 为正数的时候，将list集合的后distance 个元素“整体”移到前面</li>
<li>为负数的时候，将list集合的前distance 个元素整体移到后面<br>使用语法：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; ls = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">	ls.add(<span class="number">1</span>);</span><br><span class="line">	ls.add(<span class="number">2</span>);</span><br><span class="line">	ls.add(<span class="number">3</span>);</span><br><span class="line">	ls.add(<span class="number">4</span>);</span><br><span class="line">	System.out.println(ls);</span><br><span class="line">	Collections.reverse(ls);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="查找替换操作"><a href="#查找替换操作" class="headerlink" title="查找替换操作"></a>查找替换操作</h3><ul>
<li>static int binarySearch(List list,Object key) 使用二分搜索方法 搜索指定的集合，获得指定对象在集合中的索引</li>
<li>static Object max(Collect coll) 根据元素的自然排序，返回集合中的最大元素</li>
<li>static Object max(Collection Coll,Comparator comp) 根据指定的排序方法，返回最大的值</li>
<li>min 同理</li>
<li>static void fill(List list,Object obj) 使用指定元素obj替换指定 List集合中的所有元素</li>
<li>static int frequency(Collection c ,Object o) 返回指定集合中指定元素出现的次数</li>
<li>static int indexOfSubList(List source,List target): 返回子list对象在父List对象中第一次出现的位置索引；如果父List中没有出现，则返回-1</li>
<li>static int lastIndexOfSubList(List source,List target) 返回子List对象在父List中最后一次出现的位置索引</li>
<li>static boolean replaceAll(List list,Object oldVal,Object newVal) 使用一个新值newVal替换List对象的所有旧的oldVal<h3 id="同步控制"><a href="#同步控制" class="headerlink" title="同步控制"></a>同步控制</h3>Collections类中提供了多个synchronizedXxx() 方法，可以将指定的集合包装成线程同步的集合<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Collection c = Collections.synchronizedCollection(<span class="keyword">new</span> ArrayList())</span><br><span class="line">List ls = Collections.synchronizedList(<span class="keyword">new</span> ArrayList());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="设置不可变对象"><a href="#设置不可变对象" class="headerlink" title="设置不可变对象"></a>设置不可变对象</h3><ul>
<li>emptyXxx() 返回一个空的、不可变的集合对象</li>
<li>singletonXxx() 返回一个只包含指定对象的、不可变的集合对象</li>
<li>unmodiifiableXxx() 返回指定集合对象的不可变视图<br>上面的意思是生成的集合只能读取</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/12/25/Java集合总结/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="Java集合总结">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-华为云RDS操作实践" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/12/17/华为云RDS操作实践/" class="article-date">
  	<time datetime="2020-12-17T11:35:49.343Z" itemprop="datePublished">2020-12-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/12/17/华为云RDS操作实践/">
        华为云RDS操作实践
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="购买华为云RDS"><a href="#购买华为云RDS" class="headerlink" title="购买华为云RDS"></a>购买华为云RDS</h3><p>登陆华为云账号，在右上角有一个 购买数据库实例，点击即可。<br>购买成功后，回在控制台显示实例名称，然后输入用户名以及密码登陆即可。</p>
<h3 id="在-MySQL-数据库建立一个海洋环境信息表，存储某一地点不同日期一天中不同时间的海洋观测数据，包括日期，时间，经度，维度，风向，风速，压力，温度，温度。"><a href="#在-MySQL-数据库建立一个海洋环境信息表，存储某一地点不同日期一天中不同时间的海洋观测数据，包括日期，时间，经度，维度，风向，风速，压力，温度，温度。" class="headerlink" title="在 MySQL 数据库建立一个海洋环境信息表，存储某一地点不同日期一天中不同时间的海洋观测数据，包括日期，时间，经度，维度，风向，风速，压力，温度，温度。"></a>在 MySQL 数据库建立一个海洋环境信息表，存储某一地点不同日期一天中不同时间的海洋观测数据，包括日期，时间，经度，维度，风向，风速，压力，温度，温度。</h3><p>我们可以在登陆的首页处先点击创建一个数据库<br><img src="https://img-blog.csdnimg.cn/20201216164755314.png" alt="在这里插入图片描述"><br>然后创建完毕后，点击数据库的名字，进入到该数据库里面去，在数据库里面建立一张数据表名！两种方式创建</p>
<ul>
<li><p>可以通过点击创建数据表进行创建，需要填写表名，以及字符集（这里我们使用utf-8字符集就可以了）<br><img src="https://img-blog.csdnimg.cn/20201216170312472.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>通过执行sql语句进行创建(操作不熟练的，直接操作界面更方便一些）<br>如果想要使用Sql语句进行执行，可以点击页面头部的Sql窗口按钮。这样就可以通过sql语句进行执行了。</p>
</li>
</ul>
<p>经过上面的操作，我们已经拥有一张自己的表格了。</p>
<h3 id="将-Excel-表格的海洋环境数据导入本地-MySQL-数据库。迁移-MySQL-数据，把本地海洋观测MySQL-数据库迁移到华为云数据库。"><a href="#将-Excel-表格的海洋环境数据导入本地-MySQL-数据库。迁移-MySQL-数据，把本地海洋观测MySQL-数据库迁移到华为云数据库。" class="headerlink" title="将 Excel 表格的海洋环境数据导入本地 MySQL 数据库。迁移 MySQL 数据，把本地海洋观测MySQL 数据库迁移到华为云数据库。"></a>将 Excel 表格的海洋环境数据导入本地 MySQL 数据库。迁移 MySQL 数据，把本地海洋观测MySQL 数据库迁移到华为云数据库。</h3><p>首先我们先要在本地安装navicat数据库 图形化界面工具。关于这个工具，我就不再赘述了。网上有很多的使用教程。安装配置好之后，在自己 创建的数据库中，点击文件-&gt; 导入向导-&gt;然后选择自己要导入的对应的数据文件即可。</p>
<p> 在接下来的操作中，如果你是想尝试第一种方式，那么就在navicat中导出数据库文件为d b文件或者csv文件。如果是想尝试第二种方法就导出为sql脚本可执行文件，然后使用文本编辑器打开即可。</p>
<h4 id="方式一-通过导入本地的数据库，然后使用OBS桶进行数据库迁移"><a href="#方式一-通过导入本地的数据库，然后使用OBS桶进行数据库迁移" class="headerlink" title="方式一 通过导入本地的数据库，然后使用OBS桶进行数据库迁移"></a>方式一 通过导入本地的数据库，然后使用OBS桶进行数据库迁移</h4><p><img src="https://img-blog.csdnimg.cn/20201216171040607.png" alt="在这里插入图片描述"><br>可以看到这个位置有一个导入的按钮 ，我们点击进去，然后新建一个导入的位置<br><img src="https://img-blog.csdnimg.cn/20201216171214572.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>可以看到这里有一个OBS桶，如果没有的话，我们自己创建一个就可以了。然后点击或将文件拖动到此处后上传文件字样，就可以创建一个导入任务了。（这里我没有导入成功）</p>
<h4 id="方式二-手动通过Sql语句导入"><a href="#方式二-手动通过Sql语句导入" class="headerlink" title="方式二  手动通过Sql语句导入"></a>方式二  手动通过Sql语句导入</h4><p>将导出的s q l可执行语句，放入到华为数据库的SQL查询处执行SQL语句。就将数据导入进去了。但是在导入的过程中，出现了一个问题，就是我们在建立表的时候，建立的是有id的数据表，但是我们在本地建设数据库的时候并没有包含着一列。因此，我们要修改一下表，删除第一列id。在执行语句。<br><img src="https://img-blog.csdnimg.cn/20201216201157475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>然后等待执行结束就可以了！<br><img src="https://img-blog.csdnimg.cn/20201216202952877.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>这样我们的数据库的内容，就全部迁移过去了,有点费劲。现在有个问题就是，这样我们的数据集就没有了主键。因此就不能进行编辑操作。因此，我们需要返回对象列表，点击修改表，点击修改字段部分，然后在第一行插入一个字段，我们称之为id。然后将这一列设置为主键，并且自动增长。<br><img src="https://img-blog.csdnimg.cn/20201216203412818.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>这样我们的数据库的操作就完成了。</p>
<p>当然数据库迁移的方式还有很多很多，比如我们可以直接写一个程序从本地数据库读取，然后往华为数据库添加，也是可以的。或者华为云提供的其他的迁移方式。</p>
<h4 id="求每天最大风速的时间和风向（结果可能多条记录）"><a href="#求每天最大风速的时间和风向（结果可能多条记录）" class="headerlink" title="求每天最大风速的时间和风向（结果可能多条记录）"></a>求每天最大风速的时间和风向（结果可能多条记录）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBDATE, <span class="built_in">Time</span>, WIND_SPD, WIND_DIR</span><br><span class="line"><span class="keyword">FROM</span> marinedata m1</span><br><span class="line"><span class="keyword">WHERE</span> WIND_SPD <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(WIND_SPD)</span><br><span class="line">	<span class="keyword">FROM</span> marinedata m2</span><br><span class="line">	<span class="keyword">WHERE</span> m1.OBDATE = m2.OBDATE</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> OBDATE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>我用的数据集的结果为：<br><img src="https://img-blog.csdnimg.cn/20201216214055680.png" alt="在这里插入图片描述"></p>
<h4 id="求每天最小风速的时间和风向（结果可能多条记录）"><a href="#求每天最小风速的时间和风向（结果可能多条记录）" class="headerlink" title="求每天最小风速的时间和风向（结果可能多条记录）"></a>求每天最小风速的时间和风向（结果可能多条记录）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBDATE, <span class="built_in">Time</span>, WIND_SPD, WIND_DIR</span><br><span class="line"><span class="keyword">FROM</span> marinedata m1</span><br><span class="line"><span class="keyword">WHERE</span> WIND_SPD <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span> (WIND_SPD)</span><br><span class="line">	<span class="keyword">FROM</span> marinedata m2</span><br><span class="line">	<span class="keyword">WHERE</span> m1.OBDATE = m2.OBDATE</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> OBDATE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201216214446329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h4 id="求温度最低时的时间，风速和风向"><a href="#求温度最低时的时间，风速和风向" class="headerlink" title="求温度最低时的时间，风速和风向"></a>求温度最低时的时间，风速和风向</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBDATE, <span class="built_in">Time</span>, WIND_SPD, WIND_DIR</span><br><span class="line"><span class="keyword">FROM</span> marinedata m1</span><br><span class="line"><span class="keyword">WHERE</span> TEMPERATURE_DB  <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span> (TEMPERATURE_DB )</span><br><span class="line">	<span class="keyword">FROM</span> marinedata m2</span><br><span class="line">	<span class="keyword">WHERE</span> m1.OBDATE = m2.OBDATE</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> OBDATE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201216220213432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h4 id="求温度最高时的时间，风速和风向"><a href="#求温度最高时的时间，风速和风向" class="headerlink" title="求温度最高时的时间，风速和风向"></a>求温度最高时的时间，风速和风向</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBDATE, <span class="built_in">Time</span>, WIND_SPD, WIND_DIR</span><br><span class="line"><span class="keyword">FROM</span> marinedata m1</span><br><span class="line"><span class="keyword">WHERE</span> TEMPERATURE_DB  <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(TEMPERATURE_DB )</span><br><span class="line">	<span class="keyword">FROM</span> marinedata m2</span><br><span class="line">	<span class="keyword">WHERE</span> m1.OBDATE = m2.OBDATE</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> OBDATE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201216220456833.png#pic_center" alt="在这里插入图片描述"></p>
<h4 id="求平均风速和温度"><a href="#求平均风速和温度" class="headerlink" title="求平均风速和温度"></a>求平均风速和温度</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(WIND_SPD) <span class="keyword">AS</span> Average_WIND_SP, <span class="keyword">AVG</span>(TEMPERATURE_DB) <span class="keyword">AS</span> Average_Temp</span><br><span class="line"><span class="keyword">FROM</span> marinedata</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201216221636266.png#pic_center" alt="在这里插入图片描述"></p>
<h4 id="求温差最大的日期"><a href="#求温差最大的日期" class="headerlink" title="求温差最大的日期"></a>求温差最大的日期</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBDATE, <span class="built_in">Time</span>, TEMPERATURE_DB - TEMPERATURE_DP <span class="keyword">AS</span> DIFF</span><br><span class="line"><span class="keyword">FROM</span> marinedata</span><br><span class="line"><span class="keyword">WHERE</span> TEMPERATURE_DB - TEMPERATURE_DP = (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(TEMPERATURE_DB - TEMPERATURE_DP)</span><br><span class="line">	<span class="keyword">FROM</span> marinedata</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201217101826858.png" alt="在这里插入图片描述"></p>
<h3 id="用户权限控制"><a href="#用户权限控制" class="headerlink" title="用户权限控制"></a>用户权限控制</h3><h4 id="练习创建不同的用户，并实现不同的权限控制语句"><a href="#练习创建不同的用户，并实现不同的权限控制语句" class="headerlink" title="练习创建不同的用户，并实现不同的权限控制语句"></a>练习创建不同的用户，并实现不同的权限控制语句</h4><ul>
<li>界面操作<br>其他操作-&gt;用户操作<br><img src="https://img-blog.csdnimg.cn/20201217104608148.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>主机地址表示允许通过此用户访问数据库服务器的客户端IP地址白名单，不填或填%表示所有IP地址。<br><img src="https://img-blog.csdnimg.cn/20201217105702616.png" alt="在这里插入图片描述"><br>这里我们可以看到一些对全局表的操作权限设置。这里我配置一个select的权限测试一下。</li>
</ul>
<p>如果想要对某一个数据库进行权限赋予，则需要在对象权限里面进行编辑，如果想要针对某一个表的话，则需要在表/视图里面进行勾选，选择相应的表格即可。<br><img src="https://img-blog.csdnimg.cn/20201217105925126.png" alt="在这里插入图片描述"><br>这里我选择了 select 和 Delete的权限</p>
<p>然后返回到登陆界面，新增一个数据库登陆，将我们刚刚新添加的数据库的登陆添加上，测试连接成功后即可使用。<br><img src="https://img-blog.csdnimg.cn/20201217111327362.png" alt="在这里插入图片描述"><br>现在我执行一个updata操作，看结果<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---------------开始执行---------------</span><br><span class="line">【拆分SQL完成】：将执行SQL语句数量：（<span class="number">1</span>条）</span><br><span class="line">【执行SQL：(<span class="number">1</span>)】</span><br><span class="line">UPDATE marinedata SET TEMPERATURE_DB =<span class="number">0</span> WHERE id =<span class="number">1</span></span><br><span class="line">执行失败，失败原因：UPDATE command denied to user <span class="string">'666'</span>@<span class="string">'***'</span> <span class="keyword">for</span> table <span class="string">'marinedata'</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到，执行失败了，因为我没有给这个表赋予updata权限。<br>我们在执行一个select的操作，查询id为2的数据<br><img src="https://img-blog.csdnimg.cn/20201217111939871.png" alt="在这里插入图片描述"><br>可以看到我们已经执行成功了。</p>
<ul>
<li>语句操作</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*COMMON SETTINGS</span></span><br><span class="line"><span class="comment">创建一个用户，666代表用户名，100.% 表示所有的ip地址都可以访问，我们也可以换成指定的ip地址。identified by表示的是用户的密码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'666'</span>@<span class="string">'100.%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'******'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*GLOBAL SETTINGS</span></span><br><span class="line"><span class="comment">权限分配的语句为GRANT，这条语句的意思是将SELECT这个权限给所有的表，用户为666这个用户</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'666'</span>@<span class="string">'100.%'</span>;</span><br></pre></td></tr></table></figure>
<h4 id="权限授权和回收"><a href="#权限授权和回收" class="headerlink" title="权限授权和回收"></a>权限授权和回收</h4><p>权限授权上面已经说了，权限回收的界面操作，按照上面的步骤将勾选的权限删除掉即可。<br>使用语句进行权限回收-<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> *.* <span class="keyword">FROM</span> <span class="string">'666'</span>@<span class="string">'100.%'</span>;</span><br></pre></td></tr></table></figure></p>
<p>【拆分SQL完成】：将执行SQL语句数量：（1条）<br>【执行SQL：(1)】<br>REVOKE SELECT ON <em>.</em> FROM ‘666‘@’100.%’<br>执行成功，耗时：[13ms.]</p>
<p>这样权限就回收了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/12/17/华为云RDS操作实践/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="华为云RDS操作实践">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-BOM_DOM编程总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/12/05/BOM_DOM编程总结/" class="article-date">
  	<time datetime="2020-12-05T06:52:20.650Z" itemprop="datePublished">2020-12-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/12/05/BOM_DOM编程总结/">
        js-BOM_DOM总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="BOM"><a href="#BOM" class="headerlink" title="BOM"></a>BOM</h2><p>Browser Object Model(浏览器对象模型)<br>JS是由浏览器中内置的js脚本执行解释器程序来执行js的脚本语言的。<br>为了方便操作，js封装了对浏览器的各个对象使得开发者可以方便的操作浏览器。</p>
<h3 id="window对象"><a href="#window对象" class="headerlink" title="window对象"></a>window对象</h3><p>是javascript层级中的顶层对象，是代表浏览器窗口或一个框架，该对象在<body>或者<frameset>每次出现的时候都被自动创建。</frameset></body></p>
<ul>
<li>moveto() 将窗口左上角的屏幕位置移动到指定的x和y位置</li>
<li>moveby() 相对于目前的位置移动</li>
<li>resizeTo() 调整当前浏览器的窗口</li>
<li>open() 打开新的窗口显示指定的URL</li>
<li>setTimeout(vCode,iMilliseconds) 超时后执行代码</li>
<li>setInterval(vCode,iMilliSeconds) 定时执行代码，第一次也是先到执行时在执行<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3>所有的事件都是以o n开头，后面的是事件的触发方式。如：<br>o’clock 表示单击<br>onkeydown 表示键按下</li>
</ul>
<h4 id="鼠标点击事件"><a href="#鼠标点击事件" class="headerlink" title="鼠标点击事件"></a>鼠标点击事件</h4><ul>
<li>o’clock 用户使用鼠标左键单击对象的时候触发</li>
<li>ondbclick 当用户双击对象的时候触发</li>
<li>onmousedown 当用户在鼠标位于对象之上的时候，释放鼠标按钮时候触发</li>
<li>onmouseout 当用户将鼠标指针移出对象边界的时候触发</li>
<li>onmousemove 当用户将鼠标划过对象的时候触发</li>
<li>onblur 在对象失去输入焦点的时候触发</li>
<li>onfocus 当对象获得焦点的时候触发</li>
<li>onchange 当对象或选中区的内容改变的时候触发</li>
<li>o load 在浏览器完成对象的装载后立即触发</li>
<li><p>o submit 当表单将要被提交的时候触发</p>
<h3 id="location对象"><a href="#location对象" class="headerlink" title="location对象"></a>location对象</h3><p>location对象是由js runtime engine自动创建的，包含有关当前URL 的信息。<br>location 中的重要方法：</p>
<pre><code>href 属性 设置或获取整个 URL 为字符串
reload（）重新装入当前页面
</code></pre><h3 id="screen-对象"><a href="#screen-对象" class="headerlink" title="screen 对象"></a>screen 对象</h3><p>js自动创建的，包含有关客户机显示屏幕的信息<br>属性：</p>
<ul>
<li>availHeight 获取系统屏幕的工作区域高度 ，排除任务栏</li>
<li>availWidth 获取系统屏幕的工作区域的宽度 排除任务栏</li>
<li>height 获取屏幕的垂直分辨率</li>
<li>width 获取屏幕的水平分辨率</li>
</ul>
<p>案例：</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.write(<span class="string">"屏幕工作区: "</span> + screen.availHeight + <span class="string">", "</span> + screen.availWidth + <span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">	<span class="built_in">document</span>.write(<span class="string">"屏幕分辨率: "</span> + screen.height + <span class="string">", "</span> + screen.width + <span class="string">"&lt;br&gt;"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="document-对象"><a href="#document-对象" class="headerlink" title="document 对象"></a>document 对象</h3><p>该对象代表整个文档页面<br>对象的集合：</p>
<ul>
<li>all 获取页面所有的元素对象</li>
<li>forms 获取页面所有的表单对象</li>
<li>images 获取页面所有的图片对象</li>
<li>links 获取所有的超链接 或者area对象<h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2>全称Document Object Model 即文档对象模型。<br>该模型描绘了一个层次化的树，允许开发人员添加、删除、修改页面的某一部分。<br>浏览器在解析HTML的时候，其实不是按照一行一行读取并解析的，而是将HTML页面中的每一个标记按照顺序在内存中组建一颗DOM树，组建好之后，按照树的结构将页面显示在浏览器窗口中。</li>
</ul>
<p>节点最多有一个父亲节点，可以有多个子节点。<br>HTML DOM 定义访问和操作HTML 文档的标准方法。</p>
<ul>
<li>document 代表当前页面的整个文档树</li>
<li><p>访问属性</p>
<ul>
<li>all</li>
<li>forms</li>
<li>images</li>
<li>links</li>
<li>body</li>
</ul>
<p>访问方法（最常用的是DOM方法）</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">      <span class="comment">//获取Dom树 获取document对象</span></span><br><span class="line">      <span class="keyword">var</span> dom  = <span class="built_in">window</span>.document;</span><br><span class="line">      <span class="comment">//获取界面的所有元素</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">testAll</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> allarr = dom.all;</span><br><span class="line">          alert(allarr.length);</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span>  i =<span class="number">0</span>;i&lt;allarr.length;i++)&#123;</span><br><span class="line">              <span class="comment">//获取节点的名字</span></span><br><span class="line">              alert(allarr[i].nodeName)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//anchors 获取页面中的所有锚连接</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">testAnchors</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> anaArr = dom.anchors;</span><br><span class="line">          alert(anaArr.length);</span><br><span class="line">          alert(anaArr[<span class="number">0</span>].nodeName);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//获取所有的form对象</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">testForms</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> formARR = dom.forms;</span><br><span class="line">          alert(formARR.length)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//images</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">testimage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> ima = dom.images;</span><br><span class="line">          alert(ima.length)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//获取页面的所有连接</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">testlinks</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> lin = dom.links;</span><br><span class="line">          alert(lin.length)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="获取节点对象的案例"><a href="#获取节点对象的案例" class="headerlink" title="获取节点对象的案例"></a>获取节点对象的案例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getobj</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="comment">//根据标签id获取对象</span></span><br><span class="line">            <span class="keyword">var</span> a = <span class="built_in">document</span>.getElementById(<span class="string">"1"</span>)</span><br><span class="line">            alert(a.nodeName)</span><br><span class="line">           <span class="comment">//根据标标签属性名称获取对象</span></span><br><span class="line">            <span class="keyword">var</span> b = <span class="built_in">document</span>.getElementsByName(<span class="string">"bu"</span>)</span><br><span class="line">            alert(b.length)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//根据标签名称获取对象</span></span><br><span class="line">            <span class="keyword">var</span> c = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>)</span><br><span class="line">            alert(c.length)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="通过节点关系查找节点"><a href="#通过节点关系查找节点" class="headerlink" title="通过节点关系查找节点"></a>通过节点关系查找节点</h3><p>//从一个节点开始出发 进行查找</p>
<ul>
<li>parentNode 获取当前节点的父亲节点</li>
<li>childNodes 获取当前节点的孩子节点</li>
<li>firstChild 获取当前节点的第一个孩子节点</li>
<li>lastChild 获取当前节点的最后一个孩子节点</li>
<li>nextSibling 获取当前节点的兄弟节点<br> 注意这个有一个隐藏的文本标签 </li>
<li>previousSibling 获取当前节点的上一个节点<h3 id="获取节点对象的信息"><a href="#获取节点对象的信息" class="headerlink" title="获取节点对象的信息"></a>获取节点对象的信息</h3>每个节点都包含的信息的，这些属性是：</li>
<li>nodType 节点类型</li>
<li>元素  返回1 </li>
<li>文本 返回3</li>
<li>注释 返回8</li>
<li>nodeName 节点名称</li>
<li>元素节点的nodeName是标签的名称</li>
<li>属性节点的nodeName是属性名称</li>
<li>文本节点的nodeName 永远是#text</li>
<li>文档节点的nodeName 永远是#document</li>
<li>nodeValue 节点值</li>
<li>对于文本节点 nodeValue 属性是包含的文本</li>
<li>对于属性节点 nodeValue属性是属性值</li>
<li>对于注释节点 nodeValue属性注释内容</li>
<li>nodeValue属性对文档节点和元素节点是不可用的<h2 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h2><h3 id="创建新的节点"><a href="#创建新的节点" class="headerlink" title="创建新的节点"></a>创建新的节点</h3></li>
<li>document.createElement(“标签名”) 创建新元素节点</li>
<li>elt.setAttribute(“属性名”,”属性值”）设置属性</li>
<li>elt.appendChild(e)</li>
<li>elt.insertBefore(new,child) 添加到elt中，child之前</li>
<li>elt.removeChild(eChild) 删除指定的子节点</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script type="text/</span>javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">       var count =1;</span></span><br><span class="line"><span class="string">       function add() &#123;</span></span><br><span class="line"><span class="string">           var trNode = document.createElement("</span>tr<span class="string">");</span></span><br><span class="line"><span class="string">           var tdNode = document.createElement("</span>td<span class="string">");</span></span><br><span class="line"><span class="string">           var inputNode  = document.createElement("</span>input<span class="string">");</span></span><br><span class="line"><span class="string">           inputNode.setAttribute("</span>type<span class="string">","</span>button<span class="string">");</span></span><br><span class="line"><span class="string">           inputNode.setAttribute("</span>value<span class="string">",count++);</span></span><br><span class="line"><span class="string">           count++;</span></span><br><span class="line"><span class="string">           tdNode.appendChild(inputNode);</span></span><br><span class="line"><span class="string">           trNode.appendChild(tdNode);</span></span><br><span class="line"><span class="string">           //trNode添加到指定的位置上</span></span><br><span class="line"><span class="string">           var tbodyNode = document.getElementsByTagName("</span>tbody<span class="string">")[0];</span></span><br><span class="line"><span class="string">           var button1 = document.getElementById("</span>b1<span class="string">");</span></span><br><span class="line"><span class="string">           tbodyNode.insertBefore(trNode,button1);</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;table&gt;</span></span><br><span class="line"><span class="string">      &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td&gt;</span></span><br><span class="line"><span class="string">              &lt;input type="</span>button<span class="string">" value="</span><span class="number">0</span><span class="string">" &gt;</span></span><br><span class="line"><span class="string">          &lt;/td&gt;</span></span><br><span class="line"><span class="string">      &lt;/tr&gt;</span></span><br><span class="line"><span class="string">      &lt;tr id="</span>b1<span class="string">"&gt;</span></span><br><span class="line"><span class="string">          &lt;td&gt;</span></span><br><span class="line"><span class="string">              &lt;input type="</span>button<span class="string">" value="</span>添加<span class="string">" onclick="</span>add()<span class="string">"&gt;</span></span><br><span class="line"><span class="string">          &lt;/td&gt;</span></span><br><span class="line"><span class="string">      &lt;/tr&gt;</span></span><br><span class="line"><span class="string">  &lt;/table&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="几个小案例"><a href="#几个小案例" class="headerlink" title="几个小案例"></a>几个小案例</h2><h3 id="生成二级城市联动菜单"><a href="#生成二级城市联动菜单" class="headerlink" title="生成二级城市联动菜单"></a>生成二级城市联动菜单</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;二级联动菜单&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script type="text/</span>javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        function selcity() &#123;</span></span><br><span class="line"><span class="string">            //每一个省建立一个二维数组</span></span><br><span class="line"><span class="string">            var arr = [['--选择城市--'],['海淀区','朝阳区','东城区','西城区']</span></span><br><span class="line"><span class="string">                ,['沈阳','大连','鞍山','抚顺']</span></span><br><span class="line"><span class="string">                ,['济南','青岛','烟台','威海']</span></span><br><span class="line"><span class="string">                ,['石家庄','廊坊','唐山','秦皇岛']];</span></span><br><span class="line"><span class="string">            //获取选择的省的角标</span></span><br><span class="line"><span class="string">            var selNode = document.getElementById("</span>selid<span class="string">");</span></span><br><span class="line"><span class="string">            var index = selNode.selectedIndex;</span></span><br><span class="line"><span class="string">            var cities = arr[index];</span></span><br><span class="line"><span class="string">            var subSelNode = document.getElementById("</span>subselid<span class="string">")</span></span><br><span class="line"><span class="string">            //清除下拉菜单的内容</span></span><br><span class="line"><span class="string">            subSelNode.options.length = 0;</span></span><br><span class="line"><span class="string">            for(var x =0;x&lt;cities.length;x++)&#123;</span></span><br><span class="line"><span class="string">               var optNode = document.createElement("</span>option<span class="string">");</span></span><br><span class="line"><span class="string">               optNode.innerHTML = cities[x];</span></span><br><span class="line"><span class="string">               subSelNode.appendChild(optNode);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;select id="</span>selid<span class="string">" onchange="</span>selcity()<span class="string">"&gt;</span></span><br><span class="line"><span class="string">      &lt;option&gt;--选择省市--&lt;/option&gt;</span></span><br><span class="line"><span class="string">      &lt;option&gt;北京市&lt;/option&gt;</span></span><br><span class="line"><span class="string">      &lt;option&gt;辽宁省&lt;/option&gt;</span></span><br><span class="line"><span class="string">      &lt;option&gt;山东省&lt;/option&gt;</span></span><br><span class="line"><span class="string">      &lt;option&gt;河北省&lt;/option&gt;</span></span><br><span class="line"><span class="string">  &lt;/select&gt;</span></span><br><span class="line"><span class="string">  &lt;select id="</span>subselid<span class="string">"&gt;</span></span><br><span class="line"><span class="string">      &lt;option&gt;--选择城市--&lt;/option&gt;</span></span><br><span class="line"><span class="string">  &lt;/select&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="生产一个验证码"><a href="#生产一个验证码" class="headerlink" title="生产一个验证码"></a>生产一个验证码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;验证码&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script type="text/</span>javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">      function createCode() &#123;</span></span><br><span class="line"><span class="string">          var datas = ["</span>A<span class="string">", "</span>B<span class="string">", "</span>C<span class="string">", "</span>D<span class="string">", "</span>E<span class="string">", "</span>F<span class="string">", "</span>G<span class="string">", "</span>H<span class="string">", "</span>Z<span class="string">", "</span><span class="number">0</span><span class="string">", "</span><span class="number">1</span><span class="string">", "</span><span class="number">2</span><span class="string">", "</span><span class="number">3</span><span class="string">", "</span><span class="number">4</span><span class="string">", "</span><span class="number">5</span><span class="string">", "</span><span class="number">6</span><span class="string">", "</span><span class="number">7</span><span class="string">", "</span><span class="number">8</span><span class="string">", "</span><span class="number">9</span><span class="string">"];</span></span><br><span class="line"><span class="string">          //随机从数组中取出4个元素</span></span><br><span class="line"><span class="string">          var mess = "</span><span class="string">";</span></span><br><span class="line"><span class="string">          var index = 0;</span></span><br><span class="line"><span class="string">          for (var i = 0; i &lt; 4; i++) &#123;</span></span><br><span class="line"><span class="string">              //生成随机数 而且是在数组的长度范围内</span></span><br><span class="line"><span class="string">              //0-9 之间的随机数，Math.floor(Math.random()*10)</span></span><br><span class="line"><span class="string">              //0到数组长度（不包含）之间的浮点数 向下取整</span></span><br><span class="line"><span class="string">              var index = Math.floor(Math.random() * datas.length);</span></span><br><span class="line"><span class="string">              mess += datas[index];</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          ;</span></span><br><span class="line"><span class="string">          var codeSpan = window.document.getElementById("</span>codeSpan<span class="string">");</span></span><br><span class="line"><span class="string">          codeSpan.style.color = "</span>red<span class="string">"</span></span><br><span class="line"><span class="string">          codeSpan.style.fontSize = "</span><span class="number">20</span>px<span class="string">"</span></span><br><span class="line"><span class="string">          codeSpan.style.background = "</span>gray<span class="string">"</span></span><br><span class="line"><span class="string">          codeSpan.style.fontStyle = "</span>italic<span class="string">"</span></span><br><span class="line"><span class="string">          codeSpan.style.textDecoration = "</span>line-through<span class="string">"</span></span><br><span class="line"><span class="string">          codeSpan.innerHTML = mess;</span></span><br><span class="line"><span class="string">          codeSpan.value = mess;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body onload="</span>createCode()<span class="string">"&gt;</span></span><br><span class="line">   &lt;span id="codeSpan"&gt;&lt;/span&gt;&lt;a href="#" onclick="createCode()"&gt;看不清楚&lt;/a&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/12/05/BOM_DOM编程总结/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="js-BOM_DOM总结">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Annotation" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/12/04/Annotation/" class="article-date">
  	<time datetime="2020-12-04T07:02:03.810Z" itemprop="datePublished">2020-12-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/12/04/Annotation/">
        Annotation总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>从JKD5开始，java增加了对元数据的支持，也就是Annotation,这是代码里的特殊标记，这些标记可以在编译、类加载、运行的是时候被读取，并且能够执行相应的处理。<br>通过使用Annotation ，我们可以在开发过程中，在不改变原有逻辑的情况下，在源文件中补充一些信息。<br>Annotation 可以用于修饰包、类、构造器、方法、成员变量、参数和局部变量的声明。</p>
<h2 id="四个基本的Annotation"><a href="#四个基本的Annotation" class="headerlink" title="四个基本的Annotation"></a>四个基本的Annotation</h2><h3 id="Override-重写父类方法"><a href="#Override-重写父类方法" class="headerlink" title="@Override (重写父类方法)"></a>@Override (重写父类方法)</h3><p>用来指定方法覆载的，它可以强制一个子类必须覆盖父类的方法。<br>在使用这个注解的时候，可能看不出来效果，这个的主要作用是检查一下父类中，是不是有一个相同的方法被重写！</p>
<h3 id="Deprecated-标示已经过时"><a href="#Deprecated-标示已经过时" class="headerlink" title="@Deprecated(标示已经过时)"></a>@Deprecated(标示已经过时)</h3><p>用于表示某个程序元素已经过时，当其他程序使用已经过时的类、方法的时候，编译器将会给出警告。</p>
<h3 id="SuppressWarnings-抑制编译器警告"><a href="#SuppressWarnings-抑制编译器警告" class="headerlink" title="@SuppressWarnings(抑制编译器警告)"></a>@SuppressWarnings(抑制编译器警告)</h3><p>指示被该Annotation修饰的程序元素取消显示指定的编译器警告，会一直作用于该程序元素的所有子元素。在使用的过程总，一定要在括号里面使用name = value的形式 ！即 @SuppressWarnings(value = “unchecked”)<br>unchecked就是一个未经过检查的转换</p>
<h3 id="java7-的堆污染警告-SafeVarargs"><a href="#java7-的堆污染警告-SafeVarargs" class="headerlink" title="java7 的堆污染警告@SafeVarargs"></a>java7 的堆污染警告@SafeVarargs</h3><p>当把一个不带范型的对象赋给一个带范型的变量的时候，往往就会发生“堆污染”。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">list.add(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<p>对于形式参数可变的方法，该形参类型又是范型，这将更容易导致“堆污染”。<br>（java不支持范型数组）</p>
<h2 id="JDK基本的元Annotation"><a href="#JDK基本的元Annotation" class="headerlink" title="JDK基本的元Annotation"></a>JDK基本的元Annotation</h2><h3 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h3><p>只能用来修饰一个Annotation定义，用于指定被修饰的Annotation可以存活多长时间。后面必须跟着一个值（三个限定）<br>例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(value=RetentionPolicy.SOURCE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Testtable&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h3><p>只能修饰一个Annotation定义，用于指定被修饰的Annotation能用于修饰哪些程序单元。(有八个程序变量的值)<br>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ActionListenerErro&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a>@Documented</h3><p>用于指定这个Annotation类可以被javadoc工具提取成文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="comment">//使用Documented修饰 一个类 用作Annotation ，这个类可以被javadoc工具提取成文档</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Testtable&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>然后使用Testtable修饰 其他类的方法，就会被提取成文档</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="meta">@Testtable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"info方法..."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h3><p>如果定义某一个Annotation的时候，这个类被@Inherited修饰，则继承了该类的子类将会被@A修饰。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Inheritable&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中粗体字代码表明@Inheritable 具有继承性，如果某个类使用了@Inheritable修饰，则该类的子类将自动使用@Inheritable修饰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inheritable</span></span><br><span class="line">class Base[</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//InheritableTest 类只继承了Base类</span></span><br><span class="line"><span class="comment">// 并未直接使用@Inheritable Annotiation修饰</span></span><br><span class="line">public class InheritableTest extends Base[</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//打印InheritableTest类是否具有@Inheritable修饰</span></span><br><span class="line">System.out.println(InheritableTest.class.isAnnotationPresent(Inheritable.class));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的Ba se类使用@Inheritable修饰，而该Annotation具有继承性，所以其子类也将自动使用@Inheritable修饰。上面程序输出 true</p>
<h2 id="自定义Annotation"><a href="#自定义Annotation" class="headerlink" title="自定义Annotation"></a>自定义Annotation</h2><p>自定义Annotation使用@interface关键字定义一个新的Annotation 类型与定义一个接口非常像。</p>
<h3 id="标记Annotation-无参数"><a href="#标记Annotation-无参数" class="headerlink" title="标记Annotation(无参数)"></a>标记Annotation(无参数)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个简单的Annotation</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Test&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用Annotation的时候，通常可以用来修饰程序中的类、方法、变量、接口等定义。通常Annotation放在所有的修饰符之前。</p>
<h3 id="元数据Annotation-有参数"><a href="#元数据Annotation-有参数" class="headerlink" title="元数据Annotation(有参数)"></a>元数据Annotation(有参数)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> mytage&#123;</span><br><span class="line"><span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>带有成员变量的Annotation 的定义是以无形参的方法形式来声明，其方法名和返回值定义了该成员变量的名字和类型。<br>在使用的时候，应该写为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@mytage</span>(name=<span class="string">"xx"</span>,age=<span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<h4 id="也可以设置默认值"><a href="#也可以设置默认值" class="headerlink" title="也可以设置默认值"></a>也可以设置默认值</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> mytage&#123;</span><br><span class="line"><span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> "yeeku"</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span> <span class="keyword">default</span> 2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="提取Annotation信息"><a href="#提取Annotation信息" class="headerlink" title="提取Annotation信息"></a>提取Annotation信息</h3><p>开发者使用Annotation 修饰了类、方法、Field等成员之后，这些Annotation不会自己生效，必须由开发者提供相应的工具来提取并处理Annotation信息。</p>
<p>java5在java.lang.reflect包下新增加了AnnotatedElement接口，该接口代表程序中可以接受注释的程序元素。<br>该接口主要有如下几个实现类：</p>
<ul>
<li>Class 类定义</li>
<li>Constructor 构造器定义</li>
<li>Field 类的成员变量定义</li>
<li>Method 类的方法定义</li>
<li>Package 类的包定义</li>
</ul>
<p>程序可以通过调用某一个类的如下三种方法来访问Annotation信息</p>
<ul>
<li>getAnnotation(Class<t> annoClass)</t></li>
<li>Annotation[] getAnnotations() 返回该程序元素上存在的所有的注释</li>
<li>boolean isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass): 判断该程序上是否存在指定类型的注释，如果存在则返回true,否则返回false.<br><strong>例如：</strong>获取Test类的info 方法里面的所有的注释</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Annotation [] aArray = Class.forName(<span class="string">"Test"</span>).getMethod(<span class="string">"info"</span>).getAnnotations()</span><br></pre></td></tr></table></figure>
<h2 id="使用Annotation-的示例"><a href="#使用Annotation-的示例" class="headerlink" title="使用Annotation 的示例"></a>使用Annotation 的示例</h2><p>仅仅使用注释来标记程序元素是不会有任何影响的，为了让程序中的这些注释起作用，接下来必须为这些注释提供一个注释处理工具，注释处理工具通过分析目标类中的注释，然后在通过反射来运行标记的测试方法，程序可以做出相应的处理。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>在示例程序中通过使用@ActionListenerFor来为程序中的按钮绑定事件监听器</p>
<ul>
<li>首先创建一个标记，该标记需要传入一个监听器实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AnnotationExample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ActionListenerFor &#123;</span><br><span class="line">  <span class="comment">//定义一个成员变量，用于设置元数据</span></span><br><span class="line">  <span class="comment">//该listener 成员变量用于保存监听器实现类</span></span><br><span class="line">	Class&lt;? extends ActionListener&gt; listener();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>然后，创建两个监听器的实现类<br>确认按钮实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AnnotationExample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OkListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		JOptionPane.showMessageDialog(<span class="keyword">null</span>,<span class="string">"单击了确认按钮"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>取消按钮实现类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AnnotationExample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CancelListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		JOptionPane.showMessageDialog(<span class="keyword">null</span>,<span class="string">"单击了取消按钮"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果仅仅在程序中使用注释是不会起任何作用的，需要编写一个注释处理工具来处理程序中的注释</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AnnotationExample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.AbstractButton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionListenerInstaller</span> </span>&#123;</span><br><span class="line">	<span class="comment">//处理Annotation 的方法，其中obj是包含Annotation的对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">processAnnotations</span><span class="params">(Object obj)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class cl = obj.getClass();</span><br><span class="line">			<span class="comment">//获取指定的obj 对象的所有Field 并遍历每个field</span></span><br><span class="line">			<span class="keyword">for</span>(Field f: cl.getDeclaredFields()) &#123;</span><br><span class="line">				<span class="comment">//将指定的Field设置成可自由访问</span></span><br><span class="line">				f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">				<span class="comment">//获取指定Field 上的ActionListenerFor类型的Annotation</span></span><br><span class="line">				ActionListenerFor a = f.getAnnotation(ActionListenerFor.class);</span><br><span class="line">				<span class="comment">//获取f Field 实际对应的对象</span></span><br><span class="line">				Object fobj = f.get(obj);</span><br><span class="line">				<span class="comment">//如果f是AbstractButton 的实例，并且a不为null</span></span><br><span class="line">				<span class="keyword">if</span>(a!=<span class="keyword">null</span> &amp;&amp; fobj != <span class="keyword">null</span> &amp;&amp; fobj <span class="keyword">instanceof</span> AbstractButton) &#123;</span><br><span class="line">					<span class="comment">//获取a注释 里的元数据listener (它是一个监听器类)</span></span><br><span class="line">					Class&lt;? extends ActionListener&gt; listenerClazz = a.listener();</span><br><span class="line">					<span class="comment">//使用反射来创建listener类的对象</span></span><br><span class="line">					ActionListener al = listenerClazz.newInstance();</span><br><span class="line">					AbstractButton ab = (AbstractButton)fobj;</span><br><span class="line">					<span class="comment">//为ab按钮添加事件监听器</span></span><br><span class="line">					ab.addActionListener(al);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>主程序</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AnnotationExample;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JButton;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JFrame;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JPanel;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> JFrame mainWin = <span class="keyword">new</span> JFrame(<span class="string">"使用注释绑定事件监听器"</span>);</span><br><span class="line">	<span class="comment">//使用Annotation 为ok 按钮绑定事件监听器</span></span><br><span class="line">	<span class="meta">@ActionListenerFor</span>(listener = OkListener.class)</span><br><span class="line">	<span class="keyword">private</span> JButton ok = <span class="keyword">new</span> JButton(<span class="string">"确定"</span>);</span><br><span class="line">	<span class="meta">@ActionListenerFor</span>(listener = CancelListener.class)</span><br><span class="line">	<span class="keyword">private</span> JButton cancle = <span class="keyword">new</span> JButton(<span class="string">"取消"</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="comment">//初始化界面的方法</span></span><br><span class="line">    	JPanel jp = <span class="keyword">new</span> JPanel();</span><br><span class="line">    	jp.add(ok);</span><br><span class="line">    	jp.add(cancle);</span><br><span class="line">    	mainWin.add(jp);</span><br><span class="line">    	<span class="comment">//</span></span><br><span class="line">    	ActionListenerInstaller.processAnnotations(<span class="keyword">this</span>);</span><br><span class="line">    	mainWin.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">    	mainWin.pack();</span><br><span class="line">    	mainWin.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">new</span> AnnotationTest().init();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="编译时处理Annotation"><a href="#编译时处理Annotation" class="headerlink" title="编译时处理Annotation"></a>编译时处理Annotation</h2><p>APT（Annotation Processing Tool）是一种注释处理工具，它对源代码文件进行检测找出其中的Annotation后，对Annotation 进行额外的处理。<br>Annotation处理器 在处理Annotation的时候可以根据源文件中的Annotation生成额外的源文件和其他文件，APT还会编译生成的源代码文件和原来的源文件，将他们一起生成class文件。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/12/04/Annotation/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="Annotation总结">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-NoSql和关系数据库的操作比较" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/11/13/NoSql和关系数据库的操作比较/" class="article-date">
  	<time datetime="2020-11-13T11:49:09.740Z" itemprop="datePublished">2020-11-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/13/NoSql和关系数据库的操作比较/">
        NoSql和关系数据库 的操作比较
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h2><p>NoSQL是一种不同于关系数据库管理系统设计方式，是对非关系型数据库的统称，它所采用的数据模型并非传统关系数据库的关系模型，而是类似键/值、列族、文档等非关系模型。NoSQL数据库没有固定的表结构，通常也不存在连接操作。<br>数据库的特点：</p>
<ul>
<li>扩展性<br>传统数据库很难实现横向扩展，NoSQL实现起来比较容易。</li>
<li>数据模型<br>关系模型是关系数据库的基石，它以完备的关系代数理论为基础。NoSQL数据库转用键/值、列族等非关系模型，允许在一个数据元素里面存储不同类型的数据。</li>
<li>与云计算紧密结合<br>云计算具有很好的水平扩展能力，可以根据资源使用情况进行自由伸缩，各种资源可以动态的加入。<h2 id="MySQL数据库"><a href="#MySQL数据库" class="headerlink" title="MySQL数据库"></a>MySQL数据库</h2>对于Mysql数据库的学习，这一块就不记录了！<br><a href="https://cattlez.github.io/2020/06/25/%E9%98%BF%E9%87%8C%E4%BA%91Ubuntu%E4%B8%8A%E5%AE%89%E8%A3%85mysql%E5%B9%B6%E8%BF%90%E8%A1%8C/" target="_blank" rel="noopener">阿里云安装</a><br><a href="https://cattlez.github.io/2020/07/05/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86/" target="_blank" rel="noopener">使用</a><h2 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h2><a href="https://cattlez.github.io/2020/10/15/%E5%A4%A7%E6%95%B0%E6%8D%AE-HBase%E5%AE%9E%E9%AA%8C%E4%BB%A5%E5%8F%8A%E8%AE%B2%E8%A7%A3/" target="_blank" rel="noopener">HBase的详细操作</a><br><img src="https://img-blog.csdnimg.cn/20201028105848597.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></li>
<li>3.a<br>首先启动shell<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hbase shell</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>执行创建表的操作(因为我里面有个student了就创建student2)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">'Student2'</span>,<span class="string">'score'</span></span><br></pre></td></tr></table></figure>
<p>添加数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put <span class="string">'Student2'</span>,<span class="string">'lisi'</span>,<span class="string">'score:English'</span>,<span class="string">'55'</span></span><br></pre></td></tr></table></figure>
<p>查询数据</p>
<p><img src="https://img-blog.csdnimg.cn/2020102815210326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>3.b</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">'Student2'</span>,<span class="string">'zhangsan'</span>,<span class="string">'score:Computer'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>3.c</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20201028152345432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<ol start="4">
<li>HBase API<br>函数在HBase中已经介绍过了,进行如下调用即可</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">init();</span><br><span class="line">insertData(<span class="string">"Student2"</span>, <span class="string">"scofield"</span>, <span class="string">"score"</span>, <span class="string">"English"</span>, <span class="string">"45"</span>);</span><br><span class="line">insertData(<span class="string">"Student2"</span>, <span class="string">"scofield"</span>, <span class="string">"score"</span>, <span class="string">"Math"</span>, <span class="string">"89"</span>);</span><br><span class="line">insertData(<span class="string">"Student2"</span>, <span class="string">"scofield"</span>, <span class="string">"score"</span>, <span class="string">"Computer"</span>, <span class="string">"100"</span>);</span><br></pre></td></tr></table></figure>
<p>查询数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">init();</span><br><span class="line">getData(<span class="string">"Student2"</span>,<span class="string">"scofield"</span>,<span class="string">"score"</span>,<span class="string">"English"</span>);</span><br><span class="line">close();</span><br></pre></td></tr></table></figure></p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>（流泪～～好多软件，心疼我的机子呀！又要含泪安装～～～）</p>
<h3 id="先来简单的了解一下Redis吧"><a href="#先来简单的了解一下Redis吧" class="headerlink" title="先来简单的了解一下Redis吧"></a>先来简单的了解一下Redis吧</h3><p><a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener">Redis的学习官网</a><br>Redis作为一个高性能的键值数据库，不仅在很大程度上弥补了memcached这类键值存储的不足(Redis值的存储最大可以为1GB)，而且在部分场合下可以对关系数据库起到很好的补充作用。</p>
<h3 id="Redis的安装"><a href="#Redis的安装" class="headerlink" title="Redis的安装"></a>Redis的安装</h3><p>安装软件的下载</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://download.redis.io/releases/redis-<span class="number">6.0</span>.<span class="number">9</span>.tar.gz</span><br><span class="line">$ sudo tar -zxvf ./redis-<span class="number">6.0</span>.<span class="number">9</span>.tar.gz -C /usr/local</span><br><span class="line">$ sudo mv ./redis-<span class="number">6.0</span>.<span class="number">9</span> ./redis</span><br></pre></td></tr></table></figure>
<p>更改目录的操作权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R hadoop:hadoop ./redis</span><br></pre></td></tr></table></figure>
<p>接下来，进入“/usr/local/redis”目录，输入以下命令编译和安装Redis</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure>
<p>然后开启redi s的服务<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/local/redis</span><br><span class="line">$ ./src/redis-server</span><br></pre></td></tr></table></figure></p>
<p>安装成功后会显示：<br><img src="https://img-blog.csdnimg.cn/2020111311252382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>接下来在开一个终端：<br>启动redis的客户端：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/local/redis</span><br><span class="line">$ ./src/redis-cli</span><br></pre></td></tr></table></figure>
<p>会显示：<br><code>127.0.0.1:6379&gt;</code><br>客户端连上服务器之后，会显示“127.0.0.1:6379&gt;”的命令提示符信息，表示服务器的IP地址为127.0.0.1，端口为6379。现在可以执行简单的操作。<br>操作任务同上<br><img src="https://img-blog.csdnimg.cn/20201028154815299.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h3 id="Redis-shell-的操作："><a href="#Redis-shell-的操作：" class="headerlink" title="Redis shell 的操作："></a>Redis shell 的操作：</h3><ul>
<li>设计数据表<br>lisi的插入操作过程是一样的：<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset student.zhangsan English <span class="number">69</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset student.zhangsan Math <span class="number">86</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset student.zhangsan Computer <span class="number">77</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>查询zhangsan的成绩：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall student.zhangsan</span><br><span class="line"><span class="number">1</span>) <span class="string">"Math"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"86"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"Computer"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"77"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"English"</span></span><br><span class="line"><span class="number">6</span>) <span class="string">"69"</span></span><br></pre></td></tr></table></figure>
<p>查询lisi的所有成绩：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall student.lisi</span><br><span class="line"><span class="number">1</span>) <span class="string">"English"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"55"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"Math"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"100"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"Computer"</span></span><br><span class="line"><span class="number">6</span>) <span class="string">"88"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>查询<br>zhangsan的computer成绩</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hget student.zhangsan Compute</span><br></pre></td></tr></table></figure>
<ul>
<li>修改<br>修改lisi的math成绩为95<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hset student.lisi Math <span class="number">95</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Redis-的java-API操作"><a href="#Redis-的java-API操作" class="headerlink" title="Redis 的java API操作"></a>Redis 的java API操作</h3><p>使用Redis在本机上进行操作需要首先添加一个<a href="https://mvnrepository.com/artifact/redis.clients/jedis/3.3.0" target="_blank" rel="noopener">Jedis的jar包</a><br>在里面进行搜索相应的版本即可。我这里用的是3.3.0版本.<br><strong>a) 添加数据</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ConnTest;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">jedis_test</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">        jedis.hset(<span class="string">"student.scofield"</span>, <span class="string">"English"</span>,<span class="string">"45"</span>);</span><br><span class="line">        jedis.hset(<span class="string">"student.scofield"</span>, <span class="string">"Math"</span>,<span class="string">"89"</span>);</span><br><span class="line">        jedis.hset(<span class="string">"student.scofield"</span>, <span class="string">"Computer"</span>,<span class="string">"100"</span>);</span><br><span class="line">        Map&lt;String,String&gt;  value = jedis.hgetAll(<span class="string">"student.scofield"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String, String&gt; entry:value.entrySet())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(entry.getKey()+<span class="string">":"</span>+entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行成功之后会显示：<br>Math:89<br>Computer:100<br>English:45<br><strong>b) 获取英语成绩</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ConnTest;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">jedis_test</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">            Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">            String value=jedis.hget(<span class="string">"student.scofield"</span>, <span class="string">"English"</span>);</span><br><span class="line">            System.out.println(<span class="string">"scofield's English score is:    "</span>+value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>补充</strong>：如果想要关闭掉Redis的服务器，可以在服务器的登陆成功的界面执行ctrl+C；如果是不小心关掉了界面，在登陆redis的时候发现服务器是开着的，我们又不想让他占用资源，可以通过执行<code>./src/redis-cli shutdown</code>然后查看是否还有redis的进程在活动<code>ps -ef | grep redis</code>，最后找到redis-server的进程号，执行<code>kill -9 进程号</code>。</p>
<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><p><a href="https://docs.mongodb.com/manual/" target="_blank" rel="noopener">官方学习网站</a><br>MongoDB 是一个是一个基于分布式文件存储的数据库，介于关系数据库和非关系数据库之间，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</p>
<h3 id="MongoDB的安装"><a href="#MongoDB的安装" class="headerlink" title="MongoDB的安装"></a>MongoDB的安装</h3><p>mongoDB直接通过apt-get install 就可以安装：<br>首先更新一下软件库。<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<p>然后在执行安装，这看起来简单多了：<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mongodb</span><br></pre></td></tr></table></figure></p>
<p>最后，检查一下是否安装成功：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongodb -version</span><br></pre></td></tr></table></figure>
<h3 id="实验操作"><a href="#实验操作" class="headerlink" title="实验操作"></a>实验操作</h3><p>实验操作要求与 mysql的实验要求是一样的。</p>
<ol>
<li>设计完成数据表</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; use student</span><br><span class="line">switched to db student</span><br><span class="line">&gt; var stus=[</span><br><span class="line">... &#123;<span class="string">"name"</span>:<span class="string">"zhangsan"</span>,<span class="string">"scores"</span>:&#123;<span class="string">"English"</span>:<span class="number">69</span>,<span class="string">"Math"</span>:<span class="number">86</span>,<span class="string">"Computer"</span>:<span class="number">77</span>&#125;&#125;,&#123;<span class="string">"name"</span>:<span class="string">"lisi"</span>,<span class="string">"score"</span>:&#123;<span class="string">"English"</span>:<span class="number">55</span>,<span class="string">"Math"</span>:<span class="number">100</span>,<span class="string">"Computer"</span>:<span class="number">88</span>&#125;&#125;]</span><br><span class="line">&gt; db.student.insert(stus)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>查询两个学生的信息</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.find().pretty()</span><br></pre></td></tr></table></figure>
<p>查询到的结果为：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"_id"</span> : ObjectId(<span class="string">"5fae58ca036d879c65db8de3"</span>),</span><br><span class="line">	<span class="string">"name"</span> : <span class="string">"zhangsan"</span>,</span><br><span class="line">	<span class="string">"scores"</span> : &#123;</span><br><span class="line">		<span class="string">"English"</span> : <span class="number">69</span>,</span><br><span class="line">		<span class="string">"Math"</span> : <span class="number">86</span>,</span><br><span class="line">		<span class="string">"Computer"</span> : <span class="number">77</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"_id"</span> : ObjectId(<span class="string">"5fae58ca036d879c65db8de4"</span>),</span><br><span class="line">	<span class="string">"name"</span> : <span class="string">"lisi"</span>,</span><br><span class="line">	<span class="string">"score"</span> : &#123;</span><br><span class="line">		<span class="string">"English"</span> : <span class="number">55</span>,</span><br><span class="line">		<span class="string">"Math"</span> : <span class="number">100</span>,</span><br><span class="line">		<span class="string">"Computer"</span> : <span class="number">88</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>查询zhangsan的成绩，只显示成绩</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.find(&#123;<span class="string">"name"</span>:<span class="string">"zhangsan"</span>&#125;,&#123;<span class="string">"_id"</span>:<span class="number">0</span>,<span class="string">"name"</span>:<span class="number">0</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>查询结果显示为：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"scores"</span> : &#123; <span class="string">"English"</span> : <span class="number">69</span>, <span class="string">"Math"</span> : <span class="number">86</span>, <span class="string">"Computer"</span> : <span class="number">77</span> &#125; &#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>修改lisi的成绩</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;<span class="string">"name"</span>:<span class="string">"lisi"</span>&#125;, &#123;<span class="string">"<span class="variable">$set</span>"</span>:&#123;<span class="string">"score.Math"</span>:<span class="number">95</span>&#125;&#125; )</span><br></pre></td></tr></table></figure>
<p>执行结果为：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : <span class="number">1</span>, <span class="string">"nUpserted"</span> : <span class="number">0</span>, <span class="string">"nModified"</span> : <span class="number">1</span> &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="用MongoDB的JAVA-API编程"><a href="#用MongoDB的JAVA-API编程" class="headerlink" title="用MongoDB的JAVA API编程"></a>用MongoDB的JAVA API编程</h3><p><a href="https://mvnrepository.com/artifact/org.mongodb/mongo-java-driver" target="_blank" rel="noopener">Mongo DB的驱动包</a><br>将驱动包添加到新创建的项目中。</p>
<ol>
<li>添加数据</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ConnTest;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.bson.Document;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCollection;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mongo_test</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//实例化一个mongo客户端</span></span><br><span class="line">        MongoClient  mongoClient=<span class="keyword">new</span> MongoClient(<span class="string">"127.0.0.1"</span>,<span class="number">27017</span>);</span><br><span class="line">        <span class="comment">//实例化一个mongo数据库</span></span><br><span class="line">        MongoDatabase mongoDatabase = mongoClient.getDatabase(<span class="string">"student"</span>);</span><br><span class="line">        <span class="comment">//获取数据库中某个集合</span></span><br><span class="line">        MongoCollection&lt;Document&gt; collection = mongoDatabase.getCollection(<span class="string">"student"</span>);</span><br><span class="line">        <span class="comment">//实例化一个文档,内嵌一个子文档</span></span><br><span class="line">        Document document=<span class="keyword">new</span> Document(<span class="string">"name"</span>,<span class="string">"scofield"</span>).</span><br><span class="line">                append(<span class="string">"score"</span>, <span class="keyword">new</span> Document(<span class="string">"English"</span>,<span class="number">45</span>).</span><br><span class="line">                        append(<span class="string">"Math"</span>, <span class="number">89</span>).</span><br><span class="line">                        append(<span class="string">"Computer"</span>, <span class="number">100</span>));</span><br><span class="line">        List&lt;Document&gt; documents = <span class="keyword">new</span> ArrayList&lt;Document&gt;();  </span><br><span class="line">        documents.add(document);  </span><br><span class="line">        <span class="comment">//将文档插入集合中</span></span><br><span class="line">        collection.insertMany(documents);  </span><br><span class="line">        System.out.println(<span class="string">"文档插入成功"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行成功后显示：文档插入成功</p>
<ol start="3">
<li>获取scofield的所有成绩成绩信息（只显示score列）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.bson.Document;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCollection;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCursor;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.model.Filters;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.mongodb.client.model.Filters.eq;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mongo_query</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//实例化一个mongo客户端</span></span><br><span class="line">        MongoClient  mongoClient=<span class="keyword">new</span> MongoClient(<span class="string">"127.0.0.1"</span>,<span class="number">27017</span>);</span><br><span class="line">        <span class="comment">//实例化一个mongo数据库</span></span><br><span class="line">        MongoDatabase mongoDatabase = mongoClient.getDatabase(<span class="string">"student"</span>);</span><br><span class="line">        <span class="comment">//获取数据库中某个集合</span></span><br><span class="line">        MongoCollection&lt;Document&gt; collection = mongoDatabase.getCollection(<span class="string">"student"</span>);</span><br><span class="line">        <span class="comment">//进行数据查找,查询条件为name=scofield, 对获取的结果集只显示score这个域</span></span><br><span class="line">        MongoCursor&lt;Document&gt;  cursor=collection.find( <span class="keyword">new</span> Document(<span class="string">"name"</span>,<span class="string">"scofield"</span>)).</span><br><span class="line">                projection(<span class="keyword">new</span> Document(<span class="string">"score"</span>,<span class="number">1</span>).append(<span class="string">"_id"</span>, <span class="number">0</span>)).iterator();</span><br><span class="line">        <span class="keyword">while</span>(cursor.hasNext())</span><br><span class="line">            System.out.println(cursor.next().toJson());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/11/13/NoSql和关系数据库的操作比较/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="NoSql和关系数据库 的操作比较">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-多线程基础总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/11/10/多线程基础总结/" class="article-date">
  	<time datetime="2020-11-10T08:30:18.480Z" itemprop="datePublished">2020-11-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/10/多线程基础总结/">
        多线程基础总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前有看过很多线程类的资料，但总是有一种雾里看花的感觉。基本的知识只能说是了解，但是基本的使用还有些困难。之前看了《JAVA编程思想》里面的介绍。感觉还是有些模糊，这里先对《疯狂java讲义》（这本书感觉应该是java入门级的扛把子吧！哈哈～）中的知识做一个整理吧！毕竟线程这块，就目前阶段用的还是比较少的，原因不是场景少，而是会用的人少。单线程的程序能力是有限的，很多工具用到了多线程，但是里面已经写好了，我们自然也就不关心了。例如：网络编程中的ServerSocket。这里先做一个知识点的整理，以后在抽时间做一些线程的项目加深一下理解。</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p>进程可以广义的理解为电脑中的一个应用、一个程序。大多数操作系统都支持多进程并发运行，这给我们感觉是这些进程都在同时进行工作，但是实际上对于一个CPU而言，它在某个时间点只能进行一个程序，然后CPU不断的在这些进程之间轮换执行。</p>
<h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><p>线程是进程的执行单元，在一个进程中可以同时并发的处理多个任务。</p>
<ul>
<li>单线程<br>单线程就是顺序的执行一个执行流。</li>
<li>多线程<br>多线程则是在一个可以包含多个执行流的程序中，多个顺序流之间互不干扰、独立并发的执行。<br><em>细节：（一个线程必须有一个父进程，线程之间可以拥有独立的堆栈，程序计数器和自己的局部变量，但是不用于独立的系统资源，线程之间的资源是共享的</em>）<h3 id="并行与并发"><a href="#并行与并发" class="headerlink" title="并行与并发"></a>并行与并发</h3></li>
<li>并发<br>同一个时刻只能有一条指令执行，但是多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果。</li>
<li>并行<br>在同一个时刻，有多条指令在多个处理器上同时执行。<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3>线程之间共享系统分配给一个进程的虚拟空间，以及资源。<br>线程之间能够共享内存，但是进程之间不能共享内存。<br>系统创建进程时需要为该进程重新分配系统资源，但是线程的单价就很小，因此使用多线程来实现多任务并发比多进程的效率高。<br>（读到这里，我可能明白了，之前的一个疑惑。假设我同时有n个馒头，我可以开多个吃的线程，来消灭它。当然也可以重复开多个进程来消灭它。上述才是线程的真正优势）<h2 id="线程的创建和启动"><a href="#线程的创建和启动" class="headerlink" title="线程的创建和启动"></a>线程的创建和启动</h2>（之前有总结过一个，说实话忘了）<h3 id="类继承Thread"><a href="#类继承Thread" class="headerlink" title="类继承Thread"></a>类继承Thread</h3></li>
<li>创建一个子类，继承Thread（extends Thread）</li>
<li>重写类的run()方法，这就是告诉程序，我是干啥的。</li>
<li><p>创建子类的实例，并调用start()方法来启动该线程。</p>
<h3 id="实现Runnable接口（implement-Runnable）"><a href="#实现Runnable接口（implement-Runnable）" class="headerlink" title="实现Runnable接口（implement Runnable）"></a>实现Runnable接口（implement Runnable）</h3></li>
<li><p>创建一个类实现Runnable接口创建线程类</p>
</li>
<li>重写run()方法</li>
<li>创建一个实现类的实例（一次就好）</li>
<li>以这个实例作为Thread的目标来创建Thread对象（new Thread(target)）</li>
<li>调用线程的start()方法，来启动该线程。</li>
</ul>
<p><em>注意：进行多线程编程的时候，要记得java程序运行时默认的主线程，main()方法是主线程的线程执行体。</em></p>
<h3 id="使用Callable-和-Future创建线程"><a href="#使用Callable-和-Future创建线程" class="headerlink" title="使用Callable 和 Future创建线程"></a>使用Callable 和 Future创建线程</h3><p>上面实现的Run方法都没有返回值，那么如何才能实现一个有返回值的方法呢<br>Java5 开始Java提供了一个Callable的接口，提供了一个call()方法可以作为线程的执行体。<em>可以有返回值 或者抛出异常</em><br>实现步骤如下：</p>
<ul>
<li>创建一个类实现Callable,实现call()方法，该call()方法作为线程的执行体，并且call()有返回值</li>
<li>创建一个Callable实现类的实例，实现FutureTask类包装Callable对象，这个FutureTask对象(接口)封装了Callable对象的call()方法的返回值。<br>FutureTask<object> tast = new FutureTask<object>(实例类名);</object></object></li>
<li>使用FutureTask对象作为Th re a d对象的target创建并启动新的线程</li>
<li>调用FutureTask对象的get()方法来获得子线程执行结束后的返回值<h3 id="三种方式的对比"><a href="#三种方式的对比" class="headerlink" title="三种方式的对比"></a>三种方式的对比</h3>方式一 ： 实现Runable和实现Callable接口可以归纳为一种实现方式<br>方式二：继承Thread类</li>
</ul>
<h4 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h4><ul>
<li>优势<br>1、可以继承其他的类<br>2、可以共享同一个target对象，非常适合多个相同的线程来处理同一份资源的情况</li>
<li>劣势<br>编程稍微复杂，如果需要访问当前线程，必须使用Thread.currentThread()</li>
</ul>
<h4 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h4><ul>
<li>优势<br>代码简单，访问当前线程只需使用this</li>
<li>劣势<br>线程已经继承了类，因此不能在继承其他父类</li>
</ul>
<h2 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h2><p>这一块对于以后做关于多线程的项目应该是非常重要的。<br>线程的生命周期主要分为一下五个方面：</p>
<ol>
<li>新建（New 使用new关键字创建对象，就是处于新建状态）、</li>
<li>就绪（Runable 调用线程的start()方法，就处于就绪状态）、</li>
<li>运行（run JVM里面的线程调度器 调度run方法执行就 处于运行状态）、</li>
<li><p>阻塞(Blocked )、当线程运行后，这个线程几乎不会一直执行的，而是由底层的调度策略决定的（一般使用抢占式的方式，即线程争抢有限的执行资源)<br>线程阻塞的主要原因有：<br><code>线程调用sleep();线程调用了一个I/O方法;线程试图获得一个同步监视器；线程等待某个通知；程序调用了线程的suspend()方法（resume()恢复）将线程挂起</code></p>
</li>
<li><p>死亡(dead 线程结束处于死亡状态；stop()方法被调用；抛出异常)<br>当主线程结束后，其他线程并不会受影响，子线程跟主线程的地位是一样的<br><em>注意：不要直接调用重写的run()方法，直接调用方法会让程序直接运行一次后结束，不是以线程状态进行执行的；要调用线程的start（)方法。</em><br>线程的五个状态之间是可以相互转化的。<br><img src="https://img-blog.csdnimg.cn/20201104211709692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="线程的控制"><a href="#线程的控制" class="headerlink" title="线程的控制"></a>线程的控制</h2><h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><p>使用方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>  <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="title">Test</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">			System.out.println(getName()+<span class="string">" "</span>+i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">//启动一个子线程</span></span><br><span class="line">		<span class="keyword">new</span> Test(<span class="string">"新的线程"</span>).start();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span>(i==<span class="number">20</span>) &#123;</span><br><span class="line">				Test te = <span class="keyword">new</span> Test(<span class="string">"join的线程"</span>);</span><br><span class="line">				te.start();</span><br><span class="line">				te.join();	</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(Thread.currentThread().getName()+<span class="string">" "</span>+i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>执行结果：<br>新的线程 15<br>main 19<br>….<br>join的线程 0<br>新的线程 24<br>join的线程 1<br>新的线程 25<br>…<br>join的线程 99<br>main 20</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">总结：从上述实验可以看出加入join线程的效果为，先是main主线程与新的线程抢占式执行，然后到main线程执行到19的时候，join的线程开始与新的线程交替执行，main线程等待join线程完全执行完毕后在继续执行。</span><br><span class="line">这是一个让一个线程等待另一个线程完成的方法。</span><br></pre></td></tr></table></figure>
<h4 id="后台线程"><a href="#后台线程" class="headerlink" title="后台线程"></a>后台线程</h4><p>该类线程是在程序后台运行的，目的是为其他的线程提供服务的。例如jvm的垃圾回收机制就是后台线程，<em>后台线程在前台线程全部执行结束后会自动的死亡</em>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将一个线程设置为后台线程的方法为：</span><br><span class="line">setDaemon(<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>
<p><em>注意：该方法必须设置在start()方法之前。</em></p>
<h4 id="线程睡眠sleep（）"><a href="#线程睡眠sleep（）" class="headerlink" title="线程睡眠sleep（）"></a>线程睡眠sleep（）</h4><p>sleep(long mills) 让当前正在执行的线程暂停mills毫秒，并进入阻塞状态。</p>
<h4 id="线程让步-yield"><a href="#线程让步-yield" class="headerlink" title="线程让步 yield"></a>线程让步 yield</h4><p>yield方法与sleep方法有点相似，该方法可以让程序停下来，但是不会阻塞该线程，而是让该线程进入到就绪状态，然后由线程调度器调度。当某个线程调用了yield方法之后，线程调度器又将其调度出来重新继续执行。<br>当该线程暂停后，只有优先级比当前线程高的线程或者同等级别的才可以获得执行的机会。<br>因此yield线程是将程序转化为就绪状态，因此也可能立刻获得执行的机会继续执行，比较难控制。</p>
<h4 id="线程优先级"><a href="#线程优先级" class="headerlink" title="线程优先级"></a>线程优先级</h4><p>setPriority(int newPriority)<br>设置线程优先级<br>getPriority()<br>获得线程优先级</p>
<p>线程优先级的范围为（1～10）高优先级的线程将会获得更多的执行机会。</p>
<h2 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h2><p>问题：当有两个进程并发修改同一个文件的时候就有可能造成异常<br>线程A访问资源D的时候 ，资源够用，但是A还没消耗资源；此时线程B也在请求D，资源显示够用！此时，A已经消耗了资源，已经不够B使用的了。从而出现错误。</p>
<h3 id="同步代码块（监视器）"><a href="#同步代码块（监视器）" class="headerlink" title="同步代码块（监视器）"></a>同步代码块（监视器）</h3><p><strong>synchronized(obj){}</strong><br>同步代码块就像是一个锁，一个线程使用资源的时候，资源上锁，只有该线程使用结束后，其他线程才能访问。<br><em>注意：监视器的作用是阻止两个线程对同一个资源进行并发访问，因此，通常可能被并发访问的资源当作同步监视器。</em></p>
<h3 id="同步方法"><a href="#同步方法" class="headerlink" title="同步方法"></a>同步方法</h3><p>使用同步方法可以非常便捷的实现线程安全的类，线程安全的类具有如下特征：</p>
<ul>
<li>该类的对象可以被多个线程安全的访问</li>
<li>每个线程调用该对象的任意方法后都能得到正确的结果</li>
<li>每个线程调用该类对象任意方法之后，该对象状态依然保持合理状态<br>上面的监视器在程序执行完成后会自动释放<h3 id="同步锁"><a href="#同步锁" class="headerlink" title="同步锁"></a>同步锁</h3>Java5 开始设计了更为强大的线程同步机制–显示的定义同步锁对象来实现同步。<br>每次只能有一个对象对Lock加锁，线程开始访问资源之前需要先获得Lock对象</li>
</ul>
<p>ReentrantLock(可重用锁) 通常可以显示地加锁、释放锁<br>使用的代码格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//定义锁对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  lock.lock();</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="comment">//需要保证线程安全的代码</span></span><br><span class="line">  &#125;<span class="keyword">finally</span></span><br><span class="line">  &#123;</span><br><span class="line">  lock.unlock();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>线程之间互相等待对方释放锁</p>
<h2 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h2><p>线程在程序中执行的时候，通常是透明的，程序通常很难控制线程的轮换执行，我们可以通过一些机制来保证线程协调运行。</p>
<h3 id="使用传统的线程通信"><a href="#使用传统的线程通信" class="headerlink" title="使用传统的线程通信"></a>使用传统的线程通信</h3><p>传统的线程通信是指使用Object类的wait(),notify()和notifyAll()三个方法。这三个方法必须使用同步监视器来调用，也就是使用synchronized的锁对象。</p>
<ul>
<li>wait()<br>wait()方法是当前线程等待</li>
<li>notify()<br>唤醒等待的线程，如果有多个线程，则随机的唤醒一个</li>
<li>notifyAll()<br>唤醒所有等待的线程</li>
</ul>
<p>下面是使用实例：目的是保证取钱必须在存钱之后才能进行执行。<br>银行账户<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String accountNo;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> balance;</span><br><span class="line"><span class="comment">//表识账户中是否还有存款的标志</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(String accountNo, <span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.accountNo = accountNo;</span><br><span class="line">		<span class="keyword">this</span>.balance = balance;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getBalabce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.balance;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//设置取钱操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(<span class="keyword">double</span> drawA)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(!flag) &#123;</span><br><span class="line">				wait();</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(balance&gt;=drawA) &#123;</span><br><span class="line">					balance -= drawA;</span><br><span class="line">					<span class="comment">//执行取钱操作</span></span><br><span class="line">					System.out.println(Thread.currentThread().getName()+<span class="string">"取钱"</span>+drawA);</span><br><span class="line">					flag = <span class="keyword">false</span>;</span><br><span class="line">					<span class="comment">//唤醒其他的线程</span></span><br><span class="line">					notifyAll();</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					flag = <span class="keyword">false</span>;</span><br><span class="line">					<span class="comment">//唤醒其他的线程</span></span><br><span class="line">					notifyAll();</span><br><span class="line">					System.out.println(<span class="string">"余额不足"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//设置存钱的操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">deposite</span><span class="params">(<span class="keyword">double</span> desm)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(flag) &#123;</span><br><span class="line">				wait();</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()+<span class="string">"存钱"</span>+desm);</span><br><span class="line">				balance+=desm;</span><br><span class="line">				flag = <span class="keyword">true</span>;</span><br><span class="line">				notifyAll();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>取钱线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DrawThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Account aco;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> drawacound;</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DrawThread</span><span class="params">(String name,Account aco, <span class="keyword">double</span> drawacound)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">		<span class="keyword">this</span>.aco = aco;</span><br><span class="line">		<span class="keyword">this</span>.drawacound = drawacound;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">	aco.draw(drawacound);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>存钱线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepositeThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> maony;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DepositeThread</span><span class="params">(String name,Account account, <span class="keyword">double</span> maony)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">		<span class="keyword">this</span>.account = account;</span><br><span class="line">		<span class="keyword">this</span>.maony = maony;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">		account.deposite(maony);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用Condition来控制线程的执行"><a href="#使用Condition来控制线程的执行" class="headerlink" title="使用Condition来控制线程的执行"></a>使用Condition来控制线程的执行</h3><p>如果没有使用synchionized来控制线程，而是使用lock对象，那么就不存在使用监视器的同步对象了。<br>java提供了一个Condition类来保持协调，使用Condition对象能够让那些获得lock对象，却无法继续执行的的线程释放Lock对象，也可以唤醒其他处于等待的线程。<br><code>Condition对象被绑定在Lock对象上，因此获得Co ndition对象可以通过调用Lock对象的newCondition()即可</code><br>这里的区别就是 隐式同步监视器使用的当前类，但是Condition使用的当前的Lock对象</p>
<ul>
<li>await()<br>对应隐式同步监视器上的wai t()方法</li>
<li>signal()<br>对应于隐式同步监视器上的notify()方法</li>
<li>signalAll()<br>对应于隐式同步监视器上的notifyAll()方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">	<span class="keyword">private</span> Condition condition = lock.newCondition();</span><br><span class="line">	<span class="keyword">private</span> String accountNo;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> balance;</span><br><span class="line"><span class="comment">//表识账户中是否还有存款的标志</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(String accountNo, <span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.accountNo = accountNo;</span><br><span class="line">		<span class="keyword">this</span>.balance = balance;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getBalabce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.balance;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//设置取钱操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(<span class="keyword">double</span> drawA)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			lock.lock();</span><br><span class="line">			<span class="keyword">if</span>(!flag) &#123;</span><br><span class="line">				condition.await();</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(balance&gt;=drawA) &#123;</span><br><span class="line">					balance -= drawA;</span><br><span class="line">					<span class="comment">//执行取钱操作</span></span><br><span class="line">					System.out.println(Thread.currentThread().getName()+<span class="string">"取钱"</span>+drawA);</span><br><span class="line">					flag = <span class="keyword">false</span>;</span><br><span class="line">					<span class="comment">//唤醒其他的线程</span></span><br><span class="line">					condition.signalAll();</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					flag = <span class="keyword">false</span>;</span><br><span class="line">					<span class="comment">//唤醒其他的线程</span></span><br><span class="line">					condition.signalAll();</span><br><span class="line">					System.out.println(<span class="string">"余额不足"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//设置存钱的操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">deposite</span><span class="params">(<span class="keyword">double</span> desm)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			lock.lock();</span><br><span class="line">			<span class="keyword">if</span>(flag) &#123;</span><br><span class="line">				condition.await();</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()+<span class="string">"存钱"</span>+desm);</span><br><span class="line">				balance+=desm;</span><br><span class="line">				flag = <span class="keyword">true</span>;</span><br><span class="line">				condition.signalAll();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出这部分的逻辑与上面的逻辑完全一样，只不过第一个是隐式的，第二个是显式的</p>
<h3 id="使用阻塞队列控制线程通信"><a href="#使用阻塞队列控制线程通信" class="headerlink" title="使用阻塞队列控制线程通信"></a>使用阻塞队列控制线程通信</h3><p>Java5 提供了一个BlockingQueue接口，是Queue的接口，主要用途不是容器而是线程同步的工具。<code>有一个特性:当生产者向队列中放入元素的时候，如果队列已经满了，则该线程被阻塞；当消费者从队列中取出元素的时候，如果队列为空的时候，线程就被阻塞</code></p>
<h4 id="队列支持的方法"><a href="#队列支持的方法" class="headerlink" title="队列支持的方法"></a>队列支持的方法</h4><ul>
<li>队列尾部插入元素 add(),offer(),put()</li>
<li>队列头部删除并返回元素 remove(),poll(),take()</li>
<li>队列头部取出元素但不删除元素element()和peek()</li>
</ul>
<h4 id="五个实现类"><a href="#五个实现类" class="headerlink" title="五个实现类"></a>五个实现类</h4><ul>
<li>ArrayBlockingQueue:基于数组的队列</li>
<li>LinkedBlockingQueue:基于链表的队列</li>
<li>PriorityBlockingQueue:并不是标准的队列，不是取出队列中存在时间最长的元素，而是队列中值最小的元素</li>
<li>SynchronousQueue:同步队列。该队列的存取操作必须交替进行</li>
<li>DelayQueue 要求集合元素都必须实现delay接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DrawThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">	<span class="comment">//消费者线程</span></span><br><span class="line">	<span class="keyword">private</span> BlockingQueue&lt;String&gt; bq;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DrawThread</span><span class="params">(BlockingQueue&lt;String&gt; bq)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.bq = bq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">			System.out.println(getName()+<span class="string">"消费者准备消费集合元素"</span>);</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">200</span>);</span><br><span class="line">				bq.take();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(getName()+<span class="string">"消费完成："</span>+bq);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepositeThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">   <span class="comment">//生产者线程</span></span><br><span class="line">	<span class="keyword">private</span> BlockingQueue&lt;String&gt; bq;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DepositeThread</span><span class="params">(BlockingQueue&lt;String&gt; bq)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>();</span><br><span class="line">	<span class="keyword">this</span>.bq = bq;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">			String [] strArr = <span class="keyword">new</span> String[] &#123;<span class="string">"java"</span>,<span class="string">"python"</span>,<span class="string">"spring"</span>&#125;;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">99999</span>;i++) &#123;</span><br><span class="line">				System.out.println(getName()+<span class="string">"生产者准备生产集合元素！"</span>);</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Thread.sleep(<span class="number">200</span>);</span><br><span class="line">					bq.put(strArr[i%<span class="number">3</span>]);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				System.out.println(getName()+<span class="string">"生产完成"</span>+bq);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		BlockingQueue&lt;String&gt; bq = <span class="keyword">new</span> ArrayBlockingQueue&lt;String&gt;(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">new</span> DrawThread(bq).start();</span><br><span class="line">		<span class="keyword">new</span> DrawThread(bq).start();</span><br><span class="line">		<span class="keyword">new</span> DepositeThread(bq).start();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="线程组和未处理异常"><a href="#线程组和未处理异常" class="headerlink" title="线程组和未处理异常"></a>线程组和未处理异常</h2><p>Java使用ThreadGroup来表示线程，它可以对一批线程进行分类管理，Ja va允许程序直接对线程组进行控制。对线程组的控制相当于同时控制这一批线程。<br>默认情况下，子线程和创建它的父线程属于同一个线程组。<br>一旦线程加入了指定的组后，该线程将一直属于该线程组，直至线程死亡，线程运行中，不能改变线程的运行组。</p>
<h3 id="Thread类提供了构造器来设置线程属于哪一个线程组"><a href="#Thread类提供了构造器来设置线程属于哪一个线程组" class="headerlink" title="Thread类提供了构造器来设置线程属于哪一个线程组"></a>Thread类提供了构造器来设置线程属于哪一个线程组</h3><ul>
<li>Thread(ThreadGrounp group,Runable target):以target的run()方法作为线程执行体创建新的线程,属于group组。</li>
<li>Thread(ThreadGrounp group,Runable target,String name):线程名为name</li>
<li>Thread(ThreadGrounp group,String name) 创建新的线程，新线程的名字为name,属于group组</li>
</ul>
<p>提供了一个<code>getThreadGroup()</code>方法来获得线程属于的线程组。</p>
<h3 id="ThreadGroup类提供了两个简单的构造器来创建实例"><a href="#ThreadGroup类提供了两个简单的构造器来创建实例" class="headerlink" title="ThreadGroup类提供了两个简单的构造器来创建实例"></a>ThreadGroup类提供了两个简单的构造器来创建实例</h3><ul>
<li>ThreadGroup(String name) :以指定的线程组的名字来创建新的线程</li>
<li>ThreadGroup(ThreadGroup parent,String name):以指定的名字，指定的父线程组创建一个新的线程组。<br>线程组的名字可以通过<code>getName()</code>方法来获取</li>
</ul>
<h3 id="ThreadGroup类提供了如下几个方法来操作整个线程组里的所有线程"><a href="#ThreadGroup类提供了如下几个方法来操作整个线程组里的所有线程" class="headerlink" title="ThreadGroup类提供了如下几个方法来操作整个线程组里的所有线程"></a>ThreadGroup类提供了如下几个方法来操作整个线程组里的所有线程</h3><ul>
<li>int activeCount():返回此线程组中活动的线程的数目</li>
<li>interrupt():中断此线程组中所有的线程</li>
<li>isDaemon():判断该线程是否是后台线程组</li>
<li>setDaemon(boolean daemon):把该线程组设置成后台线程组。</li>
<li>setMaxPriority(int pri):设置线程组的最高优先级</li>
</ul>
<p>一个有用的异常处理方法<br>（这块用到的时候 在看吧！！！想到这里似乎也该复习复习异常处理这块嘞）</p>
<ul>
<li>void uncaughtExeption(Thread t,Throwable e)：该方法可以处理该线程组内的任意线程所抛出的未处理异常</li>
</ul>
<h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><p>对于池的概念，应该都不是很陌生了。通俗的理解就是一个大的容器，线程池无疑就是装线程的容器。那么为什么需要线程池的存在呢？<br>程序创建一个新的线程本身就是一个成本比较高的操作，涉及与操作系统的交互。在这种情况下，使用线程池能够很好的提升性能，尤其是程序中需要创建大量的生存期很短的线程的时候，线程池启动的时候会初始化一批<code>Runable或者Callable的对象</code>，这类对象执行结束后也不会死亡，而是转为空闲状态。（线程池可以有效的控制 系统中并发线程的数量，当系统中包含大量的线程的时候，会导致系统性能的下降，线程池可以有效的控制系统中并发线程的数量）<br>下面是主要的线程池的创建方法：</p>
<h3 id="返回ExecutorService"><a href="#返回ExecutorService" class="headerlink" title="返回ExecutorService"></a>返回ExecutorService</h3><ul>
<li>newCachedThreadPool(int nThreads):创建一个可重用的，具有固定线程数量的线程池。</li>
<li>newSingleThreadPool(int nThreads)：创建一个只有单线程的线程池</li>
<li>new CachedThreadPool():创建一个具有缓存功能的线程池，系统根据需要创建线程，这些线程将会被缓存在线程池中<h3 id="返回一个ScheduledExecutorService"><a href="#返回一个ScheduledExecutorService" class="headerlink" title="返回一个ScheduledExecutorService"></a>返回一个ScheduledExecutorService</h3></li>
<li>newScheduledThreadPool(int corePoolSize) 创建具有指定线程数的线程池，它可以指定延迟后执行线程任务</li>
<li><p>newSingleThreadScheduledExecutor():创建只有一个线程的线程池，它可以在指定延迟后执行线程任务。</p>
<p>操作线程池的方法，使用的时候直接查找开发javaAPI就可以了！</p>
<h3 id="线程池的关闭"><a href="#线程池的关闭" class="headerlink" title="线程池的关闭"></a>线程池的关闭</h3><p>当用完一个线程池后，要对线程池进行关闭</p>
</li>
<li>shutdown()<br>调用这个方法，会让线程池不在接收新的任务，但是会将以前的任务执行完毕</li>
<li>shutdownNow()<br>这个方法暂停所有的正在执行的任务，暂停正在等待的任务，并返回等待执行的任务列表</li>
</ul>
<h2 id="java7新增加的ForkJoinPool"><a href="#java7新增加的ForkJoinPool" class="headerlink" title="java7新增加的ForkJoinPool"></a>java7新增加的ForkJoinPool</h2><p>为了充分利用计算机硬件多CPU或者多核的优势，软件与硬件想使用。ForkJoinPool支持将一个任务拆分成多个“小任务”并行计算，再把多个“小任务”的结果合并成总的计算结果。</p>
<h3 id="常用的构造器"><a href="#常用的构造器" class="headerlink" title="常用的构造器"></a>常用的构造器</h3><ul>
<li>ForkJoinPool(int parallelism):创建一个包含p个并行线程的ForkjoinPool</li>
<li>ForkJoinPool():以Runtime.availableProcessors()方法的返回值作为p参数来创建ForkJoinPool.</li>
</ul>
<h3 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h3><ul>
<li>submit(ForkJoinTask task)</li>
<li>invoke(ForkJoinTask task)<h3 id="ForkJoinTask抽象类"><a href="#ForkJoinTask抽象类" class="headerlink" title="ForkJoinTask抽象类"></a>ForkJoinTask抽象类</h3></li>
<li>RecursiveAction抽象子类：代表没有返回值的任务</li>
<li>RecursiveTask 抽象子类：有返回值的任务<br> 返回值的结果使用Future<object> future 进行接收</object></li>
</ul>
<h3 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.RecursiveAction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintTask</span> <span class="keyword">extends</span> <span class="title">RecursiveAction</span> </span>&#123;</span><br><span class="line">	<span class="comment">//每个小任务最多执行的次数</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TH = <span class="number">50</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> start;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PrintTask</span><span class="params">(<span class="keyword">int</span> start,<span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.start = start;</span><br><span class="line">		<span class="keyword">this</span>.end = end;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">if</span>(end - start &lt;TH) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = start;i&lt;end;i++) &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()+<span class="string">"i的值为："</span>+i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> middle = (start+end)/<span class="number">2</span>;</span><br><span class="line">			PrintTask left = <span class="keyword">new</span> PrintTask(start, middle);</span><br><span class="line">			PrintTask right = <span class="keyword">new</span> PrintTask(middle, end);</span><br><span class="line">			<span class="comment">//并行执行两个小任务</span></span><br><span class="line">			left.fork();</span><br><span class="line">			right.fork();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>  </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		ForkJoinPool pool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">		pool.submit(<span class="keyword">new</span> PrintTask(<span class="number">0</span>, <span class="number">300</span>));</span><br><span class="line">		<span class="comment">//关于此方法</span></span><br><span class="line">		pool.awaitTermination(<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">		pool.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/sheng_mu555/article/details/80552078" target="_blank" rel="noopener">awaitTermination连接</a><br>上述代码是将打印0-300的任务，分解成了两个小任务，分解后的任务调用fork()，进行并行执行。<br>…<br>‘ForkJoinPool-1-worker-3i的值为：211<br>ForkJoinPool-1-worker-3i的值为：212<br>ForkJoinPool-1-worker-7i的值为：95<br>ForkJoinPool-1-worker-0i的值为：241’<br>在我机器上的运行结果如上,最后的显示为0i - 7i ，我的电脑是4核的，单个cpu，不知为啥是7。后面的数字是没有顺序的，因为，分解后的程序是并行执行的。</p>
<h2 id="线程相关类"><a href="#线程相关类" class="headerlink" title="线程相关类"></a>线程相关类</h2><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal<t></t></h3><p>在共享资源处定一个ThreadLocal类就相当于为每一个线程都创建了一个线程的局部变量，每一个线程都可以独享自己的副本。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> ThreadLocal&lt;String&gt; local = <span class="keyword">new</span> ThreadLocal&lt;String&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.local.set(name);</span><br><span class="line">		System.out.println(<span class="string">"+++++"</span>+local.get());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLocal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> local.get();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocal</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.local.set(name);;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintTask</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Account account;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PrintTask</span><span class="params">(String name,Account ac)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">		<span class="keyword">this</span>.account = ac;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span>(i==<span class="number">20</span>) &#123;</span><br><span class="line">				account.setLocal(currentThread().getName());</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(account.getLocal()+<span class="string">"账户的i值"</span>+i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>  </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">//启动两个线程 两个线程共享一个account</span></span><br><span class="line">		Account acc = <span class="keyword">new</span> Account(<span class="string">"初始名"</span>);</span><br><span class="line">		PrintTask pT = <span class="keyword">new</span> PrintTask(<span class="string">"线程A"</span>, acc);</span><br><span class="line">		PrintTask pt2 = <span class="keyword">new</span> PrintTask(<span class="string">"线程B"</span>, acc);</span><br><span class="line">		pT.start();</span><br><span class="line">		pt2.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到刚开始的第一行的输出初始名是因为初始化Ac count类的时候，执行的。但是后面在获取ThreadLocal名的时候就是null值了,直到i的值执行到20的时候，两个线程独自的将自己的ThreadLocal名修改成了自己的名字。<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+++++初始名</span><br><span class="line"><span class="literal">null</span>账户的i值<span class="number">0</span></span><br><span class="line"><span class="literal">null</span>账户的i值<span class="number">0</span></span><br><span class="line"><span class="literal">null</span>账户的i值<span class="number">1</span></span><br><span class="line">...</span><br><span class="line">线程B账户的i值<span class="number">23</span></span><br><span class="line"><span class="literal">null</span>账户的i值<span class="number">19</span></span><br><span class="line">线程A账户的i值<span class="number">20</span></span><br></pre></td></tr></table></figure></p>
<h3 id="包装线程不安全的类"><a href="#包装线程不安全的类" class="headerlink" title="包装线程不安全的类"></a>包装线程不安全的类</h3><p>我们所使用的LinkedList,ArrayList,HashSet,TreeSet,HashMap,TreeMap等都是线程不安全的。因此就需要把这些集合封装成线程安全的。<br>Collections提供的静态方法把这些集合包装成线程安全的集合，并返回<br>具体的方法就不详细介绍了。用到在说大体结构是：<br>static <t> Oject synchronizedObject(Object obj)</t></p>
<h3 id="线程安全的集合类"><a href="#线程安全的集合类" class="headerlink" title="线程安全的集合类"></a>线程安全的集合类</h3><p>从java5开始，java.util.concurrent包下提供了大量的支持高并发访问的集合接口和实现类。</p>
<ul>
<li>以Concurrent开头的集合类：更实用于写操作</li>
<li>以CopyOnWrite开头的集合类：更实用于读操作</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/11/10/多线程基础总结/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="多线程基础总结">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Servlet技术使用总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/11/10/Servlet技术使用总结/" class="article-date">
  	<time datetime="2020-11-10T08:30:06.530Z" itemprop="datePublished">2020-11-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/10/Servlet技术使用总结/">
        Servlet技术使用总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本科期间很久之前学的了,好久没使用了，感觉知识有一些遗忘了（可能这也是大多数编程人的困绕吧）！所以打算抽时间，在学习新知识的同时也对过往的知识进行一个回顾。整个记录的过程可能不像是开发的过程一样，仅作为一个笔记。想到哪里就写到哪里吧（随着技术的不断迭代有些内容可能有些老了）！随心情了～～～</p>
<h2 id="如何开发一个Servlet"><a href="#如何开发一个Servlet" class="headerlink" title="如何开发一个Servlet"></a>如何开发一个Servlet</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ul>
<li>编写一个java类，继承HttpServlet</li>
<li>重写doGet()和doPost()方法</li>
<li>Servlet程序交给服务器运行<ul>
<li>servlet程序的class码拷贝到WEB-INF/classes目录</li>
<li>在web.xml文件中进行配置（使用Eclipse的时候，可能不存在，这时候就要直接创建一个servlet的程序，eclipse会自动的在内部给你配置好，在类中更改要访问的名字就可以了）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置一个servlet --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- servlet的配置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- servlet的内部名称，自定义。尽量有意义 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>FirstServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- servlet的类全名： 包名+简单类名 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>gz.itcast.a_servlet.FirstServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- servlet的映射配置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- servlet的内部名称，一定要和上面的内部名称保持一致！！ --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>FirstServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- servlet的映射路径（访问servlet的名称） --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/first<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>如果是在Eclip se中将会是这样,我们在通过连接访问的时候就直接访问<code>/indexServlet</code>就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class indexServlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/indexServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">indexServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问的时候 <code>问次URL：  http://localhost:8080/项目名/indexServlet</code><br>tomcat服务器启动时，首先加载webapps中的每个web应用的web.xml配置文件</p>
<ul>
<li>http://   http协议</li>
<li>localhost  到本地的hosts文件中查找是否存在该域名对应的IP地址127.0.0.1 ,如果使用其他服务器的话，就需要将这部分转换成服务器的地址</li>
<li>8080 服务器的端口</li>
<li>/项目名 这个是要与tomcat服务器的项目名进行对应的</li>
<li>/indexServlet 我们要访问的servlet文件，资源名称</li>
</ul>
<p>整个的执行过程为：</p>
<p>1）在项目的web.xml中查找是否有匹配的url-pattern的内容（/indexServlet）<br>2）如果找到匹配的url-pattern,则使用当前servlet-name的名称到web.xml文件中查询是否相同名称的servlet配置<br>3）如果找到，则取出对应的servlet配置信息中的servlet-class内容：<br>通过反射：a）构造FirstServlet的对象b）然后调用FirstServlet里面的方法</p>
<h3 id="Servlet的映射路径"><a href="#Servlet的映射路径" class="headerlink" title="Servlet的映射路径"></a>Servlet的映射路径</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- servlet的内部名称，一定要和上面的内部名称保持一致！！ --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>FirstServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- servlet的映射路径（访问servlet的名称） --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/first<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="精确匹配"><a href="#精确匹配" class="headerlink" title="精确匹配"></a>精确匹配</h4><table>
<thead>
<tr>
<th>url-pattern</th>
<th>浏览器输入</th>
</tr>
</thead>
<tbody>
<tr>
<td>/first</td>
<td><a href="http://localhost:8080/项目名/first" target="_blank" rel="noopener">http://localhost:8080/项目名/first</a></td>
</tr>
<tr>
<td>/itcast/demo1</td>
<td><a href="http://localhost:8080/项目名/itcast/demo1" target="_blank" rel="noopener">http://localhost:8080/项目名/itcast/demo1</a></td>
</tr>
</tbody>
</table>
<h4 id="模糊匹配"><a href="#模糊匹配" class="headerlink" title="模糊匹配"></a>模糊匹配</h4><table>
<thead>
<tr>
<th>url-pattern</th>
<th>浏览器输入</th>
</tr>
</thead>
<tbody>
<tr>
<td>/*</td>
<td><a href="http://localhost:8080/项目名/任意路径" target="_blank" rel="noopener">http://localhost:8080/项目名/任意路径</a></td>
</tr>
<tr>
<td>/itcast/*</td>
<td><a href="http://localhost:8080/项目名/itcast/任意路径" target="_blank" rel="noopener">http://localhost:8080/项目名/itcast/任意路径</a></td>
</tr>
<tr>
<td>*.后缀名</td>
<td><a href="http://localhost:8080/项目名/任意路径.后缀名" target="_blank" rel="noopener">http://localhost:8080/项目名/任意路径.后缀名</a></td>
</tr>
</tbody>
</table>
<p>注意：<br>        1）url-pattern要么以 / 开头，要么以<em>开头。  例如， itcast是非法路径。<br>        2）不能同时使用两种模糊匹配，例如 /itcast/</em>.do是非法路径<br>        3）当有输入的URL有多个servlet同时被匹配的情况下：<br>        3.1 精确匹配优先。（长的最像优先被匹配）<br>        3.2 以后缀名结尾的模糊url-pattern优先级最低！！！</p>
<h3 id="缺省路径"><a href="#缺省路径" class="headerlink" title="缺省路径"></a>缺省路径</h3><p>servlet的缺省路径（<url-pattern>/</url-pattern>）是在tomcat服务器内置的一个路径。该路径对应的是一个DefaultServlet（缺省Servlet）。这个缺省的Servlet的作用是用于解析web应用的静态资源文件。<br>当我们提供了一个缺省路径的时候，那么服务器又该如何读取文件呢？</p>
<ol>
<li>到当前应用下的web.xml文件查找是否有匹配的url-pattern。</li>
<li>如果没有匹配的url-pattern，则交给tomcat的内置的DefaultServlet处理</li>
<li>DefaultServlet程序到项目应用的根目录下查找是存在一个名称为index.html的静态文件。</li>
<li>如果找到该文件，则读取该文件内容，返回给浏览器。</li>
<li>如果找不到该文件，则返回404错误页面<br><em>注意：所以不建议使用/或/</em>，因为Tomcat服务器会先找动态资源再找静态资源。如果是/或/<em>就不会再访问到静态资源，如果是/.html或者/.css等路径格式，那么这类静态资源就不会被访问到了，所以慎用/或/</em> 和静态资源的后缀*</li>
</ol>
<h2 id="Servlet的生命周期（重点）"><a href="#Servlet的生命周期（重点）" class="headerlink" title="Servlet的生命周期（重点）"></a>Servlet的生命周期（重点）</h2><p>Servlet的生命是由Tomcat控制的！！！！</p>
<h3 id="Servlet的四个生命周期方法"><a href="#Servlet的四个生命周期方法" class="headerlink" title="Servlet的四个生命周期方法"></a>Servlet的四个生命周期方法</h3><ul>
<li>构造方法： 创建servlet对象的时候调用。默认情况下，第一次访问servlet的时候创建servlet对象只调用1次。证明servlet对象在tomcat是单实例的。</li>
<li>init方法： 创建完servlet对象的时候紧接着调用。只调用1次。</li>
<li>service方法： 每次发出请求时调用。调用n次。</li>
<li>destroy方法： 销毁servlet对象的时候调用。停止服务器或者重新部署web应用时销毁servlet对象，只调用1次。</li>
</ul>
<h4 id="Tomtcat内部代码运行："><a href="#Tomtcat内部代码运行：" class="headerlink" title="Tomtcat内部代码运行："></a>Tomtcat内部代码运行：</h4><pre><code>1）通过映射找到到servlet-class的内容，字符串： gz.itcast.a_servlet.FirstServlet
2）通过反射构造FirstServlet对象
    2.1 得到字节码对象
                Class clazz = class.forName(&quot;gz.itcast.a_servlet.FirstServlet&quot;);
    2.2 调用无参数的构造方法来构造对象
                Object obj = clazz.newInstance();     ---1.servlet的构造方法被调用
3）创建ServletConfig对象，通过反射调用init方法
    3.1 得到方法对象
                Method m = clazz.getDeclareMethod(&quot;init&quot;,ServletConfig.class);
    3.2 调用方法
                m.invoke(obj,config);             --2.servlet的init方法被调用
4）创建request，response对象，通过反射调用service方法
    4.1 得到方法对象
                Methodm m =clazz.getDeclareMethod(&quot;service&quot;,HttpServletRequest.class,HttpServletResponse.class);
    4.2 调用方法
                m.invoke(obj,request,response);  --3.servlet的service方法被调用
5）当tomcat服务器停止或web应用重新部署，通过反射调用destroy方法
    5.1 得到方法对象
                Method m = clazz.getDeclareMethod(&quot;destroy&quot;,null);
    5.2 调用方法
                m.invoke(obj,null);            --4.servlet的destroy方法被调用
</code></pre><h3 id="Servlet的自动加载"><a href="#Servlet的自动加载" class="headerlink" title="Servlet的自动加载"></a>Servlet的自动加载</h3><p>默认情况下，第一个访问Servlet的时候创建Servlet对象，如果Servlet在进行init()的时候或者构造方法的时候，执行了太多的逻辑代码，那么会导致用户在第一次请求的时候，会加载比较慢！<br><strong><em>（‘我们可以通过改变一下访问对象的时机，将对象的创建的时机更改到加载Web应用的时候’）</em></strong><br>这个配置是在Servlet的配置文件中进行配置的！<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LifeDemo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>gz.itcast.c_life.LifeDemo<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 让servlet对象自动加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span>  注意： 整数值越大，创建优先级越低！！</span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="有参数的init方法和无参数的init方法"><a href="#有参数的init方法和无参数的init方法" class="headerlink" title="有参数的init方法和无参数的init方法"></a>有参数的init方法和无参数的init方法</h3><p>有参数的init方法是servlet的生命周期方法，一定会被tomcat服务器调用<br>注意：如果要编写初始代码，不需要覆盖有参数的init方法(默认调用无参的init方法）<br>无参数的init方法是servlet的编写初始化代码的方法。是Sun公司设计出来专门给开发者进行覆盖，然后在里面编写servlet的初始逻辑代码的方法。</p>
<h3 id="Servlet的多线程并发问题"><a href="#Servlet的多线程并发问题" class="headerlink" title="Servlet的多线程并发问题"></a>Servlet的多线程并发问题</h3><p>如果多个线程同时访问了Servlet的共享对象（成员对象）则会引发线程安全问题。Servlet是单实例，多线程的。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ol>
<li>将共享数据进行加锁 ，是用synchronized 或者锁对象</li>
<li>在使用过程中，尽量不要使用成员变量，或者共享资源<h3 id="ServletConfig对象"><a href="#ServletConfig对象" class="headerlink" title="ServletConfig对象"></a>ServletConfig对象</h3>ServletConfig对象: 主要是用于加载servlet的初始化参数。在一个web应用可以存在多个ServletConfig对象（一个Servlet对应一个ServletConfig对象）<br>操作方式：<br>可以通过调用init()方法进行获取，直接从有参数的init方法中得到！！<br>Servlet的参数只能由当前的Servlet获取！！<br>下面是我在doGet()方法中获取的该对象！！<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enumeration&lt;String&gt; enum3 =   getServletConfig().getInitParameterNames();</span><br><span class="line">	 System.out.println(enum3.hasMoreElements());</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="ServletContext对象"><a href="#ServletContext对象" class="headerlink" title="ServletContext对象"></a>ServletContext对象</h3><p>ServletContext对象 ,叫做Servlet的上下文对象。表示一个当前的web应用环境。一个web应用中只有一个ServletContext对象。本身也是一个全局的域对象！<br>ServletContext对象的获取方式，目前我使用的主要有以下三种方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ServletContext context = getServletConfig().getServletContext();</span><br><span class="line">	 ServletContext context1 = getServletContext();</span><br><span class="line">	 ServletContext context2 = request.getServletContext();</span><br><span class="line">       System.out.println(context.equals(context1)); <span class="comment">//true</span></span><br><span class="line">       System.out.println(context.equals(context2)); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h4 id="ServletContext对象的核心API-作用"><a href="#ServletContext对象的核心API-作用" class="headerlink" title="ServletContext对象的核心API(作用)"></a>ServletContext对象的核心API(作用)</h4><pre><code>java.lang.String getContextPath()   --得到当前web应用的路径(用在请求重定向的路径中)

java.lang.String getInitParameter(java.lang.String name)  --得到web应用的初始化参数
java.util.Enumeration getInitParameterNames()  

void setAttribute(java.lang.String name, java.lang.Object object) --域对象有关的方法
java.lang.Object getAttribute(java.lang.String name)  
void removeAttribute(java.lang.String name)  

RequestDispatcher getRequestDispatcher(java.lang.String path)   --转发（类似于重定向）

java.lang.String getRealPath(java.lang.String path)     --得到web应用的资源文件
java.io.InputStream getResourceAsStream(java.lang.String path)  
</code></pre><h4 id="域对象"><a href="#域对象" class="headerlink" title="域对象"></a>域对象</h4><p>作用是用于保存数据，获取数据。可以在不同的动态资源之间共享数据！！<br>数据的传递方式：</p>
<ul>
<li>通过传递参数的形式，共享数据。局限：只能传递字符串类型</li>
<li>使用域对象 可以使用域对象共享数据，好处：可以共享任何类型的数据！！！！！<ul>
<li>保存数据：void setAttribute(java.lang.String name, java.lang.Object object)                    </li>
<li>获取数据： java.lang.Object getAttribute(java.lang.String name)  <ul>
<li>删除数据： void removeAttribute(java.lang.String name)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="转发与重定向"><a href="#转发与重定向" class="headerlink" title="转发与重定向"></a>转发与重定向</h3><h4 id="转发"><a href="#转发" class="headerlink" title="转发"></a>转发</h4><p>代码使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">"/pingjiao.jsp"</span>).forward(request, response);</span><br></pre></td></tr></table></figure>
<p>a）地址栏不会改变<br>b）转发只能转发到当前web应用内的资源<br>c）可以在转发过程中，可以把数据保存到request域对象中</p>
<h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><p>代码使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(request.getContextPath()+<span class="string">"/adminLogin.jsp"</span>);</span><br></pre></td></tr></table></figure>
<p>a）地址栏会改变，变成重定向到地址。<br>b）重定向可以跳转到当前web应用，或其他web应用，甚至是外部域名网站。<br>c）不能再重定向的过程，把数据保存到request中。</p>
<p><strong><em>结论： 如果要使用request域对象进行数据共享，只能用转发技术！！！</em></strong></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/11/10/Servlet技术使用总结/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="Servlet技术使用总结">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-青岛崂山区过去24小时气候变化可视化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/11/06/青岛崂山区过去24小时气候变化可视化/" class="article-date">
  	<time datetime="2020-11-06T02:18:56.950Z" itemprop="datePublished">2020-11-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/06/青岛崂山区过去24小时气候变化可视化/">
        青岛崂山区过去24小时气候变化可视化
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前面已经介绍过几个方便的可视化工具了！今天又发现了一个python里面非常便捷的Echarts的改版（为python而生的）！抽时间学了一下,随手做了一个简单的小项目！<br>项目逻辑比较简单，简单介绍一下过程以及工具的使用！(以后pytho n处理完数据之后，就可以直接使用了)</p>
<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>大体过程是：用python语言对中国气象台的网站进行气象数据的爬取，然后将爬取下来的数据使用pyecharts进行可视化分析。<br><strong><em>声明：数据的爬取，仅用于本次练习，非商业用途</em></strong></p>
<h2 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h2><p>之前的文章有讲解过使用java的webMagic进行数据的爬取！但是当前使用爬虫最火的还要数python！等有时间在出一篇关于python 爬虫的记录！<br><a href="http://www.nmc.cn/publish/forecast" target="_blank" rel="noopener">中央气象台</a><br>首先，打开中央气象台的网站，然后在城市预报中随便选择一个热门城市！然后打开we b控制台，手动切换省份以及城市的名称对页面进行分析。<br>在python中web的学习可以参考<a href="https://requests.readthedocs.io/en/latest/" target="_blank" rel="noopener">requests库</a>，当然还有urllib urllib2等库。大佬说建议全面放弃！我就不介绍这两个了！版本也有点老了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获得请求数据的函数 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="comment">#请求的连接</span></span><br><span class="line">    r=requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> r.text</span><br></pre></td></tr></table></figure>
<p>通过分析可以找到 URL1 = ‘<a href="http://www.nmc.cn/f/rest/province/ASD&#39;" target="_blank" rel="noopener">http://www.nmc.cn/f/rest/province/ASD&#39;</a><br>这个连接是代表的省份 其中ASD表示的是山东省的代码<br> URL = ‘<a href="http://www.nmc.cn/f/rest/passed/55538‘这个链接是某一个城市过去24小时的气候信息，其中的55538是某一个城市的代号。这里使用的是json格式的。" target="_blank" rel="noopener">http://www.nmc.cn/f/rest/passed/55538‘这个链接是某一个城市过去24小时的气候信息，其中的55538是某一个城市的代号。这里使用的是json格式的。</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在这个网站中 城市与代号之间的对应关系 是 </span><br><span class="line">省会 - 城市 - 代号</span><br><span class="line">所以我们要先获得城市的代码，然后找到要使用的城市的名称 然后获得代号</span><br></pre></td></tr></table></figure>
<p>这样我们通过上述代码就可以获得每一部分的数据！通过查看单个链接数据可以发现数据格式是json数据格式，因此我们需要对数据进行一个简单的解析。</p>
<p>我们首先解析一个城市到城市代码的 映射<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_citymap</span><span class="params">(url)</span>:</span></span><br><span class="line">    obj = get_html(url)</span><br><span class="line">    parse_json = json.loads(obj)</span><br><span class="line">    code_citymap = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> parse_json:</span><br><span class="line">        code_citymap[a[<span class="string">'city'</span>]] = a[<span class="string">'code'</span>]</span><br><span class="line">    <span class="keyword">return</span> code_citymap</span><br></pre></td></tr></table></figure></p>
<p>然后根据城市映射，构建一个新的请求链接。直接获得要请求的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geturl</span><span class="params">(cityname,url)</span>:</span></span><br><span class="line">    URL = <span class="string">'http://www.nmc.cn/f/rest/passed/'</span></span><br><span class="line">    code = get_citymap(url)[cityname]</span><br><span class="line">    <span class="keyword">return</span> URL+code</span><br></pre></td></tr></table></figure>
<p>对请求的数据进行json解析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obb = get_html(geturl(<span class="string">'崂山'</span>,URL1))</span><br><span class="line">parse_dajson = json.loads(obb)</span><br></pre></td></tr></table></figure>
<p>根据解析出来的数据，将我们要关注的天气信息进行统计</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">time = []</span><br><span class="line">rain = []</span><br><span class="line">temperature = []</span><br><span class="line">humidity = []</span><br><span class="line">pressure = []</span><br><span class="line">windSpeed = []</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> parse_dajson:</span><br><span class="line">    time.append(a[<span class="string">'time'</span>])</span><br><span class="line">    <span class="keyword">if</span> a[<span class="string">'rain1h'</span>]==<span class="number">9999.0</span> <span class="keyword">and</span> len(rain)!=<span class="number">0</span>:</span><br><span class="line">        a[<span class="string">'rain1h'</span>]= rain[<span class="number">-1</span>]</span><br><span class="line">    rain.append(a[<span class="string">'rain1h'</span>])</span><br><span class="line">    <span class="keyword">if</span> a[<span class="string">'temperature'</span>]==<span class="number">9999.0</span> <span class="keyword">and</span> len(temperature)!=<span class="number">0</span>:</span><br><span class="line">        a[<span class="string">'temperature'</span>]=temperature[<span class="number">-1</span>]</span><br><span class="line">    temperature.append(a[<span class="string">'temperature'</span>])</span><br><span class="line">    <span class="keyword">if</span> a[<span class="string">'humidity'</span>]==<span class="number">9999.0</span> <span class="keyword">and</span> len(humidity)!=<span class="number">0</span>:</span><br><span class="line">        a[<span class="string">'humidity'</span>]=humidity[<span class="number">-1</span>]</span><br><span class="line">    humidity.append(a[<span class="string">'humidity'</span>])</span><br><span class="line">    <span class="keyword">if</span> a[<span class="string">'pressure'</span>]==<span class="number">9999.0</span> <span class="keyword">and</span> len(pressure)!=<span class="number">0</span>:</span><br><span class="line">        a[<span class="string">'pressure'</span>]=pressure[<span class="number">-1</span>]</span><br><span class="line">    pressure.append(a[<span class="string">'pressure'</span>])</span><br><span class="line">    <span class="keyword">if</span> a[<span class="string">'windSpeed'</span>]==<span class="number">9999.0</span> <span class="keyword">and</span> len(windSpeed)!=<span class="number">0</span>:</span><br><span class="line">        a[<span class="string">'windSpeed'</span>]=windSpeed[<span class="number">-1</span>]</span><br><span class="line">    windSpeed.append(a[<span class="string">'windSpeed'</span>])</span><br></pre></td></tr></table></figure>
<p>统计完信息之后，我们就要进行可视化处理了！就要用到python版本的p yecharts。对于pyecharts在网络上主要有两个版本。我们尽量使用最新版！这个也是让我对python感到非常头疼的。版本更新，语法不兼容！<br>对于pyecharts的学习建议大家直接学习<a href="https://pyecharts.org/#/zh-cn/intro" target="_blank" rel="noopener">官方学习文档</a><br>官方为大家提供了足够的使用<a href="https://gallery.pyecharts.org/#/README" target="_blank" rel="noopener">模板</a>可修改性是比较强的。<br>下面就是使用官方文档进行的一个可视化过程。<br>使用之前需要导入所需要的包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyecharts.options <span class="keyword">as</span> opts</span><br><span class="line"><span class="keyword">from</span> pyecharts.charts <span class="keyword">import</span> Line,Bar,Page,PictorialBar</span><br><span class="line"><span class="keyword">from</span> pyecharts.globals <span class="keyword">import</span> ThemeType,SymbolType</span><br></pre></td></tr></table></figure>
<p>为了将所有的可视化结果全部显示在一个网页上，我们需要设置一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">page = Page(layout=Page.DraggablePageLayout)</span><br><span class="line">...</span><br><span class="line">这部分是a,b,c,d模块</span><br><span class="line">...</span><br><span class="line">page.add(a,b,c,d)</span><br><span class="line">page.render(<span class="string">"/Users/gorge/Desktop/temperature_change_line_chart.html"</span>)</span><br></pre></td></tr></table></figure>
<p>对于a ,bcc,d模块的写法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 气温</span></span><br><span class="line">a=(</span><br><span class="line">    Line(init_opts=opts.InitOpts(width=<span class="string">"1600px"</span>, height=<span class="string">"400px"</span>))</span><br><span class="line">    .add_xaxis(xaxis_data=time)</span><br><span class="line">    .add_yaxis(</span><br><span class="line">        series_name=<span class="string">"气温"</span>,</span><br><span class="line">        y_axis=temperature,</span><br><span class="line">        markpoint_opts=opts.MarkPointOpts(</span><br><span class="line">            data=[</span><br><span class="line">                opts.MarkPointItem(type_=<span class="string">"max"</span>, name=<span class="string">"最大值"</span>),</span><br><span class="line">                opts.MarkPointItem(type_=<span class="string">"min"</span>, name=<span class="string">"最小值"</span>),</span><br><span class="line">            ]</span><br><span class="line">        ),</span><br><span class="line">        markline_opts=opts.MarkLineOpts(</span><br><span class="line">            data=[opts.MarkLineItem(type_=<span class="string">"average"</span>, name=<span class="string">"平均值"</span>)]</span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">    .set_global_opts(</span><br><span class="line">        title_opts=opts.TitleOpts(title=<span class="string">"青岛过去24小时气温变化"</span>, subtitle=<span class="string">"数据真实"</span>),</span><br><span class="line">        tooltip_opts=opts.TooltipOpts(trigger=<span class="string">"axis"</span>),</span><br><span class="line">        toolbox_opts=opts.ToolboxOpts(is_show=<span class="literal">True</span>),</span><br><span class="line">        xaxis_opts=opts.AxisOpts(type_=<span class="string">"category"</span>, boundary_gap=<span class="literal">False</span>),</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">b= (</span><br><span class="line">    Bar(&#123;<span class="string">"theme"</span>: ThemeType.MACARONS&#125;)</span><br><span class="line">    .add_xaxis(time)</span><br><span class="line">    .add_yaxis(<span class="string">"temperature"</span>, temperature)</span><br><span class="line">    .add_yaxis(<span class="string">"humidity"</span>, humidity)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">c = (</span><br><span class="line">    PictorialBar()</span><br><span class="line">    .add_xaxis(time)</span><br><span class="line">    .add_yaxis(</span><br><span class="line">        <span class="string">""</span>,</span><br><span class="line">        windSpeed,</span><br><span class="line">        label_opts=opts.LabelOpts(is_show=<span class="literal">False</span>),</span><br><span class="line">        symbol_size=<span class="number">18</span>,</span><br><span class="line">        symbol_repeat=<span class="string">"fixed"</span>,</span><br><span class="line">        symbol_offset=[<span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        is_symbol_clip=<span class="literal">True</span>,</span><br><span class="line">        symbol=SymbolType.ROUND_RECT,</span><br><span class="line">    )</span><br><span class="line">    .reversal_axis()</span><br><span class="line">    .set_global_opts(</span><br><span class="line">        title_opts=opts.TitleOpts(title=<span class="string">"青岛过去24小时风速图"</span>),</span><br><span class="line">        xaxis_opts=opts.AxisOpts(is_show=<span class="literal">False</span>),</span><br><span class="line">        yaxis_opts=opts.AxisOpts(</span><br><span class="line">            axistick_opts=opts.AxisTickOpts(is_show=<span class="literal">False</span>),</span><br><span class="line">            axisline_opts=opts.AxisLineOpts(</span><br><span class="line">                linestyle_opts=opts.LineStyleOpts(opacity=<span class="number">0</span>)</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">d = (</span><br><span class="line">    Line()</span><br><span class="line">    .add_xaxis(time)</span><br><span class="line">    .add_yaxis(<span class="string">"降雨量/mm"</span>, rain, is_smooth=<span class="literal">True</span>)</span><br><span class="line">    .set_global_opts(title_opts=opts.TitleOpts(title=<span class="string">"青岛过去24小时降水图"</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>通过上述操作，我们就可以获得一个可以动态显示的网页版的可视化界面了！这样看起来是不是要比Echarts的好多了呀！<br><img src="https://img-blog.csdnimg.cn/20201106101501842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20201106101550734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20201106101612963.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/11/06/青岛崂山区过去24小时气候变化可视化/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="青岛崂山区过去24小时气候变化可视化">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Spark基础笔记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/25/Spark基础笔记/" class="article-date">
  	<time datetime="2020-10-25T09:09:06.200Z" itemprop="datePublished">2020-10-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/25/Spark基础笔记/">
        Spark基础笔记
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Spark是由美国加州大学伯克利分校的AMP实验室于2009年开发的，是<em>基于内存计算的并行计算框架</em>，可用于构建<em>大型的、低延迟</em>的数据分析应用程序。<br>spark的主要特点：</p>
<ul>
<li>运行速度快<br> Spark使用先进的DAG（有向无环图）执行引擎，用来支持循环数据流与内存计算，基于内存的执行速度比hadoop mapReduce快上百倍，基于磁盘的执行速度也能快上十倍。</li>
<li>容易使用<br> 支持java、python、Scala和R语言进行编程，编程相对简洁</li>
<li>通用性<br> 提供了完整而强大的技术栈，包括SQL查询、流式计算、机器学习和图算法组件，这些<em>组件可以无缝整合在一个应用中</em>，可以应对复杂的运算。同时支持批处理、交互式查询和流数据处理。</li>
<li>运行模式多样<br> 可运行于独立的集群中或者hadoop中。<h2 id="Spark与Hadoop的对比"><a href="#Spark与Hadoop的对比" class="headerlink" title="Spark与Hadoop的对比"></a>Spark与Hadoop的对比</h2></li>
<li>Hadoop的主要缺点<br>hadoop的主要两个组成部分，一部分是h d f s分布式存储，另一个方面是Ma pReduce计算模型。<ol>
<li>表达能力有限。计算都必须转化为Map和Reduce两个操作。这不是适合所有的情况。</li>
<li>磁盘的IO开销比较大。每次执行都需要从磁盘读取数据，并且在计算完成后需要将结果写入到磁盘中，IO开销过大。</li>
<li>延迟高。一次计算可能需要分解成<em>一系列按顺序执行的MapReduce任务</em>，任务之间的衔接由于涉及到IO开销。会产生较高的延迟。在前一个结束之前，其他任务无法开始。</li>
</ol>
</li>
<li>Spark的主要优点<br> 在借鉴了mapReduce的优点基础上，还有以下优点：<ol>
<li>Spark的计算模式也属于Hadoop MapReduce，但是并不局限于Ma p和Reduce，还提供了多种数据集的类型，编程模型比mapReduce更灵活。</li>
<li>提供了内存计算，中间结果放在内存中，带来了更高的迭代运算效率，但是同时也对计算机的硬件要求更高。</li>
<li>基于DAG的任务调度机制，要比MapReduce的迭代执行机制更优越。</li>
</ol>
</li>
</ul>
<p>但是Spark并不能完全替代hadoop，spark只是优化了mapReduce的计算模型，hadoop的分布式文件系统的优越性还是不能忽视的。Spark专注于BDAS架构中数据的处理与分析，数据存储还是主要依靠h d f s。</p>
<h2 id="Spark生态系统的主要组件"><a href="#Spark生态系统的主要组件" class="headerlink" title="Spark生态系统的主要组件"></a>Spark生态系统的主要组件</h2><p>这里我们先知道有这些东西的存在就好了，等具体使用的时候，我们在具体的学习。</p>
<ul>
<li>Spark Core<br>主要面向批数据处理，是spark的基本功能，主要包括内存计算、任务调度、部署模式、故障恢复、存储管理等。</li>
<li>Spark SQL<br>能够统一处理关系表和RDD，使得开发人员不需要自己编写Spark应用程序，轻松使用SQL命令进行查询。</li>
<li>Spark Streaming<br>支持高吞吐量、可容错性的实时流数据处理，核心思路是将流数据分解成一系列的短小的批处理作业。每个短小的批处理作业都可以使用spark core进行快速处理。支持TCP套接字等。</li>
<li>MLlib（ 机器学习）<br>提供了常用的机器学习算法的实现，包括聚类、分类、回归、协同过滤等。降低了机器学习的门槛，开发人员只要具备一定的伦理只是就能进行机器学习的工作。</li>
<li>GraphX<br>是基于图计算的API，能在海量数据上自如的运行复杂的图算法。<h2 id="Spark-的运行架构"><a href="#Spark-的运行架构" class="headerlink" title="Spark 的运行架构"></a>Spark 的运行架构</h2><img src="https://img-blog.csdnimg.cn/20201022200451934.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20201022200745461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>一个应用由一个任务控制节点（Driver） 和 若干作业（Jo b）构成，一个作业由多个阶段（Stage）构成，一个阶段由多个（Tas k）组成。当执行任务的时候一个任务控制节点会向集群管理器（Clu ster Manager）申请资源。启动Executor,并向Exe cutor发送应用程序代码和文件，然后在Executor上执行任务，运行结束之后执行结果会返回给任务控制节点，或者写入HDFS中或者数据库中。<br>具体的过程，我们后期会做一个实验，在实验中感受一下执行过程。</p>
<h4 id="使用Executor执行任务的优势"><a href="#使用Executor执行任务的优势" class="headerlink" title="使用Executor执行任务的优势"></a>使用Executor执行任务的优势</h4><ol>
<li>利用多线程来执行具体的任务，减少了任务启动的开销。</li>
<li>Executor中有一个BlockManager存储模块，会将内存和磁盘共同作为存储设备，当进行迭代计算的时候，中间结果可以暂时的存储在这些模块中，减少了IO开销。</li>
</ol>
<h2 id="RDD弹性分布式数据集"><a href="#RDD弹性分布式数据集" class="headerlink" title="RDD弹性分布式数据集"></a>RDD弹性分布式数据集</h2><h3 id="出现背景"><a href="#出现背景" class="headerlink" title="出现背景"></a>出现背景</h3><p>在实际应用中，有很多的迭代算和交互式数据挖掘工具，不同阶段之间会重用中间结果。目前的mapReduce框架都是把中间结果写入到HDFS中，带来了大量的数据复制、磁盘IO和序列化开销。</p>
<h3 id="RDD概念"><a href="#RDD概念" class="headerlink" title="RDD概念"></a>RDD概念</h3><p>就是一个分布式分区对象集合，本质上只是一个只读的分区记录集合。每个RDD可以分成多个分区，每个分区就是一个数据集片段，并且一个RDD的不同分区可以被保存到集群中不同的节点上，从而可以在集群中的不同节点上进行并行计算。RDD的只读不能直接修改的特点（要想修改只能基于稳定的物理存储中的数据集）决定了RDD适合执行批处理，不适合细粒度的、异步的应用。比如web系统、增量式的网络爬虫等。</p>
<h4 id="RDD-实现高效计算的原因"><a href="#RDD-实现高效计算的原因" class="headerlink" title="RDD 实现高效计算的原因"></a>RDD 实现高效计算的原因</h4><p>（1）高效的容错性<br>在RDD的设计中，数据只读，不可修改。如果需要修改数据，必须从父RDD 转换到子RDD，由此在不同的RDD之间建立了血缘关系。检查容错可以直接通过父节点进行重新计算，而不需要回滚整个系统或者通过数据冗余的方式。<br>（2）中间结果持久化到内存 。数据在内存中的多个RDD操作之间进行传递，不需要落地到磁盘，避免了不必要的读写磁盘开销。<br>（3）存放的数据可以是JAVA对象，避免了不必要的对象的序列化和反序列化开销。</p>
<h4 id="RDD之间的依赖关系"><a href="#RDD之间的依赖关系" class="headerlink" title="RDD之间的依赖关系"></a>RDD之间的依赖关系</h4><ol>
<li>窄依赖</li>
<li>宽依赖</li>
</ol>
<h4 id="RDD中阶段的划分"><a href="#RDD中阶段的划分" class="headerlink" title="RDD中阶段的划分"></a>RDD中阶段的划分</h4><p>上面我们说了数据的执行是基于数据的阶段进行执行的，那么数据的阶段是怎么样划分的呢？<br><img src="https://img-blog.csdnimg.cn/20201024200214371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTM2NzE2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>具体划分方法：<br>在DAG中进行反向解析，遇到宽依赖就断开，遇到窄依赖就把当前的RDD加入到当前的阶段中，将窄依赖尽量划分在同一个阶段中，可以实现流水线计算。<br>如上图所示：HDFS中读入数据，生成3个不同的RDD（A,C,E），通过一系列的转化操作后，再将数据存储到HDFS中。对DAG进行解析的时候，RDD A到RDDB 以及从RDD B以及RDD F到RDD G的转化都是宽依赖的，因此需要在此断开，会生成3个阶段。在阶段2中 map和union 操作都是窄依赖，这两个操作可以形成一个流水线操作。<br>（先入个门吧）<br><a href="http://dblab.xmu.edu.cn/blog/972-2/" target="_blank" rel="noopener">学习链接</a><br><a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.functions" target="_blank" rel="noopener">Spark API</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        
<div class="counter-tag counter">
    <span id="/2020/10/25/Spark基础笔记/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="Spark基础笔记">
         &nbsp;
        view
    </span>
</div>

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2021 Gorge
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>